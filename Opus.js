// Opus HTML 5 support file. Build 16764
// (C) 2001-2015 Digital Workshop(Software) Ltd.
// This file may only be used with HTML5 publications produced by Opus.
// It may not be distributed, edited, or used in whole or part for any
// other purpose.
// See http://www.digitalworkshop.com for more information on Opus.
function __inherit(child, parent){var F=function(){};F.prototype=parent.prototype;child.prototype=new F();child.prototype.constructor=child;child.superproto=parent.prototype;return child;}DWAction=function(){};DWAction.prototype.Go=function(callback){return 0;};DWAction.prototype.initEvents=function(host){};DWAction.prototype.closeEvents=function(host){};DWActionCase=function(minValue,maxValue,actions){this.m_minValue=minValue;this.m_maxValue=maxValue;this.m_actions=actions;};DWActionCase.prototype.m_minValue=null;DWActionCase.prototype.m_maxValue=null;DWActionCase.prototype.m_actions=null;DWActionCase.prototype.test=function(value){if((this.m_minValue==null)&&(this.m_maxValue==null)){return true;}if((value>=this.m_minValue)&&(value<=this.m_maxValue)){return true;}return false;};DWActionCase.prototype.Go=function(callback){return this.m_actions.Go(callback);};DWActionCondition=function(type,variable,expression,compare,compareVariable){this.m_type=type;this.m_variable=variable;this.m_expression=expression;this.m_compare=compare;this.m_compareVariable=compareVariable;this.m_cases=new Array();for(var i=5;i<arguments.length;i++){this.m_cases.push(arguments[i]);}};__inherit(DWActionCondition,DWAction);DWActionCondition.prototype.m_type=0;DWActionCondition.prototype.m_variable=null;DWActionCondition.prototype.m_expression=null;DWActionCondition.prototype.m_compare=null;DWActionCondition.prototype.m_compareVariable=null;DWActionCondition.prototype.m_cases=null;DWActionCondition.prototype.Go=function(callback){var variables=DWVariables.instance();var value;if(this.m_expression!=null){value=this.m_expression();}else{value=variables.getValue(this.m_variable);}if((this.m_type!=0x400)&&(this.m_type!=0x200)){var compare=this.m_compare;if(this.m_compareVariable){compare=variables.getValue(this.m_compareVariable);}var invert=this.m_type&0x100;switch(this.m_type&0xff){case 9:break;case 0:value=Boolean(value);break;case 1:value=!Boolean(value);break;case 2:value=value==compare;break;case 3:value=value!=compare;break;case 4:value=value<compare;break;case 5:value=value<=compare;break;case 6:value=value>compare;break;case 7:value=value>=compare;break;case 8:value=String(value).indexOf(String(compare))!=(-1);break;default:break;}if(invert){value=!value;}}for(var i=0;i<this.m_cases.length;i++){var cas=this.m_cases[i];if(cas.test(value)){return cas.Go(callback);}}return 0;};DWActionDelay=function(delay){this.m_delay=delay;};__inherit(DWActionDelay,DWAction);DWActionDelay.prototype.m_delay=null;DWActionDelay.prototype.m_callback=null;DWActionDelay.prototype.m_start=null;DWActionDelay.prototype.m_host=null;DWActionDelay.prototype.Go=function(callback){this.m_callback=callback;this.m_start=new Date().getTime();DWUpdateController.addUpdate(this);return 1;};DWActionDelay.prototype.update=function(time){var delay=this.m_delay;var now=new Date().getTime();if((now-this.m_start)>delay){var callback=this.m_callback;this.m_callback=null;DWUpdateController.removeUpdate(this);if(callback){callback.Notify(0);}}};DWActionDelay.prototype.initEvents=function(host){this.m_host=host;};DWActionDelay.prototype.closeEvents=function(host){DWUpdateController.removeUpdate(this);this.m_host=null;};DWActionGroup=function(actions){this.m_actions=actions;};__inherit(DWActionGroup,DWAction);DWActionGroup.prototype.m_actions=null;DWActionGroup.prototype.m_running=0;DWActionGroup.prototype.m_callback=null;DWActionGroup.prototype.Go=function(callback){this.m_running=0;for(var i=0;i<this.m_actions.length;i++){var state=this.m_actions[i].Go(this);if(state==1){this.m_running++;}}if(this.m_running){this.m_callback=callback;return 1;}return 0;};DWActionGroup.prototype.Notify=function(status){if(status==0){if(((--this.m_running)==0)&&this.m_callback){var callback=this.m_callback;this.m_callback=null;if(callback){callback.Notify(0);}}}};DWActionGroup.prototype.initEvents=function(host){if(this.m_actions){this.m_actions.initEvents(host);}};DWActionGroup.prototype.closeEvents=function(host){this.m_running=0;this.m_callback=null;if(this.m_actions){this.m_actions.closeEvents(host);}};DWActionList=function(){this.length=arguments.length;for(var i=0;i<this.length;i++){this[i]=arguments[i];}this.m_state=0;};DWActionList.prototype.m_state=null;DWActionList.prototype.m_callback=null;DWActionList.prototype.m_pos=0;DWActionList.prototype.m_inCallPageChange=false;DWActionList.prototype.Go=function(callback){if(this.m_state!=0){return 0;}this.m_pos=0;this.m_callback=callback;return this.Run();};DWActionList.prototype.m_inCall=null;DWActionList.prototype.m_inCallNotify=false;DWActionList.prototype.Run=function(){while(this.m_pos<this.length){var action=this[this.m_pos];this.m_inCall=true;this.m_inCallNotify=false;this.m_state=action.Go(this);this.m_inCall=false;if(this.m_inCallPageChange){this.m_inCallPageChange=false;return 0;}if(this.m_inCallNotify){this.m_state=0;this.m_inCallNotify=false;}this.m_pos++;if(this.m_state==1){return 1;}}this.m_state=0;return 0;};DWActionList.prototype.Notify=function(status){if(status==0){if(this.m_inCall){this.m_inCallNotify=true;}else{if(this.Run()==1){return;}if(this.m_callback){var callback=this.m_callback;this.m_callback=null;callback.Notify(0);}}}};DWActionList.prototype.initEvents=function(host){this.m_state=0;this.m_pos=0;if(this.m_inCall){this.m_inCallPageChange=true;}for(var i=0;i<this.length;i++){this[i].initEvents(host);}};DWActionList.prototype.closeEvents=function(host){for(var i=0;i<this.length;i++){this[i].closeEvents(host);}};DWActionLoop=function(type,param,while_visible,action_list){this.m_type=type;this.m_param=param;this.m_while_visible=while_visible;this.m_action_list=action_list;this.m_state=0;};__inherit(DWActionLoop,DWAction);DWActionLoop.prototype.m_type=null;DWActionLoop.prototype.m_param=null;DWActionLoop.prototype.m_while_visible=null;DWActionLoop.prototype.m_action_list=null;DWActionLoop.prototype.m_state=0;DWActionLoop.prototype.m_counter=0;DWActionLoop.prototype.m_callback=null;DWActionLoop.prototype.m_host=null;DWActionLoop.prototype.Go=function(callback){if(this.m_state!=0){return 0;}if(this.m_type==2){var fn=this.m_param;if(!fn(this.m_host)){return 0;}}this.m_counter=-1;var status=this.DoNext();if(status==1){this.m_callback=callback;DWUpdateController.addUpdate(this);}return status;};DWActionLoop.prototype.Notify=function(status){if(status==0){if(this.DoNext()==0){if(this.m_callback){var callback=this.m_callback;this.m_callback=null;if(callback){callback.Notify(0);}}this.m_state=0;}}};DWActionLoop.prototype.update=function(time){if(this.m_state==3){if(this.DoNext()==0){if(this.m_callback){var callback=this.m_callback;this.m_callback=null;callback.Notify(0);}DWUpdateController.removeUpdate(this);this.m_state=0;}}};DWActionLoop.prototype.DoNext=function(){this.m_state=0;if(this.m_while_visible){var parent=this.m_host;}if(this.m_type==2){var fn=this.m_param;if(!fn(this.m_host)){return 0;}}else{if(this.m_type==1){this.m_counter++;if(this.m_counter>=this.m_param){return 0;}}}if(this.m_action_list){if(this.m_action_list.Go(this)==1){this.m_state=1;return this.m_state;}}this.m_state=3;return 1;};DWActionLoop.prototype.initEvents=function(host){this.m_host=host;this.m_state=0;this.m_counter=0;if(this.m_action_list){this.m_action_list.initEvents(host);}};DWActionLoop.prototype.closeEvents=function(host){if(this.m_action_list){this.m_action_list.closeEvents(host);}this.m_host=null;DWUpdateController.removeUpdate(this);this.m_state=0;};DWAnimation=function(obj,id,time,repeat,at_end,relative,speed_function,callback){if(callback==undefined)callback=null;this.m_object=obj;this.m_id=id;if(time<=0)time=10;this.m_time=time;this.m_repeat=repeat;this.m_at_end=at_end;this.m_relative=relative;this.m_speed_function=speed_function;this.m_userCallback=callback;};__inherit(DWAnimation,DWAction);DWAnimation.prototype.m_id=null;DWAnimation.prototype.m_time=null;DWAnimation.prototype.m_repeat=null;DWAnimation.prototype.m_at_end=null;DWAnimation.prototype.m_relative=null;DWAnimation.prototype.m_speed_function=null;DWAnimation.prototype.m_userCallback=null;DWAnimation.prototype.m_object=null;DWAnimation.prototype.m_callback=null;DWAnimation.prototype.m_done=false;DWAnimation.prototype.m_start=0;DWAnimation.prototype.m_pause_time=0;DWAnimation.prototype.id=function(){return this.m_id;};DWAnimation.prototype.Go=function(callback){this.m_callback=callback;this.m_object.getAnimationController().add(this);return 1;};DWAnimation.prototype.initEvents=function(host){this.m_callback=null;};DWAnimation.prototype.closeEvents=function(host){this.m_object.getAnimationController().remove(this.m_id);};DWAnimation.prototype.m_init_x=null;DWAnimation.prototype.m_init_y=null;DWAnimation.prototype.m_init_xscale=null;DWAnimation.prototype.m_init_yscale=null;DWAnimation.prototype.m_init_rotation=null;DWAnimation.prototype.m_init_alpha=null;DWAnimation.prototype.play=function(){this.m_init_x=this.m_object.getTranslate().x;this.m_init_y=this.m_object.getTranslate().y;this.m_init_xscale=this.m_object.getScale().x;this.m_init_yscale=this.m_object.getScale().y;this.m_init_rotation=this.m_object.getRotate();this.m_init_alpha=this.m_object.getAlpha();this.m_start=new Date().getTime();this.m_pause_time=null;this.m_done=false;};DWAnimation.prototype.stop=function(){if(this.m_callback){this.m_callback.Notify(0);}if(this.m_userCallback&&(typeof(this.m_userCallback)=="function")){this.m_userCallback();}};DWAnimation.prototype.pause=function(){this.m_pause_time=new Date().getTime();};DWAnimation.prototype.resume=function(){if(this.m_pause_time){this.m_start+=(new Date().getTime()-this.m_pause_time);this.m_pause_time=0;}};DWAnimation.prototype.finished=function(){;this.m_object.getAnimationController().remove(this.m_id);};DWAnimation.prototype.getPos=function(){var time=(this.m_pause_time?this.m_pause_time:new Date().getTime())-this.m_start;var trip=Math.floor(time/this.m_time);var delta=(time%this.m_time)/this.m_time;var pos=this.m_speed_function(delta);if(this.m_at_end==1){if((trip>=(this.m_repeat*2))&&(this.m_repeat!=(-1))){pos=0;this.m_done=true;}else{if(trip%2){pos=1-pos;}}}else{if((trip>=this.m_repeat)&&(this.m_repeat!=(-1))){pos=(this.m_at_end==0?(this.m_relative?this.m_repeat:1):0);this.m_done=true;}else{if(this.m_at_end==0){if(this.m_relative){pos+=trip;}else{if(trip>0)pos=1;}}}}return pos;};DWAnimation.prototype.update=function(){;};DWAnimateBounce=function(time,repeat,at_end,relative,speed_type,angle,speed,obj){DWAnimation.call(this,obj,3,time,repeat,at_end,relative,speed_type);this.m_angle=angle;this.m_speed=speed;this.m_deltax=speed*Math.sin(angle);this.m_deltay=speed*Math.cos(angle);};__inherit(DWAnimateBounce,DWAnimation);DWAnimateBounce.prototype.m_angle=null;DWAnimateBounce.prototype.m_speed=null;DWAnimateBounce.prototype.m_count=0;DWAnimateBounce.prototype.m_deltax=null;DWAnimateBounce.prototype.m_deltay=null;DWAnimateBounce.prototype.m_on_return=false;DWAnimateBounce.prototype.m_return_distance=null;DWAnimateBounce.prototype.m_returnX=null;DWAnimateBounce.prototype.m_returnY=null;DWAnimateBounce.prototype.update=function(){var pos=this.getPos();var x=this.m_object.getTranslate().x+this.m_deltax;var y=this.m_object.getTranslate().y+this.m_deltay;if(this.m_on_return){this.m_object.setTranslate(x,y);x-=this.m_returnX;y-=this.m_returnY;var distance=Math.sqrt((x*x)+(y*y));var testd=distance-this.m_return_distance;if(testd>0){var x=this.m_object.getTranslate().x-((this.m_deltax*testd)/this.m_speed);var y=this.m_object.getTranslate().y-((this.m_deltay*testd)/this.m_speed);this.m_object.setTranslate(x,y);this.finished();}return;}var save_count=this.m_count;var parent=this.m_object.getParent();var parentRect;if(parent.type()=="Page"){var page=parent;parentRect=new DWRect(0,0,page.getSize().x,page.getSize().y);}else{var grParent=parent;parentRect=grParent.getTransformedBoundingRect();}var objRect=this.m_object.getTransformedBoundingRect();if((this.m_deltax<0)&&(objRect.x<=parentRect.x)){this.m_deltax=-this.m_deltax;this.m_count++;}else{if((this.m_deltax>0)&&(objRect.right()>=parentRect.right())){this.m_deltax=-this.m_deltax;this.m_count++;}}if((this.m_deltay<0)&&(objRect.y<=parentRect.y)){this.m_deltay=-this.m_deltay;this.m_count++;}else{if((this.m_deltay>0)&&(objRect.bottom()>=parentRect.bottom())){this.m_deltay=-this.m_deltay;this.m_count++;}}this.m_object.setTranslate(x,y);if((this.m_repeat!=(-1))&&(this.m_count>=this.m_repeat)){if(this.m_at_end==1){this.m_on_return=true;var angle=Math.atan2(this.m_init_x-x,this.m_init_y-y);this.m_deltax=Math.sin(angle)*this.m_speed;this.m_deltay=Math.cos(angle)*this.m_speed;this.m_returnX=x;this.m_returnY=y;var x1=x-this.m_init_x;var y1=y-this.m_init_y;this.m_return_distance=Math.sqrt((x1*x1)+(y1*y1));}else{if(this.m_at_end==2){this.m_object.setTranslate(this.m_init_x,this.m_init_y);}this.finished();}}};DWAnimateFade=function(time,repeat,at_end,relative,speed_type,alpha,obj,callback){DWAnimation.call(this,obj,0x800,time,repeat,at_end,relative,speed_type,callback);this.m_alpha=alpha;};__inherit(DWAnimateFade,DWAnimation);DWAnimateFade.prototype.m_alpha=null;DWAnimateFade.prototype.update=function(){var pos=this.getPos();var alpha;if(this.m_relative){alpha=this.m_init_alpha+(this.m_alpha*pos);}else{alpha=(this.m_init_alpha*(1-pos))+(this.m_alpha*pos);}if(alpha>1)alpha=1;if(alpha<0)alpha=0;this.m_object.setAlpha(alpha);if(this.m_done)this.finished();};DWAnimateMove=function(time,repeat,at_end,relative,speed_type,translateX,translateY,obj,callback){var ID=((translateX!=null)?1:0)|((translateY!=null)?2:0);DWAnimation.call(this,obj,ID,time,repeat,at_end,relative,speed_type,callback);this.m_translateX=translateX;this.m_translateY=translateY;};__inherit(DWAnimateMove,DWAnimation);DWAnimateMove.prototype.m_translateX=null;DWAnimateMove.prototype.m_translateY=null;DWAnimateMove.prototype.update=function(){var pos=this.getPos();var sx;var sy;if(this.m_relative){sx=this.m_init_x+(this.m_translateX*pos);sy=this.m_init_y+(this.m_translateY*pos);}else{var objOffset=this.m_object.getParentOffset();var parent=this.m_object.getParent();if((parent!=null)&&parent.isGraphicalObject()){objOffset=new DWPoint(objOffset.x+(parent.getWidth()/2),objOffset.y+(parent.getHeight()/2));}sx=(this.m_init_x*(1-pos))+((this.m_translateX-objOffset.x)*pos);sy=(this.m_init_y*(1-pos))+((this.m_translateY-objOffset.y)*pos);}if(this.m_translateX==null){this.m_object.setTranslate(this.m_object.getTranslate().x,sy);}else{if(this.m_translateY==null){this.m_object.setTranslate(sx,this.m_object.getTranslate().y);}else{this.m_object.setTranslate(sx,sy);}}if(this.m_done)this.finished();};DWAnimatePath=function(time,repeat,at_end,relative,speed_type,path,orient,start,end,obj,callback){DWAnimation.call(this,obj,0x1000,time,repeat,at_end,relative,speed_type,callback);this.m_path=path;this.m_orient=orient;this.m_startPos=start;this.m_endPos=end;};__inherit(DWAnimatePath,DWAnimation);DWAnimatePath.prototype.m_path=null;DWAnimatePath.prototype.m_orient=null;DWAnimatePath.prototype.m_startPos=null;DWAnimatePath.prototype.m_endPos=null;DWAnimatePath.prototype.update=function(){var pos=this.getPos();if(pos>1)pos=pos-Math.floor(pos);pos=this.m_startPos+((this.m_endPos-this.m_startPos)*pos);var d=this.getPoint(pos*this.m_path.getLength());var firstPoint=this.m_path.getFirstPoint();if(!this.m_relative){var pageOffset=this.m_path.getPageOffset().clone();var pathParent=this.m_path.getParent();while(pathParent.isGraphicalObject()){var parentGr=pathParent;var off=parentGr.getParentOffset();pageOffset.x+=off.x;pageOffset.y+=off.y;pathParent=pathParent.getParent();}d.x+=pageOffset.x;d.y+=pageOffset.y;var objOffset=this.m_object.getParentOffset().clone();var parent=this.m_object.getParent();while(parent.isGraphicalObject()){var parentGr=parent;var off=parentGr.getParentOffset();objOffset.x+=off.x;objOffset.y+=off.y;parent=parent.getParent();}d.x-=objOffset.x;d.y-=objOffset.y;this.m_object.setTranslate(d.x,d.y);}else{this.m_object.setTranslate((d.x+this.m_init_x)-firstPoint.x,(d.y+this.m_init_y)-firstPoint.y);}if(this.m_orient){this.m_object.setRotate(d.rotation);}if(this.m_done)this.finished();};DWAnimatePath.prototype.getPoint=function(pos){var ret=new Object();var segments=this.m_path.getPoints();var total=segments.length;var low=0;var high=total;while(low<(high-1)){var mid=Math.floor((low+high)/2);var mid_pos=segments[mid].m_pos;if(mid_pos<pos){low=mid;}else{high=mid;}}var index=low;var seg_start=segments[index].m_pos;var seg_end;if(high==total){seg_end=this.m_path.getLength();}else{seg_end=segments[high].m_pos;}var seg_pos=(pos-seg_start)/(seg_end-seg_start);if(segments[index].m_type=="L"){var dx=segments[index].m_pte.x-segments[index].m_pts.x;var dy=segments[index].m_pte.y-segments[index].m_pts.y;ret.x=segments[index].m_pts.x+(dx*seg_pos);ret.y=segments[index].m_pts.y+(dy*seg_pos);ret.rotation=(Math.atan2(dy,dx)*0xb4)/Math.PI;}else{var u=seg_pos;var um1=1-u;var a=um1*um1*um1;var b=3*u*um1*um1;var c=3*u*u*um1;var d=u*u*u;ret.x=(a*segments[index].m_pts.x)+(b*segments[index].m_c1.x)+(c*segments[index].m_c2.x)+(d*segments[index].m_pte.x);ret.y=(a*segments[index].m_pts.y)+(b*segments[index].m_c1.y)+(c*segments[index].m_c2.y)+(d*segments[index].m_pte.y);a=(-3)*um1*um1;b=(6-(9*um1))*um1;c=(6-(9*u))*u;d=3*u*u;var dx=((a*segments[index].m_pts.x)-(b*segments[index].m_c1.x))+(c*segments[index].m_c2.x)+(d*segments[index].m_pte.x);var dy=((a*segments[index].m_pts.y)-(b*segments[index].m_c1.y))+(c*segments[index].m_c2.y)+(d*segments[index].m_pte.y);ret.rotation=(Math.atan2(dy,dx)*0xb4)/Math.PI;}return ret;};DWAnimateReset=function(time,speed_type,flags,obj,callback){DWAnimation.call(this,obj,flags,time,1,0,false,speed_type,callback);};__inherit(DWAnimateReset,DWAnimation);DWAnimateReset.prototype.update=function(){var pos=this.getPos();var t=this.m_object.getTranslate();var s=this.m_object.getScale();var a=this.m_object.getAlpha();var r=this.m_object.getRotate();if(this.m_id&1){t.x=(this.m_init_x*(1-pos))+(this.m_object.getInitialTranslate().x*pos);}if(this.m_id&2){t.y=(this.m_init_y*(1-pos))+(this.m_object.getInitialTranslate().y*pos);}if(this.m_id&0x20){s.x=(this.m_init_xscale*(1-pos))+(this.m_object.getInitialScale().x*pos);}if(this.m_id&0x40){s.y=(this.m_init_yscale*(1-pos))+(this.m_object.getInitialScale().y*pos);}if(this.m_id&0x10){r=(this.m_init_rotation*(1-pos))+(this.m_object.getInitialRotate()*pos);}if(this.m_id&0x800){a=(this.m_init_alpha*(1-pos))+(this.m_object.getInitialAlpha()*pos);}this.m_object.setTransform(t,s,r);this.m_object.setAlpha(a);if(this.m_done)this.finished();};DWAnimateRotate=function(time,repeat,at_end,relative,speed_type,angle,obj,callback){DWAnimation.call(this,obj,0x1c,time,repeat,at_end,relative,speed_type,callback);this.m_angle=angle;};__inherit(DWAnimateRotate,DWAnimation);DWAnimateRotate.prototype.m_angle=null;DWAnimateRotate.prototype.update=function(){var pos=this.getPos();var angle;if(this.m_relative){angle=this.m_init_rotation+(this.m_angle*pos);}else{angle=(this.m_init_rotation*(1-pos))+(this.m_angle*pos);}this.m_object.setRotate(angle);if(this.m_done)this.finished();};DWAnimateScale=function(time,repeat,at_end,relative,speed_type,scaleX,scaleY,obj,callback){var ID=((scaleX!=null)?0x20:0)|((scaleY!=null)?0x40:0);DWAnimation.call(this,obj,ID,time,repeat,at_end,relative,speed_type,callback);this.m_scaleX=scaleX/0x64;this.m_scaleY=scaleY/0x64;};__inherit(DWAnimateScale,DWAnimation);DWAnimateScale.prototype.m_scaleX=null;DWAnimateScale.prototype.m_scaleY=null;DWAnimateScale.prototype.update=function(){;var pos=this.getPos();var sx;var sy;if(this.m_relative){sx=this.m_init_xscale+(this.m_scaleX*pos);sy=this.m_init_yscale+(this.m_scaleY*pos);}else{sx=(this.m_init_xscale*(1-pos))+(this.m_scaleX*pos);sy=(this.m_init_yscale*(1-pos))+(this.m_scaleY*pos);}if(sx<0)sx=0;if(sy<0)sy=0;if(this.m_scaleX==null){this.m_object.setScale(this.m_object.getScale().x,sy);}else{if(this.m_scaleY==null){this.m_object.setScale(sx,this.m_object.getScale().y);}else{this.m_object.setScale(sx,sy);}}if(this.m_done)this.finished();};DWAnimationController=function(obj){this.m_list=new DWList();this.m_object=obj;};DWAnimationController.prototype.m_object=null;DWAnimationController.prototype.m_list=null;DWAnimationController.prototype.add=function(animation){this.remove(animation.id());this.m_list.addHead(animation);animation.play();if(this.m_list.size()==1){DWUpdateController.addAnimationUpdate(this);}};DWAnimationController.prototype.remove=function(id){var it=this.m_list.getHeadPosition();while(it){var anim=this.m_list.getItem(it);var itf=it;it=this.m_list.getNext(it);if(anim.id()&id){this.m_list.remove(itf);anim.stop();}}if(this.m_list.size()==0){DWUpdateController.removeAnimationUpdate(this);}};DWAnimationController.prototype.update=function(time){var it=this.m_list.getHeadPosition();while(it){var anim=this.m_list.getItem(it);anim.update();it=this.m_list.getNext(it);}};DWAnimationSpeed=function(){};DWAnimationSpeed.Constant=function(pos){return pos;};DWAnimationSpeed.LinearAcceration=function(pos){return pos*pos;};DWAnimationSpeed.LinearDeceration=function(pos){return pos*(2-pos);};DWAnimationSpeed.EaseIn=function(pos){return 1-Math.cos(((pos*Math.PI)/2));};DWAnimationSpeed.EaseOut=function(pos){return Math.sin((pos*Math.PI)/2);};DWAnimationSpeed.EaseInOut=function(pos){return 0.5*(1-Math.cos((pos*(pos*Math.PI))));};DWAnimationSpeed.BounceIn=function(s){var n=Math.log((1-((7-(11*s))/8)))/Math.log(0.5);n=Math.ceil(n);var b=Math.pow(0.5,n);var a=2*(1-b);var d=(b*b)-Math.pow((((11-(6*a))-(11*s))/4),2);return d;};DWAnimationSpeed.BounceOut=function(s){s=1-s;var n=Math.log((1-((7-(11*s))/8)))/Math.log(0.5);n=Math.ceil(n);var b=Math.pow(0.5,n);var a=2*(1-b);var d=(b*b)-Math.pow((((11-(6*a))-(11*s))/4),2);return 1-d;};DWAnimationSpeed.ElasticIn=function(s){var x=1.5;var d=Math.pow(2,10*(s-1))*Math.cos(((((0x14*3.141)*x)/3)*s));return d;};DWAnimationSpeed.ElasticOut=function(s){s=1-s;var x=1.5;var d=Math.pow(3,10*(s-1))*Math.cos(((((0x14*3.141)*x)/3)*s));return 1-d;};DWAnimationSpeed.XLinearAcceleration=function(pos){return pos*pos*pos;};DWAnimationSpeed.XLinearDeceleration=function(pos){return pos*(3-(pos*(3-pos)));};DWAnimationSpeed.SuperWobble=function(s){s=1-s;var x=0x12;var d=Math.pow(5,10*(s-1))*Math.cos(((((0x14*3.141)*x)/3)*s));return 1-d;};DWAnimationSpeed.Overshoot=function(s){s=1-s;var x=1.5;var d=Math.pow(5,10*(s-1))*Math.cos(((((0x14*3.141)*x)/5)*s));return 1-d;};DWAppearance=function(){this.length=arguments.length;for(var i=0;i<this.length;i++){this[i]=arguments[i];}};DWAppearance.prototype.apply=function(object){for(var i=0;i<this.length;i++){this[i].apply(object);}};DWObject=function(){Object.call(this);};DWObject.prototype.m_children=null;DWObject.prototype.m_parent=null;DWObject.prototype.m_objectName=null;DWObject.prototype.m_objectCode=null;DWObject.prototype.setParent=function(parent){this.m_parent=parent;};DWObject.prototype.getParent=function(){return this.m_parent;};DWObject.prototype.getPage=function(){if(this.m_parent){return this.m_parent.getPage();}return null;};DWObject.prototype.addChild=function(child){if(!this.m_children){this.m_children=new Array();}this.m_children.push(child);child.setParent(this);};DWObject.prototype.addChildren=function(){for(var i=0;i<arguments.length;i++){this.addChild(arguments[i]);}return this;};DWObject.prototype.getObjectName=function(){return this.m_objectName;};DWObject.prototype.getObjectCode=function(){return this.m_objectCode;};DWObject.prototype.type=function(){};DWObject.prototype.isGraphicalObject=function(){return false;};DWObject.prototype.getChildrenRecurse=function(){var a=new Array();if(this.m_children){for(var i=0;i<this.m_children.length;i++){var c=this.m_children[i].getChildrenRecurse();if(c){for(var j=0;j<c.length;j++){a.push(c[j]);}}a.push(this.m_children[i]);}}return a;};DWObject.prototype.getChildren=function(){return this.m_children;};DWObject.prototype.getNumberOfChildren=function(){return this.m_children.length;};DWObject.prototype.getChildIndex=function(obj){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i]==obj){return i;}}return -1;};DWObject.prototype.startObject=function(parentVisible){};DWObject.prototype.stopObject=function(){};DWObject.prototype.onShowParent=function(){};DWObject.prototype.onShowParentFinished=function(){};DWObject.prototype.onHideParent=function(){};DWObject.prototype.findChildByCode=function(code){if(this.m_children){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i].m_objectCode.compare(code)){return this.m_children[i];}}}return null;};DWObject.prototype.findDescendantByCode=function(code){if(this.m_children){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i].m_objectCode.compare(code)){return this.m_children[i];}var c=this.m_children[i].FindDescendantByCode(code);if(c){return c;}}}return null;};DWObject.prototype.GetParent=function(){return this.m_parent;};DWObject.prototype.GetFirstChild=function(){if(this.m_children&(this.m_children.length>0)){return this.m_children[0];}return null;};DWObject.prototype.GetNextChild=function(child){for(var i=0;i<(this.m_children.length-1);i++){if(this.m_children[i]==child){return this.m_children[i+1];}}return null;};DWObject.prototype.GetNumberChildren=function(){if(this.m_children){return this.m_children.length;}return 0;};DWObject.prototype.GetChild=function(index){if(this.m_children&&(index<this.m_children.length)){return this.m_children[index];}return null;};DWObject.prototype.FindChild=function(name){if(this.m_children){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i].m_objectName==name){return this.m_children[i];}}}return null;};DWObject.prototype.FindDescendant=function(name){if(this.m_children){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i].m_objectName==name){return this.m_children[i];}var c=this.m_children[i].FindDescendant(name);if(c){return c;}}}return null;};DWObject.prototype.GetName=function(){return this.getObjectName();};DWObject.prototype.GetUniqueObjectID=function(){return "Object"+this.m_objectCode.toString();};DWObject.prototype.GetType=function(){return this.type();};DWAudio=function(oc){this.m_objectCode=oc;};__inherit(DWAudio,DWObject);DWAudio.prototype.m_element=null;DWAudio.prototype.m_androidPlayer=null;DWAudio.prototype.m_autoStart=false;DWAudio.prototype.m_repeat=0;DWAudio.prototype.setProperties=function(autoStart,repeat){this.m_autoStart=autoStart;this.m_repeat=repeat;return this;};DWAudio.prototype.m_resources=null;DWAudio.prototype.addResource=function(url,mime){if(!this.m_resources){this.m_resources=new Array();}this.m_resources.push(url);this.m_resources.push(mime);return this;};DWAudio.prototype.startObject=function(parentVisible){DWObject.prototype.startObject.call(this);};DWAudio.prototype.stopObject=function(){if(this.m_playing&&this.m_stopOnPageExit){this.stop();}DWObject.prototype.stopObject.call(this);};DWAudio.prototype.audioElement=function(){return this.m_element;};DWAudio.prototype.m_repeatCount=null;DWAudio.prototype.m_volume=null;DWAudio.prototype.m_callback=null;DWAudio.prototype.m_stopOnPageExit=null;DWAudio.prototype.m_channel=null;DWAudio.prototype.m_playing=false;DWAudio.m_channels=null;DWAudio.m_nextChannel=10;DWAudio.prototype.play=function(repeat,volume,callback,stopOnPageExit,channel){this.m_repeatCount=repeat;this.m_volume=volume;this.m_stopOnPageExit=stopOnPageExit;this.m_callback=callback;if((!this.m_element)&&(!this.m_androidPlayer)){this.createElement();}if(!DWAudio.m_channels){DWAudio.m_channels=new Array();}if(channel!=(-1)){if((DWAudio.m_channels[channel]!=null)&&(DWAudio.m_channels[channel]!=undefined)){DWAudio.m_channels[channel].stop();}DWAudio.m_channels[channel]=this;this.m_channel=channel;}else{if(this.m_channel>=10){}else{this.m_channel=DWAudio.m_nextChannel++;}DWAudio.m_channels[this.m_channel]=this;}this.m_playing=true;if(this.m_element){this.m_element.volume=this.m_volume/0x64;this.m_element.play();}else{if(this.m_androidPlayer){this.m_androidPlayer.setVolume(this.m_volume/0x64);this.m_androidPlayer.seek(0);this.m_androidPlayer.play();this.onPlaybackPlay();DWUpdateController.addUpdate(this);}}return true;};DWAudio.prototype.stop=function(){if((this.m_element||this.m_androidPlayer)&&this.m_playing){this.m_playing=false;if(this.m_element){this.m_element.pause();this.m_element.currentTime=0;}else{if(this.m_androidPlayer){this.m_androidPlayer.stop();this.m_androidPlayer.seek(0);DWUpdateController.removeUpdate(this);}}if(this.m_callback){this.m_callback();this.m_callback=null;}this.getPage().triggerRecurse("SynchEnd"+this.m_objectCode.toString());}};DWAudio.prototype.pause=function(){if(this.m_element&&this.m_playing){this.m_element.pause();}if(this.m_androidPlayer&&this.m_playing){this.m_androidPlayer.pause();}};DWAudio.prototype.resume=function(){if(this.m_element&&this.m_playing){this.m_element.play();}if(this.m_androidPlayer&&this.m_playing){this.m_androidPlayer.play();}};DWAudio.prototype.setVolume=function(volume,relative){if((this.m_element||this.m_androidPlayer)&&this.m_playing){if(relative){this.m_volume+=volume;if(this.m_volume<0)this.m_volume=0;if(this.m_volume>0x64)this.m_volume=0x64;}else{this.m_volume=volume;}if(this.m_element){this.m_element.volume=this.m_volume/0x64;}else{if(this.m_androidPlayer){this.m_androidPlayer.setVolume(this.m_volume/0x64);}}}};DWAudio.stopChannel=function(channel){if(DWAudio.m_channels){if((DWAudio.m_channels[channel]!=null)&&(DWAudio.m_channels[channel]!=undefined)){DWAudio.m_channels[channel].stop();DWAudio.m_channels[channel]=null;}}};DWAudio.stopAll=function(){if(DWAudio.m_channels){for(var i=0;i<DWAudio.m_channels.length;i++){if((DWAudio.m_channels[i]!=null)&&(DWAudio.m_channels[i]!=undefined)){DWAudio.m_channels[i].stop();DWAudio.m_channels[i]=null;}}}};DWAudio.pauseChannel=function(channel){if(DWAudio.m_channels){if((DWAudio.m_channels[channel]!=null)&&(DWAudio.m_channels[channel]!=undefined)){DWAudio.m_channels[channel].pause();}}};DWAudio.pauseAll=function(){if(DWAudio.m_channels){for(var i=0;i<DWAudio.m_channels.length;i++){if((DWAudio.m_channels[i]!=null)&&(DWAudio.m_channels[i]!=undefined)){DWAudio.m_channels[i].pause();}}}};DWAudio.resumeChannel=function(channel){if(DWAudio.m_channels){if((DWAudio.m_channels[channel]!=null)&&(DWAudio.m_channels[channel]!=undefined)){DWAudio.m_channels[channel].resume();}}};DWAudio.resumeAll=function(){if(DWAudio.m_channels){for(var i=0;i<DWAudio.m_channels.length;i++){if((DWAudio.m_channels[i]!=null)&&(DWAudio.m_channels[i]!=undefined)){DWAudio.m_channels[i].resume();}}}};DWAudio.setChannelVolume=function(channel,volume,relative){if(DWAudio.m_channels){if((DWAudio.m_channels[channel]!=null)&&(DWAudio.m_channels[channel]!=undefined)){DWAudio.m_channels[channel].setVolume(volume,relative);}}};DWAudio.setVolumeAll=function(volume,relative){if(DWAudio.m_channels){for(var i=0;i<DWAudio.m_channels.length;i++){if((DWAudio.m_channels[i]!=null)&&(DWAudio.m_channels[i]!=undefined)){DWAudio.m_channels[i].setVolume(volume,relative);}}}};DWAudio.prototype.onPlaybackPlay=function(){this.getPage().triggerRecurse("SynchStart"+this.m_objectCode.toString());};DWAudio.prototype.onPlaybackEnded=function(){if(this.m_playing){if(this.m_repeatCount==0){if(this.m_callback){this.m_callback();this.m_callback=null;}this.m_playing=false;DWAudio.m_channels[this.m_channel]=null;this.getPage().triggerRecurse("SynchEnd"+this.m_objectCode.toString());}else{this.m_repeatCount--;if(this.m_element){this.m_element.play();}else{if(this.m_androidPlayer){this.m_androidPlayer.seek(0);this.m_androidPlayer.play();}}}}};DWAudio.prototype.createElement=function(){if(window.hasOwnProperty("DWAndroidAudioPlayerFactory")){this.m_androidPlayer=DWAndroidAudioPlayerFactory.createAudioPlayer();if(this.m_resources&&(this.m_resources.length>=1)){this.m_androidPlayer.load(this.m_resources[0]);}}else{this.m_element=document.createElement("audio");if(this.m_resources){for(var i=0;i<this.m_resources.length;i+=2){var source=document.createElement("source");this.m_element.appendChild(source);source.setAttribute("src",this.m_resources[i]);source.setAttribute("type",this.m_resources[i+1]);}}this.m_element.addEventListener("ended",this.onPlaybackEnded.bind(this),true);this.m_element.addEventListener("playing",this.onPlaybackPlay.bind(this),true);}};DWAudio.prototype.update=function(time){if(this.m_androidPlayer){if(this.m_playing&&(!this.m_androidPlayer.isPlaying())){this.onPlaybackEnded();}}};DWBackgroundElement=function(brush){this.m_brush=brush;};DWBackgroundElement.prototype.m_brush=null;DWBackgroundElement.prototype.apply=function(object){object.getAdapter().setBackground(this.m_brush);};DWImageBase=function(srcRect,mode){this.m_srcRect=srcRect;this.m_mode=mode;};DWImageBase.prototype.m_srcRect=null;DWImageBase.prototype.m_mode=null;DWImageBase.prototype.type=function(){return "";};DWBitmapImage=function(url,rSrc,mode){DWImageBase.call(this,rSrc,mode);this.m_url=url;};__inherit(DWBitmapImage,DWImageBase);DWBitmapImage.prototype.m_url=null;DWBitmapImage.prototype.type=function(){return "DWBitmapImage";};DWBlurElement=function(x,y,repeat){this.m_x=x;this.m_y=y;this.m_repeat=repeat;};DWBlurElement.prototype.m_x=null;DWBlurElement.prototype.m_y=null;DWBlurElement.prototype.m_repeat=null;DWBlurElement.prototype.apply=function(object){object.getAdapter().setBlur(this.m_x,this.m_y,this.m_repeat);};DWBookmarks=function(){};DWBookmarks.setBookmark=function(){var pub=DWPublication.instance();var page=pub.getCurrentPage();if(page!=null){if(window.localStorage!=undefined){window.localStorage["DWBookmarks.page"]=page.getObjectName();}}};DWBookmarks.gotoBookmark=function(){if(window.localStorage!=undefined){var name=window.localStorage["DWBookmarks.page"];if(name!=null){DWPublication.instance().gotoPage(name);}}};DWBorderElement=function(width,radius,colour){if(width==undefined)width=0;if(radius==undefined)radius=0;if(colour==undefined)colour=null;this.m_width=width;this.m_radius=radius;this.m_colour=colour;};DWBorderElement.prototype.m_colour=null;DWBorderElement.prototype.m_width=null;DWBorderElement.prototype.m_radius=null;DWBorderElement.prototype.m_polygons=null;DWBorderElement.prototype.addPolygon=function(poly){if(!this.m_polygons){this.m_polygons=new Array();}this.m_polygons.push(poly);return this;};DWBorderElement.prototype.m_maskPolygons=null;DWBorderElement.prototype.addMaskPolygon=function(poly){if(!this.m_maskPolygons){this.m_maskPolygons=new Array();}this.m_maskPolygons.push(poly);return this;};DWBorderElement.prototype.apply=function(object){if(this.m_polygons||this.m_maskPolygons){object.getAdapter().setVectorBorder(this.m_polygons,this.m_maskPolygons);}else{object.getAdapter().setBorder(this.m_width,this.m_radius,this.m_colour);}};DWHotspot=function(){};__inherit(DWHotspot,DWObject);DWHotspot.prototype.m_actions=null;DWHotspot.prototype.m_propagate=true;DWHotspot.prototype.m_wantsTouch=false;DWHotspot.prototype.m_autoRepeat=false;DWHotspot.prototype.initActions=function(actions){this.m_actions=actions;};DWHotspot.prototype.setPropagate=function(propagate){this.m_propagate=propagate;return this;};DWHotspot.prototype.setWantsTouch=function(wantsTouch){this.m_wantsTouch=true;return this;};DWHotspot.prototype.setAutoRepeat=function(autoRepeat){this.m_autoRepeat=autoRepeat;return this;};DWHotspot.prototype.m_autoRepeatCount=0;DWHotspot.prototype.onMouseDown=function(e){this.trigger("OnLeftDown");if(!this.m_propagate){e.stopPropagation();}if(this.m_autoRepeat){this.m_autoRepeatCount=1;new DWDelayedCall(this.onAutoRepeat.bind(this),0x190);}};DWHotspot.prototype.onAutoRepeat=function(){if(this.m_autoRepeatCount!=0){this.trigger("OnLeftDown");this.m_autoRepeatCount++;new DWDelayedCall(this.onAutoRepeat.bind(this),0x64);}};DWHotspot.prototype.onMouseUp=function(e){this.trigger("OnLeftClick");if(!this.m_propagate){e.stopPropagation();}this.m_autoRepeatCount=0;};DWHotspot.prototype.m_mouseIsOver=false;DWHotspot.prototype.isMouseOver=function(){return this.m_mouseIsOver;};DWHotspot.prototype.onMouseOver=function(e){this.trigger("OnMouseOver");};DWHotspot.prototype.onMouseOut=function(e){this.trigger("OnMouseOut");this.m_autoRepeatCount=0;};DWHotspot.prototype.onMouseMove=function(e){var mouseOver=this.hitTest(new DWPoint(e.clientX,e.clientY));if(mouseOver&&(!this.m_mouseIsOver)){this.onMouseOver(e);this.m_mouseIsOver=true;}else{if((!mouseOver)&&this.m_mouseIsOver){this.onMouseOut(e);this.m_mouseIsOver=false;}}};DWHotspot.prototype.onClick=function(e){};DWHotspot.prototype.onDblClick=function(e){this.trigger("OnLeftDouble");if(!this.m_propagate){e.stopPropagation();}};DWHotspot.prototype.onTouchStart=function(e){this.trigger("OnLeftDown");if(!this.m_propagate){e.stopPropagation();}if(this.wantsTouch()){e.preventDefault();}if(this.m_autoRepeat){this.m_autoRepeatCount=1;new DWDelayedCall(this.onAutoRepeat.bind(this),0x190);}};DWHotspot.prototype.onTouchMove=function(e){};DWHotspot.prototype.onTouchEnd=function(e){if(this.hitTest(new DWPoint(e.clientX,e.clientY))){this.trigger("OnLeftClick");}if(!this.m_propagate){e.stopPropagation();}this.m_autoRepeatCount=0;};DWHotspot.prototype.wantsTouch=function(){return this.m_wantsTouch;};DWHotspot.prototype.trigger=function(ev){if(this.m_actions){return this.m_actions.Trigger(new DWSimpleTrigger(ev));}return false;};DWHotspot.prototype.triggerEvents=function(trigger){if(this.m_actions){return this.m_actions.Trigger(trigger);}return false;};DWHotspot.prototype.triggerRecurse=function(trigger){return this.triggerEventsRecurse(new DWSimpleTrigger(trigger));};DWHotspot.prototype.triggerEventsRecurse=function(trigger){var b=this.triggerEvents(trigger);if(this.m_children){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i].isGraphicalObject()){b|=this.m_children[i].triggerEventsRecurse(trigger);}}}return b;};DWHotspot.prototype.hitTest=function(ptPage){return false;};DWGraphicalObjectBase=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWHotspot.call(this);this.m_elementId=elementId;this.m_objectName=name;var element=document.getElementById(elementId);if((element.tagName=="DIV")||(element.tagName=="div")){this.m_element=element;this.m_adapter=new DWDIVAdapter(this);for(var i=0;i<element.childNodes.length;i++){if((element.childNodes[i].tagName=="svg")||(element.childNodes[i].tagName=="SVG")){var svgElement=element.childNodes[i];for(var j=0;i<svgElement.childNodes.length;j++){if((svgElement.childNodes[j].tagName=="g")||(svgElement.childNodes[j].tagName=="G")){this.m_svgOuterGroup=svgElement.childNodes[j];break;}}break;}}}else{if((element.tagName=="g")||(element.tagName=="G")){this.m_svgOuterGroup=element;}}if(this.m_svgOuterGroup){for(var i=0;i<this.m_svgOuterGroup.childNodes.length;i++){if((this.m_svgOuterGroup.childNodes[i].tagName=="g")||(this.m_svgOuterGroup.childNodes[i].tagName=="G")){this.m_svgGroup=this.m_svgOuterGroup.childNodes[i];break;}}}if(this.m_element&&this.m_svgOuterGroup){this.m_adapter=new DWDIVSVGAdapter(this);}else{if(this.m_element){this.m_adapter=new DWDIVAdapter(this);}else{if(this.m_svgOuterGroup){this.m_adapter=new DWSVGAdapter(this);}}}this.m_initTransform=new DWTransform();this.m_transform=new DWTransform();this.m_children=new Array();this.m_objectCode=code;this.setParentOffset(parentOffsetX,parentOffsetY);this.setSize(sizeX,sizeY);};__inherit(DWGraphicalObjectBase,DWHotspot);DWGraphicalObjectBase.prototype.m_element=null;DWGraphicalObjectBase.prototype.m_svgOuterGroup=null;DWGraphicalObjectBase.prototype.m_svgGroup=null;DWGraphicalObjectBase.prototype.m_elementId=null;DWGraphicalObjectBase.prototype.svg=function(){return this.m_svgGroup;};DWGraphicalObjectBase.prototype.svgOuter=function(){return this.m_svgOuterGroup;};DWGraphicalObjectBase.prototype.element=function(){return this.m_element;};DWGraphicalObjectBase.prototype.elementId=function(){return this.m_elementId;};DWGraphicalObjectBase.prototype.type=function(){};DWGraphicalObjectBase.prototype.isGraphicalObject=function(){return true;};DWGraphicalObjectBase.prototype.m_adapter=null;DWGraphicalObjectBase.prototype.getAdapter=function(){return this.m_adapter;};DWGraphicalObjectBase.prototype.m_initTransform=null;DWGraphicalObjectBase.prototype.m_transform=null;DWGraphicalObjectBase.prototype.m_initAlpha=1;DWGraphicalObjectBase.prototype.m_alpha=1;DWGraphicalObjectBase.prototype.m_showFor=-1;DWGraphicalObjectBase.prototype.setShowFor=function(showForMs){this.m_showFor=showForMs;return this;};DWGraphicalObjectBase.prototype.m_showAfter=-1;DWGraphicalObjectBase.prototype.m_initiallyVisible=true;DWGraphicalObjectBase.prototype.m_visible=0;DWGraphicalObjectBase.prototype.setInitiallyHidden=function(hidden,showAfter){this.m_showAfter=showAfter;this.m_initiallyVisible=!hidden;return this;};DWGraphicalObjectBase.prototype.m_appearances=null;DWGraphicalObjectBase.prototype.initAppearance=function(handle,appearance){if(this.m_appearances==null){this.m_appearances=new Array();}this.m_appearances[handle]=appearance;return this;};DWGraphicalObjectBase.prototype.m_showTransition=null;DWGraphicalObjectBase.prototype.m_hideTransition=null;DWGraphicalObjectBase.prototype.setShowTransition=function(tr){this.m_showTransition=tr;return this;};DWGraphicalObjectBase.prototype.setHideTransition=function(tr){this.m_hideTransition=tr;return this;};DWGraphicalObjectBase.prototype.m_ignoreTransparentArea=false;DWGraphicalObjectBase.prototype.setIgnoreTransparentArea=function(v){this.m_ignoreTransparentArea=v;return this;};DWGraphicalObjectBase.prototype.m_collisionsRegistered=false;DWGraphicalObjectBase.prototype.m_collisionSlaves=null;DWGraphicalObjectBase.prototype.registerForCollisions=function(slaves){if(!this.m_collisionsRegistered){this.getPage().registerCollisionUpdates(this);this.m_collisionsRegistered=true;}if(this.m_collisionSlaves==null){this.m_collisionSlaves=new Array();}var slaveLength=this.m_collisionSlaves.length;for(var i=0;i<slaves.length;i++){var found=false;for(var j=0;j<slaveLength;j++){if(slaves[i]==this.m_collisionSlaves[j].obj){found=true;break;}}if(!found){var slave=new Object();slave.obj=slaves[i];slave.hit=false;this.m_collisionSlaves.push(slave);}}};DWGraphicalObjectBase.prototype.testCollisions=function(){if(this.m_collisionSlaves!=null){for(var i=0;i<this.m_collisionSlaves.length;i++){var b=this.collisionTest(this.m_collisionSlaves[i].obj);if(b&&(!this.m_collisionSlaves[i].hit)){this.m_collisionSlaves[i].hit=true;this.triggerEvents(new DWCollisionTrigger(0x810001,this.m_collisionSlaves[i].obj));}else{if((!b)&&this.m_collisionSlaves[i].hit){this.m_collisionSlaves[i].hit=false;this.triggerEvents(new DWCollisionTrigger(0x810002,this.m_collisionSlaves[i].obj));}}if(this.m_collisionSlaves==null){break;}}}};DWGraphicalObjectBase.prototype.collisionTest=function(other){if(this.m_ignoreTransparentArea){return DWCollision.test(this,other);}else{var pts1=this.getTransformedOuterPoints();var pts2=other.getTransformedOuterPoints();if(DWGeometry.intersectPolygons(pts1,pts2)){return true;}}return false;};DWGraphicalObjectBase.prototype.m_draggable=false;DWGraphicalObjectBase.prototype.m_droppedOn=null;DWGraphicalObjectBase.prototype.m_dragReturn=0;DWGraphicalObjectBase.prototype.m_dragRestrict=false;DWGraphicalObjectBase.prototype.m_dragDropController=null;DWGraphicalObjectBase.prototype.enableDrag=function(dragReturn,dragRestrict){this.m_dragReturn=dragReturn;this.m_dragRestrict=dragRestrict;this.m_draggable=true;this.m_dragDropController=new DWDragDropController(this,dragReturn,dragRestrict);return this;};DWGraphicalObjectBase.prototype.m_drop=false;DWGraphicalObjectBase.prototype.m_dropRedrag=false;DWGraphicalObjectBase.prototype.m_dropFitInside=false;DWGraphicalObjectBase.prototype.m_dropRestoreOnPageLoad=false;DWGraphicalObjectBase.prototype.m_dropPushOutExisting=false;DWGraphicalObjectBase.prototype.m_dropLimit=0;DWGraphicalObjectBase.prototype.m_dropArrangeMode=0;DWGraphicalObjectBase.prototype.m_dropObjects=null;DWGraphicalObjectBase.prototype.m_droppedObjects=null;DWGraphicalObjectBase.prototype.enableDrop=function(redrag,fitInside,restoreOnPageLoad,pushOutExisting,dropLimit,arrange){this.m_drop=true;this.m_dropRedrag=redrag;this.m_dropFitInside=fitInside;this.m_dropRestoreOnPageLoad=restoreOnPageLoad;this.m_dropPushOutExisting=pushOutExisting;this.m_dropLimit=dropLimit;this.m_dropArrangeMode=arrange;this.m_droppedObjects=new DWList();return this;};DWGraphicalObjectBase.prototype.setDropObjects=function(){this.m_dropObjects=arguments;return this;};DWGraphicalObjectBase.prototype.isDropEnabled=function(){return this.m_drop;};DWGraphicalObjectBase.prototype.isDropFitInside=function(){return this.m_dropFitInside;};DWGraphicalObjectBase.prototype.isRedragEnabled=function(){return this.m_dropRedrag;};DWGraphicalObjectBase.prototype.isDropZoneFull=function(){if((this.m_dropLimit!=(-1))&&(this.m_droppedObjects!=null)&&(this.m_droppedObjects.size()>=this.m_dropLimit)){return true;}return false;};DWGraphicalObjectBase.prototype.canDrop=function(object){if((!this.isObjectEnabled())||(this.m_visible!=2)){return false;}if(this.isDropZoneFull()&&(!this.m_dropPushOutExisting)){return false;}if(this.m_dropObjects){for(var i=0;i<this.m_dropObjects.length;i++){if(this.m_dropObjects[i].compare(object.getObjectCode())){return true;}}return false;}return true;};DWGraphicalObjectBase.prototype.dropObject=function(object){if(this.m_droppedObjects.find(object)!=null){;return;}if(this.isDropZoneFull()){if(!this.m_dropPushOutExisting){;return;}var it=this.m_droppedObjects.getHeadPosition();var obj=this.m_droppedObjects.getItem(it);this.unDropObject(obj);}this.triggerEvents(new DWDropTrigger(0x800201,object.getObjectCode()));this.m_droppedObjects.push(object);object.thisObjectDropped(this);if(this.isDropZoneFull()){this.setBaseAppearance(0x35);this.triggerEvents(new DWDropTrigger(0x800203));}else{this.setBaseAppearance(0x34);}if(this.m_dropArrangeMode==1){var rect=this.getTransformedBoundingRect();var centre=rect.centre();object.setTranslate(0,0);var rd=object.getTransformedBoundingRect();object.setTranslate(centre.x-rd.centre().x,centre.y-rd.centre().y);}else{if(this.m_dropArrangeMode==2){this.arrangeDroppedObjects();}}};DWGraphicalObjectBase.prototype.unDropThisObject=function(){if(this.m_droppedOn!=null){this.m_droppedOn.unDropObject(this,true);}};DWGraphicalObjectBase.prototype.unDropObject=function(object,dontAnimate){if(dontAnimate==undefined)dontAnimate=false;var it=this.m_droppedObjects.find(object);if(it==null){;return;}this.m_droppedObjects.remove(it);object.thisObjectUnDropped(this,dontAnimate);this.triggerEvents(new DWDropTrigger(0x800202,object.getObjectCode()));if(this.isDropZoneFull()){this.setBaseAppearance(0x35);}else{if(this.m_droppedObjects.size()){this.setBaseAppearance(0x34);}else{this.setBaseAppearance(1);}}};DWGraphicalObjectBase.prototype.arrangeDroppedObjects=function(){if(this.m_droppedObjects.size()){var maxWidth=0;var maxHeight=0;var it=this.m_droppedObjects.getHeadPosition();while(it!=null){var dragObject=this.m_droppedObjects.getItem(it);if(dragObject.getWidth()>maxWidth){maxWidth=dragObject.getWidth();}if(dragObject.getHeight()>maxHeight){maxHeight=dragObject.getHeight();}it=this.m_droppedObjects.getNext(it);}var xSpace=maxWidth/8;var ySpace=maxHeight/8;var xCount=Math.floor((this.getWidth()-xSpace)/(maxWidth+xSpace));if(xCount<=0){xCount=1;xSpace=0;}var yCount=Math.floor((this.getHeight()-ySpace)/(maxHeight+ySpace));if(yCount<=0){yCount=1;ySpace=0;}var xs=xSpace;if((xCount*(xSpace+maxWidth))<(this.getWidth()-xSpace)){xs+=(((this.getWidth()-xSpace)-(xCount*(xSpace+maxWidth)))/2);}xs+=(maxWidth/2);var yStep=ySpace+maxHeight;var y=ySpace+(yStep/2);var rows=Math.floor((this.m_droppedObjects.size()/xCount))+(((this.m_droppedObjects.size()%xCount)!=0)?1:0);if((rows*yStep)>(this.getHeight()-ySpace)){yStep=this.getHeight()/rows;y=yStep/2;}xs-=(this.getWidth()/2);y-=(this.getHeight()/2);var x=xs;var it=this.m_droppedObjects.getHeadPosition();while(it!=null){var dragObject=this.m_droppedObjects.getItem(it);var point=new DWPoint(x,y);point=this.pointToPage(point);if(dragObject.getParent().isGraphicalObject()){point=dragObject.getParent().pointFromPage(point);}point=point.subtract(dragObject.getParentOffset());dragObject.setTranslate(point.x,point.y);x+=(xSpace+maxWidth);if(x>=((this.getWidth()-xSpace)-(this.getWidth()/2))){x=xs;y+=yStep;}it=this.m_droppedObjects.getNext(it);}}};DWGraphicalObjectBase.prototype.thisObjectDropped=function(dropZone){this.m_droppedOn=dropZone;this.setBaseAppearance(0x3f);this.triggerEvents(new DWDropTrigger(0x800204));};DWGraphicalObjectBase.prototype.thisObjectUnDropped=function(dropZone,dontAnimate){if(dontAnimate==undefined)dontAnimate=false;this.m_droppedOn=null;this.setBaseAppearance(1);if(!this.m_dragDropController.isDragging()){this.m_dragDropController.returnObject(dontAnimate);}};DWGraphicalObjectBase.prototype.isDropped=function(){return this.m_droppedOn!=null;};DWGraphicalObjectBase.prototype.getDroppedOn=function(){return this.m_droppedOn;};DWGraphicalObjectBase.prototype.addChild=function(child){if(!this.m_children){this.m_children=new Array();}this.m_children.push(child);child.setParent(this);if(child.isGraphicalObject()){var gr=child;if((gr.element()!=null)&&(this.m_element==null)){this.m_adapter.addSlave(gr.getAdapter());}}return this;};DWGraphicalObjectBase.prototype.addChildren=function(){for(var i=0;i<arguments.length;i++){this.addChild(arguments[i]);}return this;};DWGraphicalObjectBase.prototype.getChildren=function(){return this.m_children;};DWGraphicalObjectBase.prototype.setParent=function(parent){this.m_parent=parent;this.m_adapter.setParentAdapter(parent.getAdapter());};DWGraphicalObjectBase.prototype.m_enabled=true;DWGraphicalObjectBase.prototype.m_initiallyDisabled=false;DWGraphicalObjectBase.prototype.setInitiallyDisabled=function(s){this.m_initiallyDisabled=s;return this;};DWGraphicalObjectBase.prototype.isObjectEnabled=function(){return this.m_enabled;};DWGraphicalObjectBase.prototype.enable=function(){if(!this.m_enabled){this.setBaseAppearance(1);this.m_enabled=true;}};DWGraphicalObjectBase.prototype.disable=function(){if(this.m_enabled){this.setBaseAppearance(4);this.m_enabled=false;}};DWGraphicalObjectBase.prototype.startObject=function(parentVisible){this.m_droppedOn=null;this.m_droppedObjects=new DWList();this.resetPosition();this.setAppearanceModifier(1);this.m_enabled=!this.m_initiallyDisabled;this.m_visible=0;var visible=parentVisible&&this.m_initiallyVisible&&(this.m_showTransition==null);if(!visible){this.m_adapter.hide();}if(this.m_actions){this.m_actions.initEvents(this);}if(this.m_globalCode){var it=this.m_globalCode.getHeadPosition();while(it){var fn=this.m_globalCode.getItem(it);fn.call(this);it=this.m_globalCode.getNext(it);}}for(var i=0;i<this.m_children.length;i++){this.m_children[i].startObject(visible);}if(parentVisible){this.onShowParentFinished();}};DWGraphicalObjectBase.prototype.stopObject=function(){this.m_adapter.hide();if(this.m_actions){this.m_actions.closeEvents(this);}for(var i=0;i<this.m_children.length;i++){this.m_children[i].stopObject(false);}this.m_collisionSlaves=null;this.m_collisionsRegistered=false;};DWGraphicalObjectBase.prototype.m_showTransitionInstance=null;DWGraphicalObjectBase.prototype.m_hideTransitionInstance=null;DWGraphicalObjectBase.prototype.doShow=function(transition){if(transition==undefined)transition=null;if(!transition){transition=this.m_showTransition;}if(this.m_visible==3){if(this.m_hideTransitionInstance){this.m_hideTransitionInstance.cancel();this.m_hideTransitionInstance=null;}if(this.m_hideActionCallback){this.m_hideActionCallback.Notify(0);this.m_hideActionCallback=null;}this.m_adapter.hide();this.m_visible=0;transition=null;}if(this.m_visible==0){this.resetPosition();this.m_adapter.show();for(var i=0;i<this.m_children.length;i++){this.m_children[i].onShowParent();}if(transition){this.m_visible=1;this.m_showTransitionInstance=transition.createInstance(this);this.m_showTransitionInstance.start(this.onShowFinished.bind(this));}else{this.m_visible=2;this.onShowFinished();}}};DWGraphicalObjectBase.prototype.onShowFinished=function(){if(this.m_showTransitionInstance){this.m_showTransitionInstance=null;}this.m_visible=2;if(this.m_showActionCallback){this.m_showActionCallback.Notify(0);this.m_showActionCallback=null;}for(var i=0;i<this.m_children.length;i++){this.m_children[i].onShowParentFinished();}this.trigger("OnShow");if(this.m_showFor!=(-1)){new DWDelayedCall(this.doShowFor.bind(this),this.m_showFor);}};DWGraphicalObjectBase.prototype.doShowFor=function(){if(this.m_visible==2){this.doHide();}};DWGraphicalObjectBase.prototype.doHide=function(transition){if(transition==undefined)transition=null;if(transition==null){transition=this.m_hideTransition;}if(this.m_visible==1){if(this.m_showTransitionInstance){this.m_showTransitionInstance.cancel();this.m_showTransitionInstance=null;}if(this.m_showActionCallback){this.m_showActionCallback.Notify(0);this.m_showActionCallback=null;}this.m_adapter.hide();this.m_visible=2;transition=null;}if(this.m_visible==2){if(transition){this.m_visible=3;this.m_hideTransitionInstance=transition.createInstance(this);this.m_hideTransitionInstance.start(this.onHideFinished.bind(this));}else{this.onHideFinished();}}};DWGraphicalObjectBase.prototype.onHideFinished=function(){if(this.m_hideActionCallback){this.m_hideActionCallback.Notify(0);this.m_hideActionCallback=null;}this.m_adapter.hide();this.m_visible=0;for(var i=0;i<this.m_children.length;i++){this.m_children[i].onHideParent();}this.trigger("OnHide");};DWGraphicalObjectBase.prototype.onHideParent=function(){if(this.m_visible==2){this.m_adapter.hide();this.m_visible=0;this.trigger("OnHide");for(var i=0;i<this.m_children.length;i++){this.m_children[i].onHideParent();}}};DWGraphicalObjectBase.prototype.onShowParent=function(){if(this.m_initiallyVisible&&(this.m_showTransition==null)){this.doShow();}};DWGraphicalObjectBase.prototype.onShowParentFinished=function(){if(this.m_initiallyVisible){this.doShow();}else{if(this.m_showAfter!=(-1)){new DWDelayedCall(this.doShowAfter.bind(this),this.m_showAfter);}}};DWGraphicalObjectBase.prototype.doShowAfter=function(){if(this.m_visible==0){this.doShow();}};DWGraphicalObjectBase.prototype.m_baseAppearance=1;DWGraphicalObjectBase.prototype.m_appearanceModifier=1;DWGraphicalObjectBase.prototype.setBaseAppearance=function(handle){this.m_baseAppearance=handle;this.updateAppearance();};DWGraphicalObjectBase.prototype.setAppearanceModifier=function(handle){this.m_appearanceModifier=handle;this.updateAppearance();};DWGraphicalObjectBase.prototype.m_updateAppearanceScheduled=false;DWGraphicalObjectBase.prototype.updateAppearance=function(){if(!this.m_updateAppearanceScheduled){DWUpdateController.addOneShotUpdateCall(this.doUpdateAppearance.bind(this));this.m_updateAppearanceScheduled=true;}};DWGraphicalObjectBase.prototype.doUpdateAppearance=function(){this.m_updateAppearanceScheduled=false;switch(this.m_baseAppearance){case 1:this.setAppearance(this.m_appearanceModifier);break;case 5:switch(this.m_appearanceModifier){case 2:case 3:this.setAppearance(6);break;case 1:this.setAppearance(5);break;}break;case 4:this.setAppearance(this.m_baseAppearance);break;default:this.setAppearance(this.m_baseAppearance);break;}};DWGraphicalObjectBase.prototype.setAppearance=function(handle){if(this.m_appearances!=null){var app=this.m_appearances[handle];if(app!=undefined){app.apply(this);}}};DWGraphicalObjectBase.prototype.m_showActionCallback=null;DWGraphicalObjectBase.prototype.showAction=function(transition,callback){if((this.m_visible==0)||(this.m_visible==3)){this.m_showActionCallback=callback;this.doShow(transition);return 1;}return 0;};DWGraphicalObjectBase.prototype.m_hideActionCallback=null;DWGraphicalObjectBase.prototype.hideAction=function(transition,callback){if((this.m_visible==2)||(this.m_visible==1)){this.m_hideActionCallback=callback;this.doHide(transition);return 1;}return 0;};DWGraphicalObjectBase.prototype.getScrollableContent=function(scrollRange){return null;};DWGraphicalObjectBase.prototype.m_scrollPosX=0;DWGraphicalObjectBase.prototype.m_scrollPosY=0;DWGraphicalObjectBase.prototype.getScrollPosition=function(){return new DWPoint(this.m_scrollPosX,this.m_scrollPosY);};DWGraphicalObjectBase.prototype.getScrollRange=function(){var pt=new DWPoint();this.getScrollableContent(pt);return pt;};DWGraphicalObjectBase.prototype.getScrollPage=function(){return new DWPoint(this.getWidth(),this.getHeight());};DWGraphicalObjectBase.prototype.setScrollPosition=function(x,y){var ptRange=new DWPoint();var element=this.getScrollableContent(ptRange);this.m_scrollPosX=x;if(this.m_scrollPosX<0)this.m_scrollPosX=0;if(this.m_scrollPosX>=ptRange.x)this.m_scrollPosX=ptRange.x-1;this.m_scrollPosY=y;if(this.m_scrollPosY<0)this.m_scrollPosY=0;if(this.m_scrollPosY>ptRange.y)this.m_scrollPosY=ptRange.y;if(element){DWSVGHelper.setTransform(element,new DWPoint(-this.m_scrollPosX,-this.m_scrollPosY));if(this.m_scrollCallbacks){for(var i=0;i<this.m_scrollCallbacks.length;i++){var fn=this.m_scrollCallbacks[i];fn();}}}};DWGraphicalObjectBase.prototype.scrollAction=function(actionCode,vertical){var scrollX=this.m_scrollPosX;var scrollY=this.m_scrollPosY;if(vertical){switch(actionCode){case 0x1f6:case 0x1fc:scrollY-=10;break;case 0x1f7:case 0x1fd:scrollY+=10;break;case 0x1fa:case 0x1f8:scrollY-=0x32;break;case 0x1f9:case 0x1fb:scrollY+=0x32;break;case 0x1ff:scrollY=0;break;case 0x200:scrollY=0x1f4;break;}}else{switch(actionCode){case 0x1f6:case 0x1fc:scrollX-=10;break;case 0x1f7:case 0x1fd:scrollX+=10;break;case 0x1fa:case 0x1f8:scrollX-=0x32;break;case 0x1f9:case 0x1fb:scrollX+=0x32;break;case 0x1ff:scrollX=0;break;case 0x200:scrollX=0x1f4;break;}}this.setScrollPosition(scrollX,scrollY);return 0;};DWGraphicalObjectBase.prototype.m_scrollCallbacks=null;DWGraphicalObjectBase.prototype.registerScrollCallback=function(fn){if(!this.m_scrollCallbacks)this.m_scrollCallbacks=new Array();this.m_scrollCallbacks.push(fn);};DWGraphicalObjectBase.prototype.onMouseDown=function(e){if(this.m_enabled){DWHotspot.prototype.onMouseDown.call(this,e);if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.hitTest(new DWPoint(e.clientX,e.clientY))){this.m_children[i].onMouseDown(e);if(e.propagation==false){break;}}}}}if(e.propagation){this.setAppearanceModifier(3);if(this.m_dragDropController&&(!this.m_dragDropController.isReturning())){if((this.m_droppedOn==null)||this.m_droppedOn.isRedragEnabled()){this.m_dragDropController.beginDrag(new DWPoint(e.clientX,e.clientY));e.preventDefault();e.stopPropagation();}}}}};DWGraphicalObjectBase.prototype.onMouseUp=function(e){if(this.m_enabled){DWHotspot.prototype.onMouseUp.call(this,e);if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.hitTest(new DWPoint(e.clientX,e.clientY))){this.m_children[i].onMouseUp(e);if(e.propagation==false){break;}}}}}if(e.propagation){this.setAppearanceModifier(2);if(this.m_dragDropController&&this.m_dragDropController.isDragging()){this.m_dragDropController.endDrag(new DWPoint(e.clientX,e.clientY));e.preventDefault();e.stopPropagation();}}}};DWGraphicalObjectBase.prototype.onMouseOver=function(e){if(this.m_enabled){DWHotspot.prototype.onMouseOver.call(this,e);this.setAppearanceModifier(2);}};DWGraphicalObjectBase.prototype.onMouseOut=function(e){if(this.m_enabled){DWHotspot.prototype.onMouseOut.call(this,e);this.setAppearanceModifier(1);}};DWGraphicalObjectBase.prototype.onClick=function(e){if(this.m_enabled){DWHotspot.prototype.onClick.call(this,e);}};DWGraphicalObjectBase.prototype.onMouseMove=function(e){if(this.m_enabled){DWHotspot.prototype.onMouseMove.call(this,e);if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){this.m_children[i].onMouseMove(e);}}}if(this.m_dragDropController&&this.m_dragDropController.isDragging()){this.m_dragDropController.updateDrag(new DWPoint(e.clientX,e.clientY));e.preventDefault();e.stopPropagation();}}};DWGraphicalObjectBase.prototype.m_touched=false;DWGraphicalObjectBase.prototype.onTouchStart=function(e){this.m_touched=true;if(this.m_enabled){DWHotspot.prototype.onTouchStart.call(this,e);this.setAppearanceModifier(3);if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.hitTest(new DWPoint(e.clientX,e.clientY))){this.m_children[i].onTouchStart(e);if(e.propagation==false){break;}}}}}if(this.m_dragDropController){if((this.m_droppedOn==null)||this.m_droppedOn.isRedragEnabled()){this.m_dragDropController.beginDrag(new DWPoint(e.clientX,e.clientY));e.stopPropagation();e.preventDefault();}}}};DWGraphicalObjectBase.prototype.onTouchMove=function(e){if(this.m_enabled){if(this.m_dragDropController){if(this.m_dragDropController&&this.m_dragDropController.isDragging()){this.m_dragDropController.updateDrag(new DWPoint(e.clientX,e.clientY));e.preventDefault();e.stopPropagation();}}DWHotspot.prototype.onTouchMove.call(this,e);if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];this.m_children[i].onTouchMove(e);}}}}};DWGraphicalObjectBase.prototype.onTouchEnd=function(e){if(this.m_touched){if(this.m_dragDropController&&this.m_dragDropController.isDragging()){this.m_dragDropController.endDrag(new DWPoint(e.clientX,e.clientY));e.preventDefault();e.stopPropagation();}else{if(this.m_enabled){DWHotspot.prototype.onTouchEnd.call(this,e);}}if(this.m_enabled){this.setAppearanceModifier(1);if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];this.m_children[i].onTouchEnd(e);}}}}}this.m_touched=false;};DWGraphicalObjectBase.prototype.setCapture=function(){this.getPage().setCapture(this);};DWGraphicalObjectBase.prototype.releaseCapture=function(){this.getPage().releaseCapture(this);};DWGraphicalObjectBase.prototype.m_globalCode=null;DWGraphicalObjectBase.prototype.addGlobalCode=function(fn){if(!this.m_globalCode){this.m_globalCode=new DWList();}this.m_globalCode.addTail(fn);return this;};DWGraphicalObjectBase.prototype.m_animationController=null;DWGraphicalObjectBase.prototype.getAnimationController=function(){if(this.m_animationController==null){this.m_animationController=new DWAnimationController(this);}return this.m_animationController;};DWGraphicalObjectBase.prototype.stopAnimation=function(code){this.getAnimationController().remove(code);};DWGraphicalObjectBase.prototype.resetPosition=function(){this.m_transform.copyFrom(this.m_initTransform);this.m_alpha=this.m_initAlpha;this.m_adapter.updateTransform();this.m_adapter.setAlpha(this.m_alpha);};DWGraphicalObjectBase.prototype.setInitialAlpha=function(alpha){this.m_initAlpha=alpha;return this;};DWGraphicalObjectBase.prototype.getInitialAlpha=function(){return this.m_initAlpha;};DWGraphicalObjectBase.prototype.getInitialScale=function(){return this.m_initTransform.getScale();};DWGraphicalObjectBase.prototype.getInitialRotate=function(){return this.m_initTransform.getRotate();};DWGraphicalObjectBase.prototype.getInitialTranslate=function(){return this.m_initTransform.getTranslate();};DWGraphicalObjectBase.prototype.setInitialEffectsTransforms=function(rotate,scaleX,scaleY,skewX,skewY){if(rotate==undefined)rotate=0;if(scaleX==undefined)scaleX=1;if(scaleY==undefined)scaleY=1;if(skewX==undefined)skewX=0;if(skewY==undefined)skewY=0;this.m_initTransform.setRotate(rotate);this.m_initTransform.setScale(scaleX,scaleY);this.m_initTransform.setSkew(skewX,skewY);return this;};DWGraphicalObjectBase.prototype.setInitialPreTranslate=function(x,y){this.m_initTransform.setPreTranslate(x,y);return this;};DWGraphicalObjectBase.prototype.setAlpha=function(alpha){this.m_alpha=alpha;this.m_adapter.setAlpha(alpha);};DWGraphicalObjectBase.prototype.getAlpha=function(){return this.m_alpha;};DWGraphicalObjectBase.prototype.setPreTranslate=function(x,y){this.m_transform.setPreTranslate(x,y);this.m_adapter.updateTransform();};DWGraphicalObjectBase.prototype.getPreTranslate=function(){return this.m_transform.getPreTranslate();};DWGraphicalObjectBase.prototype.setScale=function(scaleX,scaleY){this.m_transform.setScale(scaleX,scaleY);this.m_adapter.updateTransform();};DWGraphicalObjectBase.prototype.getScale=function(){return this.m_transform.getScale();};DWGraphicalObjectBase.prototype.setRotate=function(rotate){this.m_transform.setRotate(rotate);this.m_adapter.updateTransform();};DWGraphicalObjectBase.prototype.getRotate=function(){return this.m_transform.getRotate();};DWGraphicalObjectBase.prototype.setTranslate=function(x,y){this.m_transform.setTranslate(x,y);this.m_adapter.updateTransform();};DWGraphicalObjectBase.prototype.getTranslate=function(){return this.m_transform.getTranslate();};DWGraphicalObjectBase.prototype.setSkew=function(x,y){this.m_transform.setSkew(x,y);this.m_adapter.updateTransform();};DWGraphicalObjectBase.prototype.getSkew=function(){return this.m_transform.getSkew();};DWGraphicalObjectBase.prototype.setTransform=function(translate,scale,rotate){if(this.m_transform.setTransform(translate,scale,rotate)){this.m_adapter.updateTransform();}};DWGraphicalObjectBase.prototype.getTransform=function(){return this.m_transform;};DWGraphicalObjectBase.prototype.m_width=null;DWGraphicalObjectBase.prototype.m_height=null;DWGraphicalObjectBase.prototype.setSize=function(width,height){this.m_width=width;this.m_height=height;return this;};DWGraphicalObjectBase.prototype.getWidth=function(){return this.m_width;};DWGraphicalObjectBase.prototype.getHeight=function(){return this.m_height;};DWGraphicalObjectBase.prototype.m_parentOffset=null;DWGraphicalObjectBase.prototype.setParentOffset=function(x,y){this.m_parentOffset=new DWPoint(x,y);this.m_initTransform.setBaseTranslate(x,y);this.m_transform.setBaseTranslate(x,y);return this;};DWGraphicalObjectBase.prototype.getParentOffset=function(){return this.m_parentOffset;};DWGraphicalObjectBase.prototype.m_divObjectOffset=null;DWGraphicalObjectBase.prototype.setDivObjectOffset=function(x,y){this.m_divObjectOffset=new DWPoint(x,y);return this;};DWGraphicalObjectBase.prototype.getDivObjectOffset=function(){return this.m_divObjectOffset;};DWGraphicalObjectBase.prototype.hitTest=function(ptPage){if(this.m_visible==2){var pt=this.pointFromPage(ptPage);var r=new DWRect((-this.m_width)/2,(-this.m_height)/2,this.m_width,this.m_height);if(r.containsPoint(pt)){return true;}}return false;};DWGraphicalObjectBase.prototype.pointToParent=function(pt){return this.m_transform.pointToParent(pt);};DWGraphicalObjectBase.prototype.pointToPage=function(pt){var p=this.m_transform.pointToParent(pt);return this.m_parent.pointToPage(p);};DWGraphicalObjectBase.prototype.pointFromParent=function(pt){return this.m_transform.pointFromParent(pt);};DWGraphicalObjectBase.prototype.pointFromPage=function(pt){var p=this.m_parent.pointFromPage(pt);return this.m_transform.pointFromParent(p);};DWGraphicalObjectBase.prototype.getTransformedBoundingRect=function(){var pts=this.getTransformedOuterPoints();var r=DWRect.fromPoints(pts);return r;};DWGraphicalObjectBase.prototype.getTransformedOuterPoints=function(){var pts=new Array();pts.push(new DWVertex((-this.m_width)/2,(-this.m_height)/2,1));pts.push(new DWVertex(this.m_width/2,(-this.m_height)/2,2));pts.push(new DWVertex(this.m_width/2,this.m_height/2,2));pts.push(new DWVertex((-this.m_width)/2,this.m_height/2,2));for(var i=0;i<4;i++){var pt=this.pointToPage(pts[i]);pts[i].x=pt.x;pts[i].y=pt.y;}return pts;};DWGraphicalObjectBase.prototype.setDisplayFrame=function(frame){};DWGraphicalObjectBase.prototype.applyTransformToCanvas=function(ctx){this.m_parent.applyTransformToCanvas(ctx);this.m_transform.applyToCanvas(ctx);};DWGraphicalObjectBase.prototype.drawContentCanvas=function(ctx){};DWGraphicalObjectBase.prototype.Show=function(){if(this.m_visible!=2){this.doShow();}};DWGraphicalObjectBase.prototype.Hide=function(){if(this.m_visible!=0){this.doHide();}};DWGraphicalObject=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObjectBase.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWGraphicalObject,DWGraphicalObjectBase);DWGraphicalObject.prototype.IsShowing=function(){return this.m_visible==2;};DWGraphicalObject.prototype.Show=function(){this.doShow();};DWGraphicalObject.prototype.Hide=function(){this.doHide();};DWGraphicalObject.prototype.GetXPosition=function(){return this.GetPosition().x;};DWGraphicalObject.prototype.GetYPosition=function(){return this.GetPosition().y;};DWGraphicalObject.prototype.GetWidth=function(){return this.getWidth();};DWGraphicalObject.prototype.GetHeight=function(){return this.getHeight();};DWGraphicalObject.prototype.GetPosition=function(){var r=this.getTransformedBoundingRect();return r.center();};DWGraphicalObject.prototype.SetPosition=function(x,y,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;if(time==0){var objOffset=this.getParentOffset();var parent=this.getParent();if((parent!=null)&&parent.isGraphicalObject()){objOffset=new DWPoint(objOffset.x+(parent.getWidth()/2),objOffset.y+(parent.getHeight()/2));}var sx=x-objOffset.x;var sy=y-objOffset.y;this.setTranslate(sx,sy);}else{var r=new DWAnimateMove(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,x,y,this,callback);r.Go();}};DWGraphicalObject.prototype.SetXPosition=function(x,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateMove(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,x,null,this,callback);r.Go();};DWGraphicalObject.prototype.SetPositionX=function(x,time,callback){if(callback==undefined)callback=null;this.SetXPosition(x,time,callback);};DWGraphicalObject.prototype.SetYPosition=function(y,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateMove(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,null,y,this,callback);r.Go();};DWGraphicalObject.prototype.SetPositionY=function(y,time,callback){if(callback==undefined)callback=null;this.SetYPosition(y,time,callback);};DWGraphicalObject.prototype.Move=function(x,y,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateMove(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,x,y,this,callback);r.Go();};DWGraphicalObject.prototype.MoveX=function(x,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateMove(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,x,null,this,callback);r.Go();};DWGraphicalObject.prototype.MoveY=function(y,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateMove(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,null,y,this,callback);r.Go();};DWGraphicalObject.prototype.Fade=function(transparency,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateFade(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,transparency,this,callback);r.Go();};DWGraphicalObject.prototype.SetTransparency=function(transparency,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateFade(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,transparency,this,callback);r.Go();};DWGraphicalObject.prototype.SetRotation=function(angle,clockwise,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;if(time==0){this.setRotate(angle);}else{var current=this.getRotate();if(current!=angle){if(clockwise){while(angle<current)angle+=0x168;}else{while(angle>current)angle-=0x168;}}var r=new DWAnimateRotate(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,angle,this,callback);r.Go();}};DWGraphicalObject.prototype.Rotate=function(angle,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateRotate(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,angle,this,callback);r.Go();};DWGraphicalObject.prototype.Scale=function(x,y,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateScale(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,x*0x64,y*0x64,this,callback);r.Go();};DWGraphicalObject.prototype.ScaleH=function(x,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateScale(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,x*0x64,null,this,callback);r.Go();};DWGraphicalObject.prototype.ScaleV=function(y,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateScale(time*0x3e8,1,0,true,DWAnimationSpeed.Constant,null,y*0x64,this,callback);r.Go();};DWGraphicalObject.prototype.SetScale=function(x,y,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;if(time==0){this.setScale(x,y);}else{var r=new DWAnimateScale(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,x*0x64,y*0x64,this,callback);r.Go();}};DWGraphicalObject.prototype.SetScaleH=function(x,time,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateScale(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,x*0x64,null,this,callback);r.Go();};DWGraphicalObject.prototype.SetScaleV=function(y,time,callback,callback){if(time==undefined)time=0;if(callback==undefined)callback=null;var r=new DWAnimateScale(time*0x3e8,1,0,false,DWAnimationSpeed.Constant,null,y*0x64,this,callback);r.Go();};DWGraphicalObject.getAnimationCode=function(code){var codes=["rotate",0x10,"scale",0x60,"scaleh",0x20,"scalev",0x40,"move",3,"movex",1,"movey",2,"fade",0x800,"path",0x1000,"all",-1];var value=code.split("|");var result=0;for(var i=0;i<value.length;i++){for(var j=0;j<codes.length;j+=2){if(value[i].toLowerCase()==codes[j]){result|=codes[(j+1)];break;}}}return result;};DWGraphicalObject.prototype.StopAnimation=function(animations){this.stopAnimation(DWGraphicalObject.getAnimationCode(animations));};DWGraphicalObject.prototype.ResetAnimation=function(animations,time,callback){if(callback==undefined)callback=null;var r=new DWAnimateReset(t*0x3e8,DWAnimationSpeed.Constant,DWGraphicalObject.getAnimationCode(animations),this,callback);r.Go();};DWGraphicalObject.prototype.FollowPath=function(path,time,absolute,orientation,start,end,callback){if(time==undefined)time=0;if(absolute==undefined)absolute=true;if(orientation==undefined)orientation=false;if(start==undefined)start=0;if(end==undefined)end=0x64;if(callback==undefined)callback=null;var r=new DWAnimatePath(time*0x3e8,1,0,!absolute,DWAnimationSpeed.Constant,path,orientation,start/0x64,end/0x64,this,callback);r.Go();};DWGraphicalObject.prototype.Enable=function(val){if(val){this.enable();}else{this.disable();}};DWGraphicalObject.prototype.IsEnabled=function(){return this.isObjectEnabled();};DWGraphicalObject.prototype.CaptureMouse=function(){this.setCapture();};DWGraphicalObject.prototype.ReleaseMouse=function(){this.releaseCapture();};DWGraphicalObject.prototype.IsObjectIntersecting=function(obj){return this.collisionTest(obj);};DWBrowser=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY,url,border){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);this.m_url=url;this.m_border=border;};__inherit(DWBrowser,DWGraphicalObject);DWBrowser.prototype.m_iframeElement=null;DWBrowser.prototype.m_url=null;DWBrowser.prototype.m_border=false;DWBrowser.prototype.type=function(){return "Browser";};DWBrowser.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);this.m_iframeElement=document.createElement("iframe");this.m_iframeElement.setAttribute("width",String((this.m_border?this.getWidth()-4:this.getWidth())));this.m_iframeElement.setAttribute("height",String((this.m_border?this.getHeight()-4:this.getHeight())));this.m_iframeElement.setAttribute("src",this.m_url);this.m_iframeElement.style.setProperty("border-width",(this.m_border?"2px":"0px"),"important");this.m_element.appendChild(this.m_iframeElement);};DWBrowser.prototype.stopObject=function(){DWGraphicalObject.prototype.stopObject.call(this);if(this.m_iframeElement){this.m_element.removeChild(this.m_iframeElement);this.m_iframeElement=null;}};DWBrowser.prototype.navigateToVariable=function(variable){var url=String(DWVariables.instance().getValue(variable));this.Navigate(url);};DWBrowser.prototype.Stop=function(){};DWBrowser.prototype.Home=function(){this.m_iframeElement.contentWindow.history.home();};DWBrowser.prototype.Forward=function(){this.m_iframeElement.contentWindow.history.forward();};DWBrowser.prototype.Back=function(){this.m_iframeElement.contentWindow.history.back();};DWBrowser.prototype.Navigate=function(url){this.m_iframeElement.src=url;};DWBrowser.prototype.Print=function(){};DWBrowser.prototype.Refresh=function(){this.m_iframeElement.contentWindow.location.reload(true);};DWButton=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWButton,DWGraphicalObject);DWButton.prototype.type=function(){return "Button";};DWButton.prototype.m_state=0;DWButton.prototype.m_mode=0;DWButton.prototype.m_radioGroup=-1;DWButton.prototype.m_radioID=-1;DWButton.prototype.m_initiallyDown=false;DWButton.prototype.m_variable=null;DWButton.prototype.m_offset=0;DWButton.prototype.setMode=function(mode,radioGroup){if(radioGroup==undefined)radioGroup=-1;this.m_mode=mode;this.m_radioGroup=radioGroup;return this;};DWButton.prototype.setInitiallyDown=function(down){this.m_initiallyDown=down;return this;};DWButton.prototype.setVariable=function(varName){this.m_variable=varName;return this;};DWButton.prototype.setOffset=function(offset){this.m_offset=offset;return this;};DWButton.prototype.setImageArea=function(x,y,w,h){this.m_adapter.setImageArea(new DWRect(x,y,w,h));return this;};DWButton.prototype.buttonDown=function(){if(this.m_state!=1){this.m_state=1;if(this.isMouseOver()){this.setAppearance(6);}else{this.setAppearance(5);}this.setBaseAppearance(5);switch(this.m_mode){case 1:if(this.m_variable){DWVariables.instance().setValue(this.m_variable,true);}break;case 2:var page=this.getPage();this.updateRadioGroup(page);var varID="RADIO_GROUP_"+this.m_radioGroup+"_ID";var varName="RADIO_GROUP_"+this.m_radioGroup+"_NAME";DWVariables.instance().setValue(varID,this.m_radioID);DWVariables.instance().setValue(varName,this.getObjectName());break;}if(this.m_offset!=0){for(var i=0;i<this.m_children.length;i++){var child=this.m_children[i];child.setTranslate(this.m_offset,this.m_offset);}}this.trigger("OnButtonDown");}};DWButton.prototype.buttonUp=function(){if(this.m_state!=0){this.m_state=0;this.setBaseAppearance(1);if(!this.isMouseOver()){this.setAppearance(1);}else{this.setAppearance(2);}switch(this.m_mode){case 1:if(this.m_variable){DWVariables.instance().setValue(this.m_variable,false);break;}}if(this.m_offset!=0){for(var i=0;i<this.m_children.length;i++){var child=this.m_children[i];child.setTranslate(0,0);}}this.trigger("OnButtonUp");}};DWButton.prototype.updateRadioGroup=function(parent){var children=parent.getChildren();if(children){for(var i=0;i<children.length;i++){var child=children[i];if(child.type()=="Button"){var btn=child;if((btn!=this)&&(btn.m_radioGroup==this.m_radioGroup)){btn.buttonUp();}}this.updateRadioGroup(child);}}};DWButton.prototype.doUpdateAppearance=function(){this.m_updateAppearanceScheduled=false;switch(this.m_baseAppearance){case 4:this.setAppearance((this.m_state==0?this.m_appearanceModifier:7));break;default:DWGraphicalObject.prototype.doUpdateAppearance.call(this);break;}};DWButton.prototype.enable=function(){DWGraphicalObject.prototype.enable.call(this);this.setAppearance((this.m_state==1?5:1));};DWButton.prototype.disable=function(){DWGraphicalObject.prototype.disable.call(this);this.setAppearance((this.m_state==1?7:4));};DWButton.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);if(this.m_mode==2){var count=0;this.calculateRadioId(this.getPage(),count);}if(this.m_initiallyDown){this.buttonDown();}else{this.buttonUp();}};DWButton.prototype.calculateRadioId=function(parent,cnt){var children=parent.getChildren();if(children){for(var i=0;i<children.length;i++){var child=children[i];if(child==this){this.m_radioID=cnt;break;}if(child.type()=="Button"){var btn=child;if((btn!=this)&&(btn.m_radioGroup==this.m_radioGroup)){cnt++;}}cnt=this.calculateRadioId(child,cnt);}}return cnt;};DWButton.prototype.onMouseDown=function(e){DWGraphicalObject.prototype.onMouseDown.call(this,e);if(this.isObjectEnabled()){switch(this.m_mode){case 0:if((this.m_state&1)==0){this.buttonDown();}break;case 1:if(this.m_state&1){this.m_state|=0x10;}else{this.buttonDown();}break;case 2:if(!(this.m_state&1)){this.buttonDown();}break;}this.setCapture();}};DWButton.prototype.onMouseUp=function(e){DWGraphicalObject.prototype.onMouseUp.call(this,e);if(this.isObjectEnabled()){switch(this.m_mode){case 0:this.buttonUp();break;case 1:if(this.m_state&0x10){this.buttonUp();}break;case 2:break;}}this.releaseCapture();};DWButton.prototype.onMouseOut=function(e){DWGraphicalObject.prototype.onMouseOut.call(this,e);if(this.isObjectEnabled()){switch(this.m_mode){case 0:this.buttonUp();break;}}this.releaseCapture();};DWButton.prototype.onTouchStart=function(e){DWGraphicalObject.prototype.onTouchStart.call(this,e);if(this.isObjectEnabled()&&(!(this.m_dragDropController&&this.m_dragDropController.isDragging()))){e.preventDefault();switch(this.m_mode){case 0:if((this.m_state&1)==0){this.buttonDown();}break;case 1:if(this.m_state&1){this.m_state|=0x10;}else{this.buttonDown();}break;case 2:if(!(this.m_state&1)){this.buttonDown();}break;}}};DWButton.prototype.onTouchMove=function(e){DWGraphicalObject.prototype.onTouchMove.call(this,e);};DWButton.prototype.onTouchEnd=function(e){DWGraphicalObject.prototype.onTouchEnd.call(this,e);if(this.isObjectEnabled()&&(!(this.m_dragDropController&&this.m_dragDropController.isDragging()))){e.preventDefault();switch(this.m_mode){case 0:this.buttonUp();break;case 1:if(this.m_state&0x10){this.buttonUp();}break;case 2:break;}}};DWButton.prototype.SetState=function(s){if(s){this.buttonDown();}else{this.buttonUp();}};DWButton.prototype.GetState=function(){return (this.m_state&1)!=0;};DWButtonElement=function(clrSurface,bevelWidth,clrLight,clrDark,outline,cornerRadius){if(cornerRadius==undefined)cornerRadius=0;this.m_clrSurface=clrSurface;this.m_clrLight=clrLight;this.m_clrDark=clrDark;this.m_bevelWidth=bevelWidth;this.m_outline=outline;this.m_cornerRadius=cornerRadius;};DWButtonElement.prototype.m_clrSurface=null;DWButtonElement.prototype.m_clrLight=null;DWButtonElement.prototype.m_clrDark=null;DWButtonElement.prototype.m_bevelWidth=null;DWButtonElement.prototype.m_outline=null;DWButtonElement.prototype.m_cornerRadius=null;DWButtonElement.prototype.apply=function(object){object.getAdapter().setButton(this.m_clrSurface,this.m_clrLight,this.m_clrDark,this.m_bevelWidth,this.m_outline,this.m_cornerRadius);};DWCBTAction=function(actionCode,questionCode,answerNumber){if(answerNumber==undefined)answerNumber=-1;this.m_actionCode=actionCode;this.m_questionCode=questionCode;this.m_answerNumber=answerNumber;};__inherit(DWCBTAction,DWAction);DWCBTAction.prototype.m_actionCode=null;DWCBTAction.prototype.m_questionCode=null;DWCBTAction.prototype.m_answerNumber=null;DWCBTAction.prototype.m_host=null;DWCBTAction.prototype.Go=function(callback){if(this.m_actionCode==0xbb9){DWCBTManager.instance().confirm(this.m_questionCode,this.m_host);}else{if(this.m_actionCode==0xbba){DWCBTManager.instance().answer(this.m_questionCode,this.m_answerNumber,this.m_host);}else{if(this.m_actionCode==0xbbc){DWCBTManager.instance().resetAnswer(this.m_questionCode,this.m_answerNumber,this.m_host);}else{if(this.m_actionCode==0xbbb){DWCBTManager.instance().reset(this.m_questionCode,this.m_host);}else{if(this.m_actionCode==0xbbd){DWCBTManager.instance().resetTopic(this.m_answerNumber,this.m_host);}else{if(this.m_actionCode==0xbbe){DWCBTManager.instance().resetAll(this.m_host);}}}}}}return 0;};DWCBTAction.prototype.initEvents=function(host){DWAction.prototype.initEvents.call(this,host);this.m_host=host;};DWCBTAction.prototype.closeEvents=function(host){this.m_host=null;DWAction.prototype.closeEvents.call(this,host);};DWCBTAnswer=function(_value,_correct,_text,_searchText,_ignoreCase){this.value=_value;this.correct=_correct;this.text=_text;this.searchText=_searchText;this.ignoreCase=_ignoreCase;this.answered=false;};DWCBTAnswer.prototype.value=null;DWCBTAnswer.prototype.correct=null;DWCBTAnswer.prototype.text=null;DWCBTAnswer.prototype.searchText=null;DWCBTAnswer.prototype.ignoreCase=null;DWCBTAnswer.prototype.answered=false;DWCBTManager=function(){this.m_questions=new Array();};DWCBTManager.m_instance=null;DWCBTManager.instance=function(){if(!DWCBTManager.m_instance){DWCBTManager.m_instance=new DWCBTManager();}return DWCBTManager.m_instance;};DWCBTManager.prototype.m_sessionStorageEnabled=false;DWCBTManager.prototype.enableSessionStorage=function(){this.m_sessionStorageEnabled=true;};DWCBTManager.prototype.m_questions=null;DWCBTManager.prototype.m_topicInfo=null;DWCBTManager.prototype.m_courseTitle=null;DWCBTManager.prototype.m_courseAdministrator=null;DWCBTManager.prototype.m_bCourseFinished=false;DWCBTManager.prototype.m_bCourseFailed=false;DWCBTManager.prototype.m_bSentTrigger=false;DWCBTManager.prototype.m_topics=null;DWCBTManager.prototype.addQuestion=function(question){this.m_questions[question.code]=question;};DWCBTManager.prototype.initialise=function(topics,courseTitle,courseAdministrator,courseAdministratorEmail){var theVariables=DWVariables.instance();this.m_topics=topics;this.m_courseTitle=courseTitle;this.m_courseAdministrator=courseAdministrator;theVariables.setValue("Q_COURSE_ADMINISTRATOR",courseAdministrator);theVariables.setValue("Q_COURSE_ADMINISTRATOR_EMAIL",courseAdministratorEmail);this.m_topics=new Array();for(var topic=0;topic<topics.length;topic++){theVariables.setArrayValue("Q_TOPIC_NAME",topic,topics[topic].name);theVariables.setArrayValue("Q_TOPIC_CRITICAL_PASS",topic,topics[topic].critical);theVariables.setArrayValue("Q_TOPIC_PASS_PERCENT",topic,topics[topic].passPercent);theVariables.setArrayValue("Q_TOPIC_PASS_VALUE",topic,topics[topic].passValue);this.m_topics[topic]=new DWCBTTopicData();this.m_topics[topic].m_bPassed=false;this.m_topics[topic].m_bSentTrigger=false;this.m_topics[topic].m_bFinished=false;this.m_topics[topic].m_bUsed=false;}for(var i in this.m_questions){var question=this.m_questions[i];if(question.options.topicNumber>=this.m_topics.length){this.m_topics[question.options.topicNumber]=new DWCBTTopicData();}this.m_topics[question.options.topicNumber].m_bUsed=true;}this.m_bCourseFinished=false;this.m_bCourseFailed=false;this.m_bSentTrigger=false;if(this.m_sessionStorageEnabled){this.restoreState();}this.updateVariables();};DWCBTManager.prototype.initialiseObject=function(obj){var pQ=this.m_questions[obj.getObjectCode().m_code];if((pQ==null)||(pQ==undefined)){return;}if((pQ.options.questionType==3)||(pQ.options.questionType==4)){;pQ.questionObject=obj;this.updateTextInput(pQ,obj,true);}};DWCBTManager.prototype.updateVariables=function(){var theVariables=DWVariables.instance();var correctCount=0;var incorrectCount=0;var answeredQuestions=0;var totalQuestions=0;var valueCount=0;var valueTotal=0;var valuePossible=0;var topicCount=0;for(var i in this.m_questions){var question=this.m_questions[i];if((question.options.topicNumber+1)>topicCount){topicCount=question.options.topicNumber+1;}}var topics=new Array(topicCount);var c=0;for(c=0;c<topicCount;c++){topics[c]=new Object();topics[c].correctCount=0;topics[c].incorrectCount=0;topics[c].answeredQuestions=0;topics[c].totalQuestions=0;topics[c].valueCount=0;topics[c].valueTotal=0;topics[c].valuePossible=0;topics[c].criticalFailed=false;}for(var i in this.m_questions){var question=this.m_questions[i];if((question!=null)&&(question!=undefined)){var topic=question.options.topicNumber;var maxValue=0;question.questionValue=0;question.questionPossible=0;question.questionCorrect=false;question.questionIncorrect=false;var first=true;for(var i=0;i<question.options.answers.length;i++){if(question.state==3){if(question.options.answers[i].answered){question.questionValue+=question.options.answers[i].value;if(!question.options.answers[i].correct){question.questionCorrect=false;question.questionIncorrect=true;}else{if(first){question.questionCorrect=true;question.questionIncorrect=false;}}first=false;}}if((question.options.questionType==2)||(question.options.questionType==7)||(question.options.questionType==4)){if(question.options.answers[i].value>0){question.questionPossible+=question.options.answers[i].value;}}else{if((question.options.questionType==0)||(question.options.questionType==1)||(question.options.questionType==5)||(question.options.questionType==6)||(question.options.questionType==3)){if(question.options.answers[i].value>maxValue){maxValue=question.options.answers[i].value;}}}}if((question.options.questionType==0)||(question.options.questionType==1)||(question.options.questionType==5)||(question.options.questionType==6)||(question.options.questionType==3)){question.questionPossible+=maxValue;}if(question.state==3){if(question.questionCorrect){correctCount++;topics[topic].correctCount++;}else{incorrectCount++;topics[topic].incorrectCount++;if(question.options.courseCritical){this.m_bCourseFinished=true;this.m_bCourseFailed=true;}}answeredQuestions++;topics[topic].answeredQuestions++;if(question.options.topicCritical&&(!question.questionCorrect)){topics[topic].criticalFailed=true;}question.correct=question.questionCorrect;}totalQuestions++;topics[topic].totalQuestions++;valueCount+=question.questionValue;topics[topic].valueCount+=question.questionValue;if(question.state==3){valuePossible+=question.questionPossible;topics[topic].valuePossible+=question.questionPossible;}valueTotal+=question.questionPossible;topics[topic].valueTotal+=question.questionPossible;}}theVariables.setValue("Q_SCORE_VALUE",valueCount);theVariables.setValue("Q_SCORE_CORRECT",correctCount);theVariables.setValue("Q_SCORE_INCORRECT",incorrectCount);theVariables.setValue("Q_SCORE_VALUE_POSSIBLE",valuePossible);theVariables.setValue("Q_SCORE_TOTAL_POSSIBLE",valueTotal);theVariables.setValue("Q_SCORE_VALUE_TOTAL_REMAINING",valueTotal-valuePossible);theVariables.setValue("Q_SCORE_CURRENT_POSSIBLE",(valueTotal-valuePossible)+valueCount);if(valueTotal>0){theVariables.setValue("Q_SCORE_PERCENT_POSSIBLE",(((valueTotal-valuePossible)+valueCount)*0x64)/valueTotal);}else{theVariables.setValue("Q_SCORE_PERCENT_POSSIBLE",0);}if(valuePossible>0){theVariables.setValue("Q_SCORE_VALUE_PERCENT",Math.floor((valueCount*0x64)/valuePossible));}else{theVariables.setValue("Q_SCORE_VALUE_PERCENT",0);}theVariables.setValue("Q_SCORE_OVERALL_PERCENT",Math.floor((valueCount*0x64)/valueTotal));theVariables.setValue("Q_SCORE_ANSWERED_QUESTIONS",answeredQuestions);theVariables.setValue("Q_SCORE_TOTAL_QUESTIONS",totalQuestions);for(var topic=0;topic<topicCount;topic++){theVariables.setArrayValue("Q_TOPIC_CURRENT_VALUE",topic,topics[topic].valueCount);var percent=0;if(topics[topic].valuePossible>0){percent=(topics[topic].valueCount*0x64)/topics[topic].valuePossible;theVariables.setArrayValue("Q_TOPIC_CURRENT_PERCENT",topic,Math.floor(percent));theVariables.setArrayValue("Q_TOPIC_OVERALL_PERCENT",topic,Math.floor((topics[topic].valueCount*0x64)/topics[topic].valueTotal));}else{theVariables.setArrayValue("Q_TOPIC_CURRENT_PERCENT",topic,0);theVariables.setArrayValue("Q_TOPIC_OVERALL_PERCENT",topic,0);}theVariables.setArrayValue("Q_TOPIC_CURRENT_POSSIBLE",topic,topics[topic].valuePossible);theVariables.setArrayValue("Q_TOPIC_TOTAL_POSSIBLE",topic,topics[topic].valueTotal);theVariables.setArrayValue("Q_TOPIC_VALUE_TOTAL_REMAINING",topic,topics[topic].valueTotal-topics[topic].valuePossible);theVariables.setArrayValue("Q_TOPIC_CORRECT",topic,topics[topic].correctCount);theVariables.setArrayValue("Q_TOPIC_INCORRECT",topic,topics[topic].incorrectCount);theVariables.setArrayValue("Q_TOPIC_ANSWERED_QUESTIONS",topic,topics[topic].answeredQuestions);theVariables.setArrayValue("Q_TOPIC_TOTAL_QUESTIONS",topic,topics[topic].totalQuestions);var bPass=false;if(!topics[topic].criticalFailed){if(this.m_topics[topic].valueIsPercent){bPass=percent>this.m_topics[topic].passValue;}else{bPass=topics[topic].valueCount>this.m_topics[topic].passValue;}}if((topics[topic].answeredQuestions==topics[topic].totalQuestions)||topics[topic].criticalFailed){this.m_topics[topic].m_bFinished=true;this.m_topics[topic].m_bPassed=bPass;}theVariables.setArrayValue("Q_TOPIC_FINISHED",topic,this.m_topics[topic].m_bFinished);theVariables.setArrayValue("Q_TOPIC_PASSED",topic,this.m_topics[topic].m_bFinished&&bPass);}if(!this.m_bCourseFinished){var bNotFinished=false;;var bFoundOne=false;var bFailed=false;for(var topic=0;topic<topicCount;topic++){;if(this.m_topics[topic].m_bUsed){bFoundOne=true;if(!this.m_topics[topic].m_bFinished){bNotFinished=true;}else{if(!this.m_topics[topic].m_bPassed){bFailed=true;if(this.m_topics[topic].critical){bNotFinished=false;break;}}}}}if((!bNotFinished)&&bFoundOne){;this.m_bCourseFinished=true;this.m_bCourseFailed=bFailed;}}theVariables.setValue("Q_SCORE_COURSE_FINISHED",this.m_bCourseFinished);theVariables.setValue("Q_SCORE_COURSE_PASSED",this.m_bCourseFinished&&(!this.m_bCourseFailed));};DWCBTManager.prototype.answer=function(questionCode,answer,host){;if(answer<0){return;}var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return;}var page=host.getPage();if(pQ.state==3){return;}pQ.state=2;var doneUpdateVariables=false;if((pQ.options.questionType==0)||(pQ.options.questionType==5)){pQ.options.answers[answer].answered=true;var trigger="CBTTrigger:"+decimalToHex(0x880001)+":"+pQ.code+":"+answer;this.sendTrigger(page,trigger);pQ.state=3;this.updateVariables();doneUpdateVariables=true;trigger="CBTTrigger:"+decimalToHex(0x880003)+":"+pQ.code;this.sendTrigger(page,trigger);}else{if((pQ.options.questionType==1)||(pQ.options.questionType==6)){pQ.options.answers[answer].answered=true;for(var i=0;i<pQ.options.answers.length;i++){if((answer!=i)&&pQ.options.answers[i].bAnswered){pQ.options.answers[i].answered=false;var trigger="CBTTrigger:"+decimalToHex(0x880002)+":"+pQ.code+":"+answer;this.sendTrigger(page,trigger);}}var trigger="CBTTrigger:"+decimalToHex(0x880001)+":"+pQ.code+":"+answer;this.sendTrigger(page,trigger);}else{if((pQ.options.questionType==2)||(pQ.options.questionType==7)){var bAnswered=false;if(answer<pQ.options.answers.length){bAnswered=pQ.options.answers[answer].answered;}if(!bAnswered){pQ.options.answers[answer].answered=true;var trigger="CBTTrigger:"+decimalToHex(0x880001)+":"+pQ.code+":"+answer;this.sendTrigger(page,trigger);}}else{if((pQ.options.questionType==3)||(pQ.options.questionType==4)){this.updateTextInput(pQ,host,false);}}}}if(!doneUpdateVariables){this.updateVariables();}var topic=pQ.options.topicNumber;if(this.m_topics[topic].m_bFinished&&(!this.m_topics[topic].m_bSentTrigger)){this.m_topics[topic].m_bSentTrigger=true;var trigger="CBTTrigger:"+decimalToHex((this.m_topics[topic].m_bPassed?0x880006:0x880007))+":"+pQ.code+":"+topic;this.sendTrigger(page,trigger);}if(this.m_bCourseFinished){if(!this.m_bSentTrigger){this.m_bSentTrigger=true;var trigger="CBTTrigger:"+decimalToHex((this.m_bCourseFailed?0x880009:0x880008))+":"+pQ.code+":"+0;this.sendTrigger(page,trigger);}}};DWCBTManager.prototype.resetAnswer=function(questionCode,answer,host){;if(answer<0){return;}var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return;}var page=host.getPage();if(pQ.state==3){return;}pQ.state=2;if((pQ.options.questionType==0)||(pQ.options.questionType==5)){pQ.options.answers[answer].answered=false;var trigger="CBTTrigger:"+decimalToHex(0x880002)+":"+pQ.code+":"+answer;this.sendTrigger(page,trigger);pQ.state=1;}else{if((pQ.options.questionType==1)||(pQ.options.questionType==6)){pQ.options.answers[answer].answered=false;var trigger="CBTTrigger:"+decimalToHex(0x880002)+":"+pQ.code+":"+answer;this.sendTrigger(page,trigger);}else{if((pQ.options.questionType==2)||(pQ.options.questionType==7)){pQ.options.answers[answer].answered=false;var trigger="CBTTrigger:"+decimalToHex(0x880002)+":"+pQ.code+":"+answer;this.sendTrigger(page,trigger);}else{if((pQ.options.questionType==3)||(pQ.options.questionType==4)){this.updateTextInput(pQ,host,false);}}}}var topic=pQ.options.topicNumber;if(this.m_topics[topic].m_bFinished&&this.m_topics[topic].m_bSentTrigger){this.m_topics[topic].m_bFinished=false;}this.m_bCourseFinished=false;this.m_bSentTrigger=false;this.updateVariables();};DWCBTManager.prototype.confirm=function(questionCode,host){;var page=host.getPage();var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return;}pQ.state=3;if((pQ.options.questionType==3)||(pQ.options.questionType==4)){this.updateTextInput(pQ,host,false);}this.updateVariables();var trigger="CBTTrigger:"+decimalToHex(0x880003)+":"+pQ.code;this.sendTrigger(page,trigger);var topic=pQ.options.topicNumber;if(this.m_topics[topic].m_bFinished&&(!this.m_topics[topic].m_bSentTrigger)){this.m_topics[topic].m_bSentTrigger=true;;;var trigger="CBTTrigger:"+decimalToHex((this.m_topics[topic].m_bPassed?0x880006:0x880007))+":"+topic;;this.sendTrigger(page,trigger);}if(this.m_bCourseFinished){if(!this.m_bSentTrigger){this.m_bSentTrigger=true;;var trigger="CBTTrigger:"+decimalToHex((this.m_bCourseFailed?0x880009:0x880008));;this.sendTrigger(page,trigger);}}};DWCBTManager.prototype.reset=function(questionCode,host){;var page=host.getPage();var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return;}if(pQ.options.limitRetries&&(pQ.options.maxRetries==pQ.retries)){return;}pQ.retries++;pQ.state=1;for(var i=0;i<pQ.options.answers.length;i++){pQ.options.answers[i].answered=false;}if((pQ.options.questionType==3)||(pQ.options.questionType==4)){this.updateTextInput(pQ,host,false,true);}this.updateVariables();var trigger="CBTTrigger:"+decimalToHex(0x880004)+":"+pQ.code;this.sendTrigger(page,trigger);if(pQ.options.limitRetries&&(pQ.options.maxRetries==pQ.retries)){var trigger="CBTTrigger:"+decimalToHex(0x880005)+":"+pQ.code;this.sendTrigger(page,trigger);}};DWCBTManager.prototype.getQuestion=function(obj){while(obj){if(obj.type()=="Question"){return obj;}obj=obj.getParent();}return null;};DWCBTManager.prototype.findTextInput=function(obj){if(obj.type()=="TextInput"){return obj;}var children=obj.getChildren();if(!children){return null;}for(var i=0;i<children.length;i++){var child=children[i];var input=this.findTextInput(child);if(input){return input;}}return null;};DWCBTManager.prototype.updateTextInput=function(pQ,obj,bInitialising,bResetInput){if(bResetInput==undefined)bResetInput=false;if((pQ.questionObject!=null)&&(pQ.questionObject!=undefined)){obj=pQ.questionObject;}else{obj=this.getQuestion(obj);if(obj==null){return;}}this.doUpdateTextInputChildren(pQ,obj,bInitialising,bResetInput);};DWCBTManager.prototype.doUpdateTextInputChildren=function(pQ,obj,bInitialising,bResetInput){var children=obj.getChildren();if(!children){return null;}for(var i=children.length-1;i>=0;i--){var child=children[i];if(child.type()=="TextInput"){this.doUpdateTextInput(pQ,child,bInitialising,bResetInput);}else{this.doUpdateTextInputChildren(pQ,child,bInitialising,bResetInput);}}};DWCBTManager.prototype.doUpdateTextInput=function(pQ,input,bInitialising,bResetInput){;if(bInitialising){if(pQ.previousText==null){pQ.previousText=new Array();}if(pQ.previousText[input.getObjectCode().m_code]!=undefined){input.setText(pQ.previousText[input.getObjectCode().m_code]);}}else{if(pQ.previousText==null){pQ.previousText=new Array();}if(pQ.previousText[input.getObjectCode().m_code]!=undefined){if(bResetInput){pQ.previousText[input.getObjectCode().m_code]="";input.setText(pQ.previousText[input.getObjectCode().m_code]);}}if(pQ.state==3){var text=input.getText();pQ.previousText[input.getObjectCode().m_code]=text;if(input.getQuestionAnswer()!=(-1)){if(input.getQuestionAnswer()<pQ.options.answers.length){var i=input.getQuestionAnswer();;if(pQ.options.answers[i].searchText.compare(text)){pQ.options.answers[i].answered=true;var trigger="CBTTrigger:"+decimalToHex(0x880001)+":"+pQ.code+":"+i;this.sendTrigger(input.getPage(),trigger);}else{pQ.options.answers[i].answered=false;}}}else{var i=0;for(i=0;i<pQ.options.answers.length;i++){if(pQ.options.answers[i].searchText.compare(text)){pQ.options.answers[i].answered=true;var trigger="CBTTrigger:"+decimalToHex(0x880001)+":"+pQ.code+":"+i;this.sendTrigger(input.getPage(),trigger);}else{pQ.options.answers[i].answered=false;}}}}else{if(pQ.state==1){}}}};DWCBTManager.prototype.questionValue=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return 0;}return pQ.questionValue;};DWCBTManager.prototype.questionPossible=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return 0;}return pQ.questionPossible;};DWCBTManager.prototype.questionCorrect=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return false;}return pQ.questionCorrect;};DWCBTManager.prototype.questionIncorrect=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return false;}return pQ.questionIncorrect;};DWCBTManager.prototype.questionNotAnswered=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return false;}var ret=pQ.state!=3;;return ret;};DWCBTManager.prototype.questionAnswerSelected=function(questionCode,answer){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return false;}var ret=pQ.options.answers[answer].answered;;return ret;};DWCBTManager.prototype.questionAnsweredCorrectly=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return false;}var ret=(pQ.state==3)&&pQ.correct;;return ret;};DWCBTManager.prototype.questionAnsweredIncorrectly=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return false;}var ret=(pQ.state==3)&&(!pQ.correct);;return ret;};DWCBTManager.prototype.questionRetryLimitReached=function(questionCode){var pQ=this.m_questions[questionCode];if((pQ==null)||(pQ==undefined)){return false;}var ret=pQ.options.limitRetries&&(pQ.options.maxRetries==pQ.retries);;return ret;};DWCBTManager.prototype.resetTopic=function(topic,host){;for(var i in this.m_questions){var pQ=this.m_questions[i];if((pQ!=null)&&(pQ!=undefined)){if(pQ.options.topicNumber==topic){pQ.state=1;pQ.retries=0;pQ.correct=false;pQ.previousText=null;for(var answer=0;answer<pQ.options.answers.length;answer++){pQ.options.answers[answer].answered=false;}}}}this.m_topics[topic].m_bFinished=false;this.m_topics[topic].m_bSentTrigger=false;this.updateVariables();};DWCBTManager.prototype.resetAll=function(host){;for(var i in this.m_questions){var pQ=this.m_questions[i];if((pQ!=null)&&(pQ!=undefined)){pQ.state=1;pQ.retries=0;pQ.correct=false;pQ.previousText=null;for(var answer=0;answer<pQ.options.answers.length;answer++){pQ.options.answers[answer].answered=false;}}}for(var topic=0;topic<this.m_topics.length;topic++){this.m_topics[topic].m_bFinished=false;this.m_topics[topic].m_bSentTrigger=false;}this.updateVariables();};DWCBTManager.prototype.questionTopicFinished=function(topic){;return this.m_topics[topic].m_bFinished;};DWCBTManager.prototype.questionTopicPassed=function(topic){;return this.m_topics[topic].m_bFinished&&this.m_topics[topic].m_bPassed;};DWCBTManager.prototype.questionTopicFailed=function(topic){;return this.m_topics[topic].m_bFinished&&(!this.m_topics[topic].m_bPassed);};DWCBTManager.prototype.questionCourseFinished=function(){;return this.m_bCourseFinished;};DWCBTManager.prototype.questionCoursePassed=function(){;return this.m_bCourseFinished&&(!this.m_bCourseFailed);};DWCBTManager.prototype.questionCourseFailed=function(){;return this.m_bCourseFinished&&this.m_bCourseFailed;};DWCBTManager.prototype.sendTrigger=function(page,trigger){page.triggerRecurse(trigger);};DWCBTManager.prototype.saveState=function(){if((!this.m_sessionStorageEnabled)||(window.sessionStorage==undefined)){return;}for(var topic=0;topic<this.m_topics.length;topic++){if(this.m_topics[topic].m_bUsed){window.sessionStorage["CBT.topics."+topic+".passed"]=this.m_topics[topic].m_bPassed;window.sessionStorage["CBT.topics."+topic+".sentTrigger"]=this.m_topics[topic].m_bSentTrigger;window.sessionStorage["CBT.topics."+topic+".finished"]=this.m_topics[topic].m_bFinished;window.sessionStorage["CBT.topics."+topic+".used"]=this.m_topics[topic].m_bUsed;}}for(var i in this.m_questions){var question=this.m_questions[i];if(question.state!=1){window.sessionStorage["CBT.questions."+i+".state"]=question.state;window.sessionStorage["CBT.questions."+i+".retries"]=question.retries;window.sessionStorage["CBT.questions."+i+".correct"]=question.correct;for(var answer=0;answer<question.options.answers.length;answer++){window.sessionStorage["CBT.questions."+i+".answer"+answer+".answered"]=question.options.answers[answer].answered;}}}window.sessionStorage["CBT.courseFinished"]=this.m_bCourseFinished;window.sessionStorage["CBT.courseFailed"]=this.m_bCourseFailed;window.sessionStorage["CBT.sentTrigger"]=this.m_bSentTrigger;};DWCBTManager.readBoolean=function(name,defaultValue){if(window.sessionStorage[name]!=undefined){if(window.sessionStorage[name]=="true"){return true;}return false;}return defaultValue;};DWCBTManager.readNumber=function(name,defaultValue){if(window.sessionStorage[name]!=undefined){return Number(window.sessionStorage[name]);}return defaultValue;};DWCBTManager.prototype.restoreState=function(){if((!this.m_sessionStorageEnabled)||(window.sessionStorage==undefined)){return;}for(var topic=0;topic<this.m_topics.length;topic++){this.m_topics[topic].m_bPassed=DWCBTManager.readBoolean("CBT.topics."+topic+".passed",this.m_topics[topic].m_bPassed);this.m_topics[topic].m_bSentTrigger=DWCBTManager.readBoolean("CBT.topics."+topic+".sentTrigger",this.m_topics[topic].m_bSentTrigger);this.m_topics[topic].m_bFinished=DWCBTManager.readBoolean("CBT.topics."+topic+".finished",this.m_topics[topic].m_bFinished);this.m_topics[topic].m_bUsed=DWCBTManager.readBoolean("CBT.topics."+topic+".used",this.m_topics[topic].m_bUsed);}for(var i in this.m_questions){var question=this.m_questions[i];question.state=DWCBTManager.readNumber("CBT.questions."+i+".state",question.state);question.retries=DWCBTManager.readNumber("CBT.questions."+i+".retries",question.retries);question.correct=DWCBTManager.readNumber("CBT.questions."+i+".correct",question.correct);for(var answer=0;answer<question.options.answers.length;answer++){question.options.answers[answer].answered=DWCBTManager.readBoolean("CBT.questions."+i+".answer"+answer+".answered",question.options.answers[answer].answered);}}this.m_bCourseFinished=DWCBTManager.readBoolean("CBT.courseFinished",this.m_bCourseFinished);this.m_bCourseFailed=DWCBTManager.readBoolean("CBT.courseFailed",this.m_bCourseFailed);this.m_bSentTrigger=DWCBTManager.readBoolean("CBT.sentTrigger",this.m_bSentTrigger);};DWCBTOptions=function(_questionType,_answers,_topicCritical,_courseCritical,_topicNumber,_limitRetries,_maxRetries){this.questionType=_questionType;this.answers=_answers;this.topicCritical=_topicCritical;this.courseCritical=_courseCritical;this.topicNumber=_topicNumber;this.limitRetries=_limitRetries;this.maxRetries=_maxRetries;};DWCBTOptions.prototype.questionType=null;DWCBTOptions.prototype.answers=null;DWCBTOptions.prototype.topicCritical=null;DWCBTOptions.prototype.courseCritical=null;DWCBTOptions.prototype.topicNumber=null;DWCBTOptions.prototype.limitRetries=null;DWCBTOptions.prototype.maxRetries=null;DWCBTQuestion=function(_code,_options){this.code=_code;this.options=_options;};DWCBTQuestion.prototype.code=null;DWCBTQuestion.prototype.options=null;DWCBTQuestion.prototype.state=1;DWCBTQuestion.prototype.retries=0;DWCBTQuestion.prototype.correct=false;DWCBTQuestion.prototype.questionObject=null;DWCBTQuestion.prototype.previousText=null;DWCBTQuestion.prototype.questionValue=0;DWCBTQuestion.prototype.questionPossible=0;DWCBTQuestion.prototype.questionCorrect=false;DWCBTQuestion.prototype.questionIncorrect=false;DWCBTQuestion.prototype.state=1;DWCBTTopic=function(_name,_passValue,_passPercent,_critical){this.name=_name;this.passValue=_passValue;this.valueIsPercent=_passPercent;this.critical=_critical;};DWCBTTopic.prototype.name=null;DWCBTTopic.prototype.passValue=null;DWCBTTopic.prototype.valueIsPercent=null;DWCBTTopic.prototype.critical=null;DWCBTTopicData=function(){};DWCBTTopicData.prototype.m_bPassed=false;DWCBTTopicData.prototype.m_bSentTrigger=false;DWCBTTopicData.prototype.m_bFinished=false;DWCBTTopicData.prototype.m_bUsed=false;DWChapter=function(){};__inherit(DWChapter,DWObject);DWChapter.prototype.type=function(){return "Chapter";};DWChapter.prototype.setObjectCode=function(code){this.m_objectCode=code;};DWChapter.prototype.getPage=function(name){if(this.m_children){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i].getObjectName()==name){return this.m_children[i];}}}return null;};DWChapter.prototype.m_randomList=null;DWChapter.prototype.m_randomPosition=0;DWChapter.prototype.gotoRandomPage=function(reset){if(reset||(this.m_randomList==null)){this.createRandomList();this.m_randomPosition=0;}for(;;){if(this.m_randomPosition==this.m_randomList.length){this.m_randomPosition=0;}var pageName=this.m_randomList[this.m_randomPosition++].getObjectName();if(pageName!=DWPublication.instance().getCurrentPage().getObjectName()){DWPublication.instance().gotoPage(pageName);break;}if(this.m_randomList.length==1){break;}}};DWChapter.prototype.createRandomList=function(){var children=this.getChildren();this.m_randomList=new Array();for(var i=0;i<children.length;i++){if(!children[i].isExcludeRandom()){this.m_randomList.push(children[i]);}}for(var i=this.m_randomList.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=this.m_randomList[i];this.m_randomList[i]=this.m_randomList[j];this.m_randomList[j]=temp;}};DWCollision=function(){};DWCollision.test=function(obj1,obj2){var r1=obj1.getTransformedBoundingRect();var r2=obj2.getTransformedBoundingRect();if(r1.intersects(r2)){var r=DWRect.intersect(r1,r2);r=r.toIntegerRectExpand();if((r.width>0)&&(r.height>0)){var scaleF=0.25;var element1=document.createElement("canvas");var canvasX=Math.ceil(r.width*scaleF);var canvasY=Math.ceil(r.height*scaleF);element1.setAttribute("width",String(canvasX));element1.setAttribute("height",String(canvasY));var ctx1=element1.getContext("2d");ctx1.setTransform(1,0,0,1,0,0);ctx1.scale(scaleF,scaleF);ctx1.translate(-r.x,-r.y);ctx1.clearRect(r.x,r.y,r.width,r.height);var adapter1=obj1.getAdapter();adapter1.drawCanvas(ctx1);var element2=document.createElement("canvas");element2.setAttribute("width",String(canvasX));element2.setAttribute("height",String(canvasY));var ctx2=element2.getContext("2d");ctx2.setTransform(1,0,0,1,0,0);ctx2.scale(scaleF,scaleF);ctx2.translate(-r.x,-r.y);var adapter2=obj2.getAdapter();adapter2.drawCanvas(ctx2);var img1=ctx1.getImageData(0,0,canvasX,canvasY);var img2=ctx2.getImageData(0,0,canvasX,canvasY);for(var y=0;y<canvasY;y++){var s=y*canvasX*4;for(var x=0;x<canvasX;x++){if((img1.data[((s+(x*4))+3)]>0)&&(img2.data[((s+(x*4))+3)]>0)){return true;}}}return false;}}return false;};DWCollision.setStyleProperty=function(element,propertyName,value){if(element.style.setProperty!=undefined){element.style.setProperty(propertyName,value,"important");}element.style[propertyName]=value;};DWCollisionManager=function(){};DWCollisionManager.prototype.m_objects=null;DWCollisionManager.prototype.register=function(obj){if(!this.m_objects){this.m_objects=new Array();}else{for(var i=0;i<this.m_objects.length;i++){if(this.m_objects[i]==obj){return;}}}this.m_objects.push(obj);};DWCollisionManager.prototype.start=function(){DWUpdateController.addAnimationUpdate(this);};DWCollisionManager.prototype.stop=function(){DWUpdateController.removeAnimationUpdate(this);};DWCollisionManager.prototype.update=function(time){if(this.m_objects){for(var i=0;i<this.m_objects.length;i++){var grObj=this.m_objects[i];grObj.testCollisions();}}};DWTrigger=function(){};DWTrigger.prototype.initEvents=function(host){};DWTrigger.prototype.closeEvents=function(host){};DWCollisionTrigger=function(code){this.m_code=code;if(arguments.length>1){this.m_objects=new Array();for(var i=1;i<arguments.length;i++){this.m_objects.push(arguments[i]);}}};__inherit(DWCollisionTrigger,DWTrigger);DWCollisionTrigger.prototype.m_code=null;DWCollisionTrigger.prototype.m_objects=null;DWCollisionTrigger.prototype.type=function(){return "DWCollisionTrigger";};DWCollisionTrigger.prototype.match=function(other){if(other.type()=="DWCollisionTrigger"){var otherDrop=other;if(otherDrop.m_code!=this.m_code){return false;}if((!this.m_objects)||(this.m_objects.length!=1)){;return false;}if(otherDrop.m_objects==null){return true;}for(var i=0;i<otherDrop.m_objects.length;i++){if(otherDrop.m_objects[i]==this.m_objects[0]){return true;}}}return false;};DWCollisionTrigger.prototype.initEvents=function(host){DWTrigger.prototype.initEvents.call(this,host);var grObj=host;grObj.registerForCollisions(this.m_objects);};DWCollisionTrigger.prototype.closeEvents=function(host){DWTrigger.prototype.closeEvents.call(this,host);};DWColour=function(_r,_g,_b,_a){if(_r!=undefined)this.r=_r;if(_g!=undefined)this.g=_g;if(_b!=undefined)this.b=_b;if(_a!=undefined)this.a=_a;};DWColour.prototype.r=0;DWColour.prototype.g=0;DWColour.prototype.b=0;DWColour.prototype.a=1;DWColour.prototype.toString=function(){return "rgba("+this.r+","+this.g+","+this.b+","+this.a+")";};DWColour.morph=function(c1,c2,pos){var _r=Math.floor(c1.r+(pos*(c2.r-c1.r)));if(_r<0)_r=0;if(_r>0xff)_r=0xff;var _g=Math.floor(c1.g+(pos*(c2.g-c1.g)));if(_g<0)_g=0;if(_g>0xff)_g=0xff;var _b=Math.floor(c1.b+(pos*(c2.b-c1.b)));if(_b<0)_b=0;if(_b>0xff)_b=0xff;var _a=c1.a+(pos*(c2.a-c1.a));if(_a<0)_a=0;if(_a>1)_a=1;return new DWColour(_r,_g,_b,_a);};DWCompareStringAnd=function(lhs,rhs){this.m_lhs=lhs;this.m_rhs=rhs;};DWCompareStringAnd.prototype.m_lhs=null;DWCompareStringAnd.prototype.m_rhs=null;DWCompareStringAnd.prototype.compare=function(text){return this.m_lhs.compare(text)&&this.m_rhs.compare(text);};DWCompareStringMatch=function(compare,ignoreCase){this.m_ignoreCase=ignoreCase;if(this.m_ignoreCase){this.m_compare="";var i;for(i=0;i<compare.length;i++){this.m_compare+=compare.charAt(i).toLowerCase();}}else{this.m_compare=compare;}};DWCompareStringMatch.prototype.m_compare=null;DWCompareStringMatch.prototype.m_ignoreCase=null;DWCompareStringMatch.prototype.compare=function(textIn){var text="";if(this.m_ignoreCase){var i;for(i=0;i<textIn.length;i++){text+=textIn.charAt(i).toLowerCase();}}else{text=textIn;}var find=text.indexOf(this.m_compare);if(find!=(-1)){var bWord=true;if(find!=0){var c=text.charAt(find-1);if(((c>="A")&&(c<="Z"))||((c>="a")&&(c<="z"))||((c>="0")&&(c<="9"))){bWord=false;}}if(text.length>(find+this.m_compare.length)){var c=text.charAt(find+this.m_compare.length);if(((c>="A")&&(c<="Z"))||((c>="a")&&(c<="z"))||((c>="0")&&(c<="9"))){bWord=false;}}if(bWord){return true;}}return false;};DWCompareStringNot=function(child){this.m_child=child;};DWCompareStringNot.prototype.m_child=null;DWCompareStringNot.prototype.compare=function(text){return !this.m_child.compare(text);};DWCompareStringOr=function(lhs,rhs){this.m_lhs=lhs;this.m_rhs=rhs;};DWCompareStringOr.prototype.m_lhs=null;DWCompareStringOr.prototype.m_rhs=null;DWCompareStringOr.prototype.compare=function(text){return this.m_lhs.compare(text)||this.m_rhs.compare(text);};DWContext=function(){CanvasRenderingContext2D.call(this);};DWCookieAction=function(cookie,variable,type){this.m_cookie=cookie;this.m_variable=variable;this.m_type=type;};__inherit(DWCookieAction,DWAction);DWCookieAction.prototype.m_cookie=null;DWCookieAction.prototype.m_variable=null;DWCookieAction.prototype.m_type=null;DWCookieAction.prototype.Go=function(callback){if(this.m_type==0x327){var value=DWVariables.instance().getValue(this.m_variable);if(window.localStorage!=undefined){window.localStorage["DWCookie."+this.m_cookie]=this.writeStorageValue(value);}}else{if(this.m_type==0x328){if(window.localStorage!=undefined){var s="DWCookie."+this.m_cookie;if(window.localStorage.hasOwnProperty(s)){var value=this.readStorageValue(window.localStorage[s]);DWVariables.instance().setValue(this.m_variable,value);}else{DWVariables.instance().setValue(this.m_variable,null);}}else{DWVariables.instance().setValue(this.m_variable,null);}}}return 0;};DWCookieAction.prototype.writeStorageValue=function(v){if(typeof(v)=="number"){return "N"+String(v);}if(typeof(v)=="string"){return "S"+String(v);}if(typeof(v)=="boolean"){return "B"+String(v);}return "U"+String(v);};DWCookieAction.prototype.readStorageValue=function(s){if(s.length>1){switch(s.substr(0,1)){case "N":return Number(s.substr(1));case "S":return String(s.substr(1));case "B":return s.substr(1)=="true";}return s.substr(1);}return null;};DWCustomAction=function(trigger){this.m_trigger=trigger;};__inherit(DWCustomAction,DWAction);DWCustomAction.prototype.m_trigger=null;DWCustomAction.prototype.m_host=null;DWCustomAction.prototype.Go=function(callback){this.m_host.getPage().triggerEventsRecurse(new DWCustomTrigger(this.m_trigger));return 0;};DWCustomAction.prototype.initEvents=function(host){DWAction.prototype.initEvents.call(this,host);this.m_host=host;};DWCustomAction.prototype.closeEvents=function(host){this.m_host=null;DWAction.prototype.closeEvents.call(this,host);};DWCustomTrigger=function(trigger){this.m_trigger=trigger;};__inherit(DWCustomTrigger,DWTrigger);DWCustomTrigger.prototype.m_trigger=null;DWCustomTrigger.prototype.match=function(other){if(other.type()=="DWCustomTrigger"){if(other.m_trigger==this.m_trigger){return true;}}return false;};DWCustomTrigger.prototype.type=function(){return "DWCustomTrigger";};DWDIVAdapter=function(theObject){this.m_object=theObject;};DWDIVAdapter.prototype.m_object=null;DWDIVAdapter.prototype.type=function(){return "DWDIVAdapter";};DWDIVAdapter.prototype.addSlave=function(slave){};DWDIVAdapter.prototype.m_parent=null;DWDIVAdapter.prototype.setParentAdapter=function(parent){this.m_parent=parent;};DWDIVAdapter.prototype.updateTransform=function(){var transform="";var translate=this.m_object.getTranslate();transform+=(((("translate("+translate.x)+"px,")+translate.y)+"px) ");var rotate=this.m_object.getRotate();transform+=(("rotate("+rotate)+"deg) ");var scale=this.m_object.getScale();transform+=(((("scale("+scale.x)+",")+scale.y)+") ");var preTranslate=this.m_object.getPreTranslate();transform+=(((("translate("+preTranslate.x)+"px,")+preTranslate.y)+"px) ");this.setStyleProperty("transform",transform);this.setStyleProperty("-ms-transform",transform);this.setStyleProperty("-moz-transform",transform);this.setStyleProperty("-webkit-transform",transform);this.setStyleProperty("-o-transform",transform);};DWDIVAdapter.prototype.updateFromMasterTransform=function(){var pt=new DWPoint(0,0);var grParent=this.m_object.getParent();while(grParent&&(grParent.element()==null)){pt=grParent.pointToParent(pt);grParent=grParent.getParent();}var ptOffset=this.m_object.getDivObjectOffset();if(ptOffset){pt=pt.subtract(ptOffset);}this.m_object.setTranslate(pt.x,pt.y);};DWDIVAdapter.prototype.setStyleProperty=function(propertyName,value){if(this.m_object.element().style.setProperty!=undefined){this.m_object.element().style.setProperty(propertyName,value,"important");}this.m_object.element()[propertyName]=value;};DWDIVAdapter.prototype.show=function(){this.setStyleProperty("visibility","visible");};DWDIVAdapter.prototype.hide=function(){this.setStyleProperty("visibility","hidden");};DWDIVAdapter.prototype.setAlpha=function(alpha){this.setStyleProperty("opacity",String(alpha));};DWDIVAdapter.prototype.setBorder=function(width,radius,colour){this.setStyleProperty("border-width",String(width)+"px");this.setStyleProperty("border-radius",String(radius)+"px");this.setStyleProperty("border-color",colour);this.setStyleProperty("border-style","solid");};DWDIVAdapter.prototype.setSolidBackground=function(colour){this.setStyleProperty("background-color",colour);};DWDIVAdapter.prototype.setShadow=function(x,y,width,blur,colour){this.setStyleProperty("box-shadow",String(x)+"px "+y+"px "+width+"px "+blur+"px "+colour);};DWDIVAdapter.prototype.m_layer=0;DWDIVAdapter.prototype.setLayer=function(z){this.setStyleProperty("z-index",String(z));this.m_layer=z;};DWDIVAdapter.prototype.getLayer=function(){return this.m_layer;};DWDIVAdapter.prototype.setImage=function(url,mode){this.setStyleProperty("background-image","url(\'"+url+"\')");switch(mode){case 3:case 1:this.setStyleProperty("background-repeat","no-repeat");this.setStyleProperty("background-size","100%");break;case 0:this.setStyleProperty("background-repeat","no-repeat");break;case 2:this.setStyleProperty("background-repeat","repeat");break;}};DWDIVAdapter.prototype.reorderChildren=function(){};DWDIVAdapter.prototype.getTransitionClipPath=function(){return null;};DWDIVAdapter.prototype.removeTransitionClipPath=function(){};DWDIVAdapter.prototype.getTransitionMask=function(){return null;};DWDIVAdapter.prototype.removeTransitionMask=function(){};DWSVGAdapter=function(theObject){this.m_object=theObject;this.m_svg=this.m_object.svg();this.m_svgOuter=this.m_object.svgOuter();var id=this.m_object.elementId();this.m_buttonGroup=document.getElementById(id+"_bt");this.m_background=document.getElementById(id+"_bg");this.m_imageGroup=document.getElementById(id+"_im");this.m_border=document.getElementById(id+"_bd");};DWSVGAdapter.prototype.m_object=null;DWSVGAdapter.prototype.m_svg=null;DWSVGAdapter.prototype.m_svgOuter=null;DWSVGAdapter.prototype.m_background=null;DWSVGAdapter.prototype.m_imageGroup=null;DWSVGAdapter.prototype.m_imageGroupSave=null;DWSVGAdapter.prototype.m_border=null;DWSVGAdapter.prototype.m_borderClip=null;DWSVGAdapter.prototype.type=function(){return "DWSVGAdapter";};DWSVGAdapter.prototype.m_slaves=null;DWSVGAdapter.prototype.addSlave=function(slave){if(this.m_slaves==null){this.m_slaves=new Array();}this.m_slaves.push(slave);};DWSVGAdapter.prototype.m_parent=null;DWSVGAdapter.prototype.setParentAdapter=function(parent){this.m_parent=parent;};DWSVGAdapter.prototype.updateTransform=function(){var objTransform=this.m_object.getTransform();var transform="";var translate=objTransform.getTranslate();var baseTranslate=objTransform.getBaseTranslate();transform+=(((("translate("+(translate.x+baseTranslate.x))+",")+(translate.y+baseTranslate.y))+") ");var rotate=objTransform.getRotate();if(rotate!=0){transform+=(("rotate("+rotate)+") ");}var scale=objTransform.getScale();if((scale.x!=1)||(scale.y!=1)){transform+=(((("scale("+scale.x)+",")+scale.y)+") ");}var preTranslate=objTransform.getPreTranslate();transform+=(((("translate("+preTranslate.x)+",")+preTranslate.y)+") ");this.m_svgOuter.setAttribute("transform",transform);if((this.m_slaves!=null)&&this.m_slaves.length){for(var i=0;i<this.m_slaves.length;i++){this.m_slaves[i].updateFromMasterTransform();}}};DWSVGAdapter.prototype.updateFromMasterTransform=function(){};DWSVGAdapter.prototype.m_visible=undefined;DWSVGAdapter.prototype.show=function(){if((!this.m_visible)||(this.m_visible==undefined)){this.m_svgOuter.setAttribute("visibility","visible");this.m_visible=true;}};DWSVGAdapter.prototype.hide=function(){if(this.m_visible||(this.m_visible==undefined)){this.m_svgOuter.setAttribute("visibility","hidden");this.m_visible=false;}};DWSVGAdapter.prototype.m_currentAlpha=-1;DWSVGAdapter.prototype.setAlpha=function(alpha){if(alpha!=this.m_currentAlpha){this.m_svg.setAttribute("opacity",String(alpha));this.m_currentAlpha=alpha;}};DWSVGAdapter.prototype.m_effects=null;DWSVGAdapter.prototype.setBlur=function(x,y,repeat){if(!this.m_effects){this.m_effects=new DWSVGEffectsFilter();}this.m_effects.m_blurX=x;this.m_effects.m_blurY=y;this.m_effects.m_blurRepeat=repeat;this.m_effects.update(this.m_svgOuter);};DWSVGAdapter.prototype.setFlare=function(width,blur,colour){if(!this.m_effects){this.m_effects=new DWSVGEffectsFilter();}this.m_effects.m_flareWidth=width;this.m_effects.m_flareBlur=blur;this.m_effects.m_flareColour=colour;this.m_effects.update(this.m_svgOuter);};DWSVGAdapter.prototype.setShadow=function(x,y,blur,colour){if(!this.m_effects){this.m_effects=new DWSVGEffectsFilter();}this.m_effects.m_shadowX=x;this.m_effects.m_shadowY=y;this.m_effects.m_shadowBlur=blur;this.m_effects.m_shadowColour=colour;this.m_effects.update(this.m_svgOuter);};DWSVGAdapter.prototype.m_layer=0;DWSVGAdapter.prototype.setLayer=function(z){this.m_layer=z;if(this.m_parent){this.m_parent.reorderChildren();}};DWSVGAdapter.prototype.getLayer=function(){return this.m_layer;};DWSVGAdapter.prototype.m_currentImage=null;DWSVGAdapter.prototype.getCurrentImage=function(){return this.m_currentImage;};DWSVGAdapter.prototype.getImageGroup=function(){return this.m_imageGroup;};DWSVGAdapter.prototype.setImage=function(image){if(image!=null){if(image.type()=="DWVectorImage"){this.setVectorImage(image);}else{this.setBitmapImage(image);}}else{if(this.m_imageGroup){DWSVGHelper.removeChildren(this.m_imageGroup);}}this.m_currentImage=image;};DWSVGAdapter.prototype.m_imageArea=null;DWSVGAdapter.prototype.setImageArea=function(r){this.m_imageArea=r;};DWSVGAdapter.prototype.setBitmapImage=function(image){if(!this.m_imageGroup){this.m_imageGroup=document.createElementNS("http://www.w3.org/2000/svg","g");this.m_svg.appendChild(this.m_imageGroup);}DWSVGHelper.removeChildren(this.m_imageGroup);DWSVGHelper.resetTransform(this.m_imageGroup);if(image.m_url&&image.m_url.length){var rObject=new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight());if(this.m_imageArea){rObject=this.m_imageArea;}if(image.m_mode==2){var iXTiles=Math.floor((rObject.width/image.m_srcRect.width))+1;var iYTiles=Math.floor((rObject.height/image.m_srcRect.height))+1;var offX=(image.m_srcRect.width/2)-(rObject.width/2);var offY=(image.m_srcRect.height/2)-(rObject.height/2);for(var iY=0;iY<iYTiles;iY++){for(var iX=0;iX<iXTiles;iX++){var imageSVG=DWSVGHelper.addImage(this.m_imageGroup,image.m_srcRect,image.m_url);DWSVGHelper.setTransform(imageSVG,new DWPoint((iX*image.m_srcRect.width)+offX,(iY*image.m_srcRect.height)+offY),null,0,image.m_srcRect.centre().invert());}}}else{var imageSVG=DWSVGHelper.addImage(this.m_imageGroup,image.m_srcRect,image.m_url);switch(image.m_mode){case 0:DWSVGHelper.setTransform(imageSVG,new DWPoint((image.m_srcRect.width/2)-(rObject.width/2),(image.m_srcRect.height/2)-(rObject.height/2)),null,0,image.m_srcRect.centre().invert());break;case 1:var scaleX=rObject.width/image.m_srcRect.width;var scaleY=rObject.height/image.m_srcRect.height;DWSVGHelper.setTransform(imageSVG,new DWPoint(rObject.x+(rObject.width/2),rObject.y+(rObject.height/2)),new DWPoint(scaleX,scaleY),0,image.m_srcRect.centre().invert());break;case 4:var scaleX=rObject.width/image.m_srcRect.width;var scaleY=rObject.height/image.m_srcRect.height;if(scaleX>scaleY){scaleX=scaleY;}else{scaleY=scaleX;}DWSVGHelper.setTransform(imageSVG,new DWPoint(rObject.x+(rObject.width/2),rObject.y+(rObject.height/2)),new DWPoint(scaleX,scaleY),0,image.m_srcRect.centre().invert());break;case 3:DWSVGHelper.setTransform(imageSVG,new DWPoint(rObject.x+(rObject.width/2),rObject.y+(rObject.height/2)),null,0,image.m_srcRect.centre().invert());break;}}}};DWSVGAdapter.prototype.setVectorImage=function(image){if(!this.m_imageGroup){this.m_imageGroup=document.createElementNS("http://www.w3.org/2000/svg","g");this.m_svg.appendChild(this.m_imageGroup);}var rObject=new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight());if(this.m_imageArea){rObject=this.m_imageArea;}var scaleX=rObject.width/image.m_srcRect.width;var scaleY=rObject.height/image.m_srcRect.height;if(image.m_mode==4){if(scaleX>scaleY){scaleX=scaleY;}else{scaleY=scaleX;}}DWSVGHelper.removeChildren(this.m_imageGroup);DWSVGHelper.resetTransform(this.m_imageGroup);var imageSubGroup=document.createElementNS("http://www.w3.org/2000/svg","g");this.m_imageGroup.appendChild(imageSubGroup);DWSVGHelper.setTransform(imageSubGroup,new DWPoint(rObject.x+(rObject.width/2),rObject.y+(rObject.height/2)),new DWPoint(scaleX,scaleY),0,image.m_srcRect.centre().invert());for(var i=0;i<image.m_polygons.length;i++){var path=DWSVGHelper.addPath(imageSubGroup);image.m_polygons[i].drawSVG(path);}};DWSVGAdapter.prototype.saveImageGroup=function(){if(this.m_imageGroupSave!=null){this.removeSavedImageGroup();}this.m_imageGroupSave=this.m_imageGroup;this.m_imageGroup=null;};DWSVGAdapter.prototype.removeSavedImageGroup=function(){if(this.m_imageGroupSave!=null){this.m_svg.removeChild(this.m_imageGroupSave);this.m_imageGroupSave=null;}};DWSVGAdapter.prototype.setBorder=function(width,radius,colour){if(width==0){if(this.m_border){DWSVGHelper.removeChildren(this.m_border);}if(this.m_borderClip){var defs=DWSVGHelper.getDefsElement(this.m_svg);defs.removeChild(this.m_borderClip);this.m_borderClip=null;}this.m_svg.removeAttribute("clip-path");this.m_currentBorderPolygons=null;this.m_currentBorderMaskPolygons=null;}};DWSVGAdapter.m_nextVectorClipPathId=1;DWSVGAdapter.prototype.m_currentBorderPolygons=null;DWSVGAdapter.prototype.m_currentBorderMaskPolygons=null;DWSVGAdapter.prototype.setVectorBorder=function(polygons,maskPolygons){if(!this.m_border){this.m_border=document.createElementNS("http://www.w3.org/2000/svg","g");this.m_svgOuter.appendChild(this.m_border);}DWSVGHelper.removeChildren(this.m_border);if(this.m_borderClip){var defs=DWSVGHelper.getDefsElement(this.m_svg);defs.removeChild(this.m_borderClip);this.m_borderClip=null;}this.m_currentBorderPolygons=polygons;this.m_currentBorderMaskPolygons=maskPolygons;if(polygons){for(var i=0;i<polygons.length;i++){var path=DWSVGHelper.addPath(this.m_border);polygons[i].drawSVG(path);}}if(maskPolygons&&(maskPolygons.length>=1)){var clipId="borderClip"+(DWSVGAdapter.m_nextVectorClipPathId++);this.m_borderClip=DWSVGHelper.addClipPath(this.m_svg,maskPolygons[0].m_pts);this.m_borderClip.setAttribute("id",clipId);this.m_svg.setAttribute("clip-path","url(#"+clipId+")");}else{this.m_svg.removeAttribute("clip-path");}};DWSVGAdapter.prototype.m_currentBackgroundBrush=null;DWSVGAdapter.prototype.setBackground=function(brush){if(!this.m_background){var r=new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight());this.m_background=DWSVGHelper.addRect(this.m_svg,r);this.fixElementLayers();}if(this.m_currentBackgroundBrush){this.m_currentBackgroundBrush.removeSVG(this.m_background);this.m_currentBackgroundBrush=null;}if(brush){this.m_currentBackgroundBrush=brush.createCopy();this.m_currentBackgroundBrush.applySVG(this.m_background);}};DWSVGAdapter.prototype.m_buttonGroup=null;DWSVGAdapter.prototype.m_outlineRect=null;DWSVGAdapter.prototype.m_surfaceRect=null;DWSVGAdapter.prototype.m_clrSurface=null;DWSVGAdapter.prototype.m_bevelTL=null;DWSVGAdapter.prototype.m_bevelBR=null;DWSVGAdapter.prototype.m_bevelWidth=-1;DWSVGAdapter.prototype.m_cornerRadius=-1;DWSVGAdapter.prototype.m_roundBorder=null;DWSVGAdapter.prototype.m_roundFill=null;DWSVGAdapter.prototype.m_clrLight=null;DWSVGAdapter.prototype.setButton=function(clrSurface,clrLight,clrDark,bevelWidth,outline,cornerRadius){if(!this.m_buttonGroup){this.m_buttonGroup=document.createElementNS("http://www.w3.org/2000/svg","g");this.m_svg.appendChild(this.m_buttonGroup);this.fixElementLayers();}var r=new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight());if(outline){if(!this.m_outlineRect){this.m_outlineRect=DWSVGHelper.addRect(this.m_buttonGroup,r);}this.m_outlineRect.setAttribute("stroke","#000000");this.m_outlineRect.setAttribute("stroke-width","1");r.inflateRect(-2,-2);}else{if(this.m_outlineRect){this.m_buttonGroup.removeChild(this.m_outlineRect);this.m_outlineRect=null;}}if(clrSurface!=this.m_clrSurface){if(!this.m_surfaceRect){this.m_surfaceRect=DWSVGHelper.addRoundedRect(this.m_buttonGroup,r,cornerRadius);}clrSurface.applySVG(this.m_surfaceRect);this.m_clrSurface=clrSurface;}if(((bevelWidth==0)&&(this.m_bevelWidth!=0))||((cornerRadius==0)!=(this.m_cornerRadius==0))){if(this.m_bevelTL)this.m_buttonGroup.removeChild(this.m_bevelTL);this.m_bevelTL=null;if(this.m_bevelBR)this.m_buttonGroup.removeChild(this.m_bevelBR);this.m_bevelBR=null;if(this.m_roundBorder)this.m_buttonGroup.removeChild(this.m_roundBorder);this.m_roundBorder=null;if(this.m_roundFill)this.m_buttonGroup.removeChild(this.m_roundFill);this.m_roundFill=null;}this.m_bevelWidth=bevelWidth;if(bevelWidth!=0){if(cornerRadius==0){var tl=r.topLeft();var tr=r.topRight();var bl=r.bottomLeft();var br=r.bottomRight();if(!this.m_bevelTL){this.m_bevelTL=DWSVGHelper.addPath(this.m_buttonGroup,clrLight,bevelWidth,bl,tl,tr);this.m_bevelBR=DWSVGHelper.addPath(this.m_buttonGroup,clrDark,bevelWidth,tr,br,bl);}else{DWSVGHelper.updatePath(this.m_bevelTL,clrLight,bevelWidth,bl,tl,tr);DWSVGHelper.updatePath(this.m_bevelBR,clrDark,bevelWidth,tr,br,bl);}}else{if(!this.m_roundBorder){this.m_roundBorder=DWSVGHelper.addRoundedRect(this.m_buttonGroup,r,cornerRadius);}else{DWSVGHelper.updateRoundedRect(this.m_roundBorder,r,cornerRadius);}this.m_roundBorder.setAttribute("stroke",clrDark.toString());this.m_roundBorder.setAttribute("stroke-width",String(bevelWidth));if(clrLight){r.inflateRect(-1,-1);if(!this.m_roundFill){this.m_roundFill=DWSVGHelper.addRoundedRect(this.m_buttonGroup,r,cornerRadius);}else{DWSVGHelper.updateRoundedRect(this.m_roundFill,r,cornerRadius);}this.m_roundFill.setAttribute("stroke",clrLight.toString());this.m_roundFill.setAttribute("stroke-width",String(bevelWidth*2));}else{if(this.m_roundFill){this.m_buttonGroup.removeChild(this.m_roundFill);this.m_roundFill=null;}}this.m_clrLight=clrLight;}}};DWSVGAdapter.prototype.fixElementLayers=function(){var nodes=new Array();for(var i=0;i<this.m_svg.childNodes.length;i++){var n=this.m_svg.childNodes[i];if((n!=this.m_background)&&(n!=this.m_imageGroup)&&(n!=this.m_buttonGroup)){nodes.push(n);}}DWSVGHelper.removeChildren(this.m_svg);if(this.m_background){this.m_svg.appendChild(this.m_background);}if(this.m_buttonGroup){this.m_svg.appendChild(this.m_buttonGroup);}if(this.m_imageGroup){this.m_svg.appendChild(this.m_imageGroup);}for(var i=0;i<nodes.length;i++){this.m_svg.appendChild(nodes[i]);}};DWSVGAdapter.prototype.reorderChildren=function(){var children=this.m_object.getChildren();var out=new Array();for(var i=0;i<children.length;i++){if(children[i].isGraphicalObject()){if(children[i].svgOuter().parentNode==this.m_svg){out.push(children[i]);}}}out.sort(function(a,b){return a.getAdapter().getLayer()-b.getAdapter().getLayer();});for(var i=0;i<out.length;i++){var svg=out[i].svgOuter();this.m_svg.appendChild(svg);}};DWSVGAdapter.prototype.m_transitionClipPath=null;DWSVGAdapter.prototype.m_transitionClipPathPath=null;DWSVGAdapter.prototype.m_transitionClipPathID=null;DWSVGAdapter.m_clipPathId=1;DWSVGAdapter.prototype.getTransitionClipPath=function(targetElement){if(targetElement==undefined)targetElement=null;if(!this.m_transitionClipPath){var defs=DWSVGHelper.getDefsElement(this.m_svg);this.m_transitionClipPath=document.createElementNS("http://www.w3.org/2000/svg","clipPath");defs.appendChild(this.m_transitionClipPath);this.m_transitionClipPathID="transitionClipPath"+String((DWSVGAdapter.m_clipPathId++));this.m_transitionClipPath.setAttribute("id",this.m_transitionClipPathID);this.m_transitionClipPathPath=document.createElementNS("http://www.w3.org/2000/svg","path");this.m_transitionClipPath.appendChild(this.m_transitionClipPathPath);}if(targetElement){targetElement.setAttribute("clip-path","url(#"+this.m_transitionClipPathID+")");}else{this.m_svgOuter.setAttribute("clip-path","url(#"+this.m_transitionClipPathID+")");}return this.m_transitionClipPathPath;};DWSVGAdapter.prototype.removeTransitionClipPath=function(targetElement){if(targetElement==undefined)targetElement=null;if(targetElement){targetElement.removeAttribute("clip-path");}else{this.m_svgOuter.removeAttribute("clip-path");}};DWSVGAdapter.prototype.m_transitionMask=null;DWSVGAdapter.prototype.m_transitionMaskID=null;DWSVGAdapter.m_maskId=1;DWSVGAdapter.prototype.getTransitionMask=function(targetElement){if(targetElement==undefined)targetElement=null;if(!this.m_transitionMask){var defs=DWSVGHelper.getDefsElement(this.m_svg);var browser=navigator.userAgent.toLowerCase();if((browser.indexOf("android")!=(-1))&&(browser.indexOf("chrome")==(-1))&&(browser.indexOf("firefox")==(-1))){return null;}this.m_transitionMask=document.createElementNS("http://www.w3.org/2000/svg","mask");defs.appendChild(this.m_transitionMask);this.m_transitionMaskID="transitionMask"+String((DWSVGAdapter.m_maskId++));this.m_transitionMask.setAttribute("id",this.m_transitionMaskID);this.m_transitionMask.setAttribute("maskContentUnits","userSpaceOnUse");}else{DWSVGHelper.removeChildren(this.m_transitionMask);}if(targetElement){targetElement.setAttribute("mask","url(#"+this.m_transitionMaskID+")");}else{this.m_svgOuter.setAttribute("mask","url(#"+this.m_transitionMaskID+")");}return this.m_transitionMask;};DWSVGAdapter.prototype.removeTransitionMask=function(targetElement){if(targetElement==undefined)targetElement=null;if(targetElement){targetElement.removeAttribute("mask");}else{this.m_svgOuter.removeAttribute("mask");}};DWSVGAdapter.prototype.drawCanvas=function(ctx){ctx.save();this.m_object.applyTransformToCanvas(ctx);var rObject=new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight());ctx.rect(rObject.x,rObject.y,rObject.width,rObject.height);ctx.clip();if(this.m_currentBorderMaskPolygons&&(this.m_currentBorderMaskPolygons.length>=1)){this.m_currentBorderMaskPolygons[0].drawCanvas(ctx,true);ctx.save();ctx.clip();ctx.beginPath();}if(this.m_currentBackgroundBrush){ctx.rect(rObject.x,rObject.y,rObject.width,rObject.height);ctx.fillStyle="red";ctx.fill();}this.m_object.drawContentCanvas(ctx);if((!this.m_currentBackgroundBrush)&&this.m_currentImage){if(this.m_currentImage.type()=="DWBitmapImage"){this.drawBitmapImage(ctx);}else{if(this.m_currentImage.type()=="DWVectorImage"){this.drawVectorImage(ctx);}}}if(this.m_currentBorderMaskPolygons&&(this.m_currentBorderMaskPolygons.length>=1)){ctx.restore();}if(this.m_currentBorderPolygons){for(var i=0;i<this.m_currentBorderPolygons.length;i++){this.m_currentBorderPolygons[i].drawCanvas(ctx);}}ctx.restore();};DWSVGAdapter.prototype.drawBitmapImage=function(ctx){var image=this.m_currentImage;if(image.m_url&&image.m_url.length){var rObject=new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight());if(this.m_imageArea){rObject=this.m_imageArea;}var img=document.createElement("img");img.setAttribute("src",image.m_url);img.setAttribute("width",String(image.m_srcRect.width));img.setAttribute("height",String(image.m_srcRect.height));if(image.m_mode==2){var w=image.m_srcRect.width;var h=image.m_srcRect.height;var iXTiles=Math.floor((rObject.width/w))+1;var iYTiles=Math.floor((rObject.height/h))+1;for(var iY=0;iY<iYTiles;iY++){for(var iX=0;iX<iXTiles;iX++){ctx.drawImage(img,image.m_srcRect.left(),image.m_srcRect.top(),w,h,((-rObject.width)/2)+(iX*w),((-rObject.height)/2)+(iY*h),w,h);}}}else{switch(image.m_mode){case 0:ctx.drawImage(img,(-rObject.width)/2,(-rObject.height)/2);break;case 1:ctx.drawImage(img,image.m_srcRect.x,image.m_srcRect.y,image.m_srcRect.width,image.m_srcRect.height,(-rObject.width)/2,(-rObject.height)/2,rObject.width,rObject.height);break;case 4:var scaleX=rObject.width/image.m_srcRect.width;var scaleY=rObject.height/image.m_srcRect.height;var offX=0;var offY=0;if(scaleX>scaleY){offX=(rObject.width-(image.m_srcRect.width*scaleY))/2;scaleX=scaleY;}else{offY=(rObject.height-(image.m_srcRect.height*scaleX))/2;scaleY=scaleX;}var w=image.m_srcRect.width;var h=image.m_srcRect.height;ctx.drawImage(img,image.m_srcRect.left(),image.m_srcRect.top(),w,h,offX-(rObject.width/2),offY-(rObject.height/2),w*scaleX,h*scaleY);break;case 3:ctx.drawImage(img,image.m_srcRect.left(),image.m_srcRect.top(),image.m_srcRect.width,image.m_srcRect.height,(-image.m_srcRect.width)/2,(-image.m_srcRect.height)/2,image.m_srcRect.width,image.m_srcRect.height);break;}}}};DWSVGAdapter.prototype.drawVectorImage=function(ctx){var image=this.m_currentImage;var rObject=new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight());if(this.m_imageArea){rObject=this.m_imageArea;}var scaleX=rObject.width/image.m_srcRect.width;var scaleY=rObject.height/image.m_srcRect.height;var offX=0;var offY=0;if(image.m_mode==4){if(scaleX>scaleY){scaleX=scaleY;offX=(rObject.width-(image.m_srcRect.width*scaleY))/2;}else{scaleY=scaleX;offY=(rObject.height-(image.m_srcRect.height*scaleX))/2;}}ctx.save();var pt=image.m_srcRect.centre();ctx.translate(rObject.x+(rObject.width/2),rObject.y+(rObject.height/2));ctx.scale(scaleX,scaleY);ctx.translate(-pt.x,-pt.y);for(var i=0;i<image.m_polygons.length;i++){image.m_polygons[i].drawCanvas(ctx);}ctx.restore();};DWDIVSVGAdapter=function(theObject){DWSVGAdapter.call(this,theObject);this.m_element=theObject.element();for(var i=0;i<this.m_element.childNodes.length;i++){if((this.m_element.childNodes[i].tagName=="iframe")||(this.m_element.childNodes[i].tagName=="IFRAME")){this.m_iframeElement=this.m_element.childNodes[i];break;}}};__inherit(DWDIVSVGAdapter,DWSVGAdapter);DWDIVSVGAdapter.prototype.m_element=null;DWDIVSVGAdapter.prototype.m_iframeElement=null;DWDIVSVGAdapter.prototype.type=function(){return "DWDIVSVGAdapter";};DWDIVSVGAdapter.prototype.updateTransform=function(){var transform="";var translate=this.m_object.getTranslate();if((translate.x!=0)||(translate.y!=0)){transform+=(((("translate("+translate.x)+"px,")+translate.y)+"px) ");}var rotate=this.m_object.getRotate();if(rotate!=0){transform+=(("rotate("+rotate)+"deg) ");}var scale=this.m_object.getScale();if((scale.x!=1)||(scale.y!=1)){transform+=(((("scale("+scale.x)+",")+scale.y)+") ");}var preTranslate=this.m_object.getPreTranslate();if((preTranslate.x!=0)&&(preTranslate.y!=0)){transform+=(((("translate("+preTranslate.x)+"px,")+preTranslate.y)+"px) ");}this.setStyleProperty("transform",transform);this.setStyleProperty("-ms-transform",transform);this.setStyleProperty("-moz-transform",transform);this.setStyleProperty("-webkit-transform",transform);this.setStyleProperty("-o-transform",transform);};DWDIVSVGAdapter.prototype.updateFromMasterTransform=function(){var pt=new DWPoint(0,0);var grParent=this.m_object.getParent();while(grParent&&(grParent.element()==null)){pt=grParent.pointToParent(pt);grParent=grParent.getParent();}var ptOffset=this.m_object.getDivObjectOffset();if(ptOffset){pt=pt.subtract(ptOffset);}this.m_object.setTranslate(pt.x,pt.y);};DWDIVSVGAdapter.prototype.setStyleProperty=function(propertyName,value){if(this.m_object.element().style.setProperty!=undefined){this.m_object.element().style.setProperty(propertyName,value,"important");}this.m_object.element().style[propertyName]=value;};DWDIVSVGAdapter.prototype.show=function(){this.setStyleProperty("visibility","visible");if(this.m_iframeElement){if(this.m_iframeElement.style.setProperty!=undefined){this.m_iframeElement.style.setProperty("display","inherit","important");}this.m_iframeElement.style["display"]="inherit";}};DWDIVSVGAdapter.prototype.hide=function(){this.setStyleProperty("visibility","hidden");if(this.m_iframeElement){if(this.m_iframeElement.style.setProperty!=undefined){this.m_iframeElement.style.setProperty("display","none","important");}this.m_iframeElement.style["display"]="none";}};DWDIVSVGAdapter.prototype.setAlpha=function(alpha){DWSVGAdapter.prototype.setAlpha.call(this,alpha);};DWDIVSVGAdapter.prototype.setLayer=function(z){this.setStyleProperty("z-index",String(z));this.m_layer=z;};DWDelayedCall=function(call,delayMs){this.m_function=call;this.m_delay=delayMs;this.m_start=new Date().getTime();DWUpdateController.addUpdate(this);};DWDelayedCall.prototype.m_function=null;DWDelayedCall.prototype.m_delay=null;DWDelayedCall.prototype.m_start=null;DWDelayedCall.prototype.update=function(time){var now=new Date().getTime();if((now-this.m_start)>=this.m_delay){DWUpdateController.removeUpdate(this);this.m_function();}};DWDelayedCall.prototype.cancel=function(){DWUpdateController.removeUpdate(this);};DWDragDropController=function(object,dragReturn,dragRestrict){this.m_object=object;this.m_dragReturn=dragReturn;this.m_dragRestrict=dragRestrict;};DWDragDropController.prototype.m_object=null;DWDragDropController.prototype.m_dragReturn=null;DWDragDropController.prototype.m_dragRestrict=null;DWDragDropController.prototype.m_dragging=false;DWDragDropController.prototype.m_returning=false;DWDragDropController.prototype.isDragging=function(){return this.m_dragging;};DWDragDropController.prototype.isReturning=function(){return this.m_returning;};DWDragDropController.prototype.m_startPosition=null;DWDragDropController.prototype.m_startTranslate=null;DWDragDropController.prototype.m_initialTranslate=null;DWDragDropController.prototype.beginDrag=function(pos){this.m_dragging=true;if(!this.m_object.isDropped()){this.m_initialTranslate=this.m_object.getTranslate();}else{this.m_object.getDroppedOn().unDropObject(this.m_object);}this.m_startTranslate=this.m_object.getTranslate();this.m_startPosition=pos;this.m_object.setCapture();this.m_object.setBaseAppearance(0x3d);this.m_object.getAdapter().setLayer(0x64);};DWDragDropController.prototype.updateDrag=function(pos){var movex=pos.x-this.m_startPosition.x;var movey=pos.y-this.m_startPosition.y;movex+=this.m_startTranslate.x;movey+=this.m_startTranslate.y;if(this.m_dragRestrict){if(this.m_object.getParent().isGraphicalObject()){var parent=this.m_object.getParent();var rParent=parent.getTransformedBoundingRect();var rObj=this.m_object.getTransformedBoundingRect();rObj.offsetRect(-this.m_object.getTranslate().x,-this.m_object.getTranslate().y);if((rObj.left()+movex)<rParent.left()){movex=rParent.left()-rObj.left();}if((rObj.right()+movex)>rParent.right()){movex=rParent.right()-rObj.right();}if((rObj.top()+movey)<rParent.top()){movey=rParent.top()-rObj.top();}if((rObj.bottom()+movey)>rParent.bottom()){movey=rParent.bottom()-rObj.bottom();}}}this.m_object.setTranslate(movex,movey);this.testDrop(false,pos);};DWDragDropController.prototype.testDrop=function(dropped,pos){var parent=this.m_object.getParent();return this.doTestDrop(parent,dropped,pos);};DWDragDropController.prototype.doTestDrop=function(parent,dropped,pos){var rect=this.m_object.getTransformedBoundingRect();var siblings=parent.getChildren();if(siblings){for(var i=0;i<siblings.length;i++){if((siblings[i]!=this.m_object)&&siblings[i].isGraphicalObject()){var sibling=siblings[i];if(sibling.isDropEnabled()){var rd=sibling.getTransformedBoundingRect();var drop=sibling.hitTest(pos);if(drop){drop=(sibling.isDropFitInside()?rd.contains(rect):rd.intersects(rect));}if(drop){var dropOn=siblings[i];if(dropOn.canDrop(this.m_object)){sibling.setBaseAppearance(0x32);this.m_object.setBaseAppearance(0x40);return sibling;}else{sibling.setBaseAppearance(0x33);this.m_object.setBaseAppearance(0x41);if(dropped){sibling.triggerEvents(new DWDropTrigger(0x800205,this.m_object.getObjectCode()));}}}}var drop=this.doTestDrop(siblings[i],dropped,pos);if(drop!=null){return drop;}}}}this.m_object.setBaseAppearance(0x3d);return null;};DWDragDropController.prototype.m_startReturnTranslate=null;DWDragDropController.prototype.m_startReturn=0;DWDragDropController.prototype.endDrag=function(pos){this.updateDrag(pos);this.m_dragging=false;this.m_object.releaseCapture();this.m_object.getAdapter().setLayer(0);var drop=this.testDrop(true,pos);if(drop!=null){drop.dropObject(this.m_object);}else{this.returnObject();}};DWDragDropController.prototype.returnObject=function(dontAnimate){if(dontAnimate==undefined)dontAnimate=false;if(this.m_dragReturn!=0){if(!dontAnimate){this.m_object.setBaseAppearance(0x3e);this.m_returning=true;this.m_startReturn=new Date().getTime();this.m_startReturnTranslate=this.m_object.getTranslate();DWUpdateController.addAnimationUpdate(this);}else{this.m_object.setTranslate(this.m_initialTranslate.x,this.m_initialTranslate.y);this.m_returning=false;this.m_object.setBaseAppearance(1);}}else{this.m_object.setBaseAppearance(1);}};DWDragDropController.prototype.update=function(time){var now=new Date().getTime();var pos=now-this.m_startReturn;if(pos>this.m_dragReturn){DWUpdateController.removeAnimationUpdate(this);this.m_object.setTranslate(this.m_initialTranslate.x,this.m_initialTranslate.y);this.m_returning=false;this.m_object.setBaseAppearance(1);}else{pos/=this.m_dragReturn;var x=((this.m_initialTranslate.x-this.m_startReturnTranslate.x)*pos)+this.m_startReturnTranslate.x;var y=((this.m_initialTranslate.y-this.m_startReturnTranslate.y)*pos)+this.m_startReturnTranslate.y;this.m_object.setTranslate(x,y);}};DWDropTrigger=function(code){this.m_code=code;if(arguments.length>1){this.m_objects=new Array();for(var i=1;i<arguments.length;i++){this.m_objects.push(arguments[i]);}}};__inherit(DWDropTrigger,DWTrigger);DWDropTrigger.prototype.m_code=null;DWDropTrigger.prototype.m_objects=null;DWDropTrigger.prototype.type=function(){return "DWDropTrigger";};DWDropTrigger.prototype.match=function(other){if(other.type()=="DWDropTrigger"){var otherDrop=other;if(otherDrop.m_code!=this.m_code){return false;}if(this.m_code==0x800204){return true;}if((!this.m_objects)||(this.m_objects.length!=1)){;return false;}if(otherDrop.m_objects==null){return true;}for(var i=0;i<otherDrop.m_objects.length;i++){if(otherDrop.m_objects[i].compare(this.m_objects[0])){return true;}}}return false;};DWEvent=function(triggers,actions){this.m_triggers=triggers;this.m_actions=actions;};DWEvent.prototype.m_triggers=null;DWEvent.prototype.m_actions=null;DWEvent.prototype.Trigger=function(trigger){var b=false;for(var i=0;i<this.m_triggers.length;i++){if(trigger.match(this.m_triggers[i])){this.m_actions.Go(null);b=true;}}return b;};DWEvent.prototype.hasTrigger=function(trigger){for(var i=0;i<this.m_triggers.length;i++){if(trigger.match(this.m_triggers[i])){return true;}}return false;};DWEvent.prototype.initEvents=function(host){this.m_triggers.initEvents(host);this.m_actions.initEvents(host);};DWEvent.prototype.closeEvents=function(host){this.m_triggers.closeEvents(host);this.m_actions.closeEvents(host);};DWEventList=function(){if((arguments.length>=1)&&(arguments[0]!=null)){this.length=arguments.length;for(var i=0;i<this.length;i++){this[i]=arguments[i];}}};DWEventList.prototype.Trigger=function(trigger){var b=false;for(var i=0;i<this.length;i++){b|=this[i].Trigger(trigger);}return b;};DWEventList.prototype.hasTrigger=function(trigger){for(var i=0;i<this.length;i++){if(this[i].hasTrigger(trigger)){return true;}}return false;};DWEventList.prototype.initEvents=function(host){for(var i=0;i<this.length;i++){this[i].initEvents(host);}};DWEventList.prototype.closeEvents=function(host){for(var i=0;i<this.length;i++){this[i].closeEvents(host);}};DWFPSDisplay=function(){this.m_element=document.createElement("div");document.body.appendChild(this.m_element);window.addEventListener("resize",this.onWindowResize.bind(this),false);this.setStyleProperty("z-index","1000");this.setStyleProperty("background-color","#ff00ff");this.setStyleProperty("color","#000000");this.setStyleProperty("position","absolute");this.setStyleProperty("top","0px");this.setStyleProperty("left","480px");this.setStyleProperty("width","80px");this.setStyleProperty("height","20px");this.m_element.innerHTML="";this.onWindowResize();DWUpdateController.addAnimationUpdate(this);};DWFPSDisplay.prototype.m_element=null;DWFPSDisplay.prototype.onWindowResize=function(){this.setStyleProperty("left",String((window.innerWidth-0x50))+"px");};DWFPSDisplay.prototype.setStyleProperty=function(propertyName,value){if(this.m_element.style.setProperty!=undefined){this.m_element.style.setProperty(propertyName,value,"important");}this.m_element.style[propertyName]=value;};DWFPSDisplay.prototype.m_counter=0;DWFPSDisplay.prototype.m_last=0;DWFPSDisplay.prototype.m_lastTime=0;DWFPSDisplay.prototype.update=function(time){if(this.m_lastTime==0){this.m_lastTime=new Date().getTime();}else{var now=new Date().getTime();if((now-this.m_lastTime)>=0xfa){var fps=((this.m_counter-this.m_last)*0x3e8)/(now-this.m_lastTime);this.m_element.innerHTML=String(Math.floor(fps+0.5))+"FPS";this.m_last=this.m_counter;this.m_lastTime=now;}}this.m_counter++;};DWFlareElement=function(width,blur,colour){this.m_width=width;this.m_blur=blur;this.m_colour=colour;};DWFlareElement.prototype.m_width=null;DWFlareElement.prototype.m_blur=null;DWFlareElement.prototype.m_colour=null;DWFlareElement.prototype.apply=function(object){object.getAdapter().setFlare(this.m_width,this.m_blur,this.m_colour);};DWFrame=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWFrame,DWGraphicalObject);DWFrame.prototype.type=function(){return "Frame";};DWFrame.prototype.startObject=function(parentVisible){if(this.getParent().type()=="MultiFrame"){this.m_initiallyVisible=false;}DWGraphicalObject.prototype.startObject.call(this,parentVisible);};DWFrame.prototype.doShow=function(transition){if(transition==undefined)transition=null;if(this.getParent().type()=="MultiFrame"){var mf=this.getParent();mf.onShowChild(this);}else{DWGraphicalObject.prototype.doShow.call(this,transition);}};DWFrame.prototype.onShowFinished=function(){DWGraphicalObject.prototype.onShowFinished.call(this);if(this.getParent().type()=="MultiFrame"){var mf=this.getParent();mf.onChildShowFinished(this);}};DWFrame.prototype.onShowParentFinished=function(){var trSave=null;if(this.getParent().type()=="MultiFrame"){trSave=this.m_showTransition;this.m_showTransition=null;}DWGraphicalObject.prototype.onShowParentFinished.call(this);if(trSave){this.m_showTransition=trSave;}};DWFrame.prototype.getScrollRange=function(){var width=this.getWidth();var height=this.getHeight();var cr=new DWRect();if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.type()!="Scrollbar"){var rect=child.getTransformedBoundingRect();rect.offsetRect(this.m_scrollPosX,this.m_scrollPosY);var ptTL=rect.topLeft();var ptBR=rect.bottomRight();ptTL=this.pointFromPage(ptTL);ptBR=this.pointFromPage(ptBR);rect=new DWRect(ptTL.x,ptTL.y,ptBR.x-ptTL.x,ptBR.y-ptTL.y);rect.offsetRect(this.getWidth()/2,this.getHeight()/2);if(!cr.isEmpty()){cr=DWRect.union(cr,rect);}else{cr=rect;}}else{var sb=child;if(sb.isVertical()){width-=sb.getWidth();}else{height-=sb.getHeight();}}}}}var ptBR=cr.bottomRight();var ptRange=new DWPoint(ptBR.x-width,ptBR.y-height);if(ptRange.x<0)ptRange.x=0;if(ptRange.y<0)ptRange.y=0;return ptRange;};DWFrame.prototype.setScrollPosition=function(x,y){var ptRange=this.getScrollRange();this.m_scrollPosX=x;if(this.m_scrollPosX<0)this.m_scrollPosX=0;if(this.m_scrollPosX>=ptRange.x)this.m_scrollPosX=ptRange.x-1;this.m_scrollPosY=y;if(this.m_scrollPosY<0)this.m_scrollPosY=0;if(this.m_scrollPosY>ptRange.y)this.m_scrollPosY=ptRange.y;if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.type()!="Scrollbar"){child.setTranslate(-this.m_scrollPosX,-this.m_scrollPosY);}}}}if(this.m_scrollCallbacks){for(var i=0;i<this.m_scrollCallbacks.length;i++){var fn=this.m_scrollCallbacks[i];fn();}}};DWFrame.prototype.GetQuestionValue=function(){return 0;};DWFrame.prototype.GetQuestionPossible=function(){return 0;};DWFrame.prototype.GetQuestionCorrect=function(){return 0;};DWFrame.prototype.GetQuestionIncorrect=function(){return 0;};DWFrame.prototype.ConfirmQuestion=function(){};DWFrame.prototype.ResetQuestion=function(){};DWFrame.prototype.SetUserAnswer=function(answer){};DWFrame.prototype.ResetUserAnswer=function(answer){};DWGeometry=function(){};DWGeometry.intersectPolygons=function(pts1,pts2){for(var i=0;i<pts1.length;i++){var a1=pts1[i];var a2=pts1[((i+1)==pts1.length?0:i+1)];for(var j=0;j<pts2.length;j++){var b1=pts2[j];var b2=pts2[((j+1)==pts2.length?0:j+1)];if(DWGeometry.intersectLines(a1,a2,b1,b2)){return true;}}}if(DWGeometry.pointInPolygon(pts1[0],pts2)){return true;}if(DWGeometry.pointInPolygon(pts2[0],pts1)){return true;}return false;};DWGeometry.pointInPolygon=function(pt,pts2){var ptInfinity=new DWPoint(0xf4240,pt.y);var count=0;for(var j=0;j<pts2.length;j++){var b1=pts2[j];var b2=pts2[((j+1)==pts2.length?0:j+1)];if(DWGeometry.intersectLines(pt,ptInfinity,b1,b2)){count++;}}return (count%2)!=0;};DWGeometry.pointInDWPolygon=function(_pt,poly){var pt=new DWPoint(_pt.x,_pt.y);if(poly.m_origin){pt=pt.subtract(poly.m_origin);}var ptInfinity=new DWPoint(0xf4240,0xf4240);var count=0;var b1=null;var pts=poly.getHitTestPolygon();for(var j=0;j<pts.length;){var b2=null;switch(pts[j]){case "M":b2=new DWPoint(pts[j+1],pts[j+2]);j+=3;break;case "L":b2=new DWPoint(pts[j+1],pts[j+2]);j+=3;if(DWGeometry.intersectLines(pt,ptInfinity,b1,b2)){count++;}break;case "C":b2=new DWPoint(pts[j+5],pts[j+6]);if(DWGeometry.intersectLines(pt,ptInfinity,b1,b2)){count++;}j+=7;break;case "Q":j+=5;break;case "Z":b2=new DWPoint(pts[1],pts[2]);j++;break;}b1=b2;}return (count%2)!=0;};DWGeometry.intersectLines=function(pntLine1Start,pntLine1End,pntLine2Start,pntLine2End){var x1lo=0;var x1hi=0;var y1lo=0;var y1hi=0;var Ax=pntLine1End.x-pntLine1Start.x;var Bx=pntLine2Start.x-pntLine2End.x;if(Ax<0){x1lo=pntLine1End.x;x1hi=pntLine1Start.x;}else{x1hi=pntLine1End.x;x1lo=pntLine1Start.x;}if(Bx>0){if((x1hi<pntLine2End.x)||(pntLine2Start.x<x1lo)){return false;}}else{if((x1hi<pntLine2Start.x)||(pntLine2End.x<x1lo)){return false;}}var Ay=pntLine1End.y-pntLine1Start.y;var By=pntLine2Start.y-pntLine2End.y;if(Ay<0){y1lo=pntLine1End.y;y1hi=pntLine1Start.y;}else{y1hi=pntLine1End.y;y1lo=pntLine1Start.y;}if(By>0){if((y1hi<pntLine2End.y)||(pntLine2Start.y<y1lo)){return false;}}else{if((y1hi<pntLine2Start.y)||(pntLine2End.y<y1lo)){return false;}}var Cx=pntLine1Start.x-pntLine2Start.x;var Cy=pntLine1Start.y-pntLine2Start.y;var d=(By*Cx)-(Bx*Cy);var f=(Ay*Bx)-(Ax*By);if(f>0){if((d<0)||(d>f)){return false;}}else{if(f<0){if((d>0)||(d<f)){return false;}}}var e=(Ax*Cy)-(Ay*Cx);if(f>0){if((e<0)||(e>f)){return false;}}else{if((e>0)||(e<f)){return false;}}if(f==0){return true;}return true;};DWGeometry.createHitTestPolygon=function(pts){var pd=new Array();var b1=null;for(var j=0;j<pts.length;){switch(pts[j]){case "M":case "L":b1=new DWPoint(pts[j+1],pts[j+2]);pd.push(pts[j]);pd.push(pts[j+1]);pd.push(pts[j+2]);j+=3;break;case "C":var o=DWGeometry.getBezierCoefficient(b1,pts,j+1,0.2);DWGeometry.bezierPoints(pd,b1,pts,j+1,o.fBezierCoeff,o.nPoints);b1=new DWPoint(pts[j+5],pts[j+6]);j+=7;break;case "Q":j+=5;break;case "Z":pd.push(pts[j]);j++;break;}}return pd;};DWGeometry.getBezierCoefficient=function(p1,pts,idx,fMinDelta){if(fMinDelta==undefined)fMinDelta=0.01;var fCurveCoeff=0.3;var Z0y=(pts[(idx+3)]-(pts[(idx+1)]*2))+p1.y;var Z0x=(pts[(idx+2)]-(pts[idx]*2))+p1.x;var Z1y=(pts[(idx+5)]-(pts[(idx+3)]*2))+pts[(idx+1)];var Z1x=(pts[(idx+4)]-(pts[(idx+2)]*2))+pts[idx];var Z0=(Z0x*Z0x)+(Z0y*Z0y);var Z1=(Z1x*Z1x)+(Z1y*Z1y);if(Z0<Z1)Z0=Z1;var fZ0_1=1/Math.sqrt(Z0);fZ0_1*=fCurveCoeff;fZ0_1=1/Math.sqrt(fZ0_1);var iStepNo=Math.floor(fZ0_1);fZ0_1*=fZ0_1;fZ0_1=1/Math.sqrt(fZ0_1);var fDelta=fZ0_1;if(fDelta<fMinDelta){fDelta=fMinDelta;if(fMinDelta==0.01){iStepNo=0x63;}else{iStepNo=Math.floor(1/fMinDelta);}}if(iStepNo<2){iStepNo=2;fDelta=0.5;}var obj=new Object();obj.fBezierCoeff=fDelta;obj.nPoints=iStepNo+1;return obj;};DWGeometry.bezierPoints=function(dst,p1,pts,idx,d,nPoints){var d2=d*d;var d3=d2*d;var C1=((pts[(idx+4)]+(3*(pts[idx]-pts[(idx+2)])))-p1.x)*d3;var C2=3*((pts[(idx+2)]-(2*pts[idx]))+p1.x)*d2;var C3=3*(pts[idx]-p1.x)*d;var C4=p1.x;var d0x=C4;var d1x=C1+C2+C3;var d2x=2*((3*C1)+C2);var d3x=6*C1;C1=((pts[(idx+5)]+(3*(pts[(idx+1)]-pts[(idx+3)])))-p1.y)*d3;C2=3*((pts[(idx+3)]-(2*pts[(idx+1)]))+p1.y)*d2;C3=3*(pts[(idx+1)]-p1.y)*d;C4=p1.y;var d0y=C4;var d1y=C1+C2+C3;var d2y=2*((3*C1)+C2);var d3y=6*C1;var iStepLoop=nPoints-2;while(iStepLoop--){dst.push("L");d0x+=d1x;d1x+=d2x;d2x+=d3x;dst.push(d0x);d0y+=d1y;d1y+=d2y;d2y+=d3y;dst.push(d0y);}dst.push("L");dst.push(pts[idx+4]);dst.push(pts[idx+5]);};DWGotoLayerAction=function(obj,layer){this.m_object=obj;this.m_layer=layer;};__inherit(DWGotoLayerAction,DWAction);DWGotoLayerAction.prototype.m_object=null;DWGotoLayerAction.prototype.m_layer=null;DWGotoLayerAction.prototype.Go=function(callback){this.m_object.getAdapter().setLayer(this.m_layer);return 0;};DWGotoPageAction=function(name){this.m_name=name;};__inherit(DWGotoPageAction,DWAction);DWGotoPageAction.prototype.m_name=null;DWGotoPageAction.prototype.Go=function(callback){DWPublication.instance().gotoPage(this.m_name);return 0;};DWGotoRandomPageAction=function(chapterCode,reset){this.m_chapterCode=chapterCode;this.m_reset=reset;};__inherit(DWGotoRandomPageAction,DWAction);DWGotoRandomPageAction.prototype.m_chapterCode=null;DWGotoRandomPageAction.prototype.m_reset=null;DWGotoRandomPageAction.prototype.Go=function(callback){var chapter=DWPublication.instance().findChildByCode(new DWObjectCode(0,2,this.m_chapterCode));if(chapter){chapter.gotoRandomPage(this.m_reset);}return 0;};DWGradientColourStop=function(_pos,_colour){this.pos=_pos;this.colour=_colour;};DWGradientColourStop.prototype.pos=null;DWGradientColourStop.prototype.colour=null;DWHTMLObject=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWHTMLObject,DWGraphicalObject);DWHTMLObject.prototype.m_html=null;DWHTMLObject.prototype.type=function(){return "HTMLObject";};DWHTMLObject.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);};DWHTMLObject.prototype.stopObject=function(){DWGraphicalObject.prototype.stopObject.call(this);};DWTextExpression=function(expression){this.m_expression=expression;};DWTextExpression.prototype.m_expression=null;DWTextExpression.prototype.start=function(){DWUpdateController.addUpdate(this);};DWTextExpression.prototype.stop=function(){DWUpdateController.removeUpdate(this);};DWTextExpression.prototype.update=function(time){};DWHTMLTextExpression=function(objectID,expression){DWTextExpression.call(this,expression);this.m_object=document.getElementById(objectID);};__inherit(DWHTMLTextExpression,DWTextExpression);DWHTMLTextExpression.prototype.m_object=null;DWHTMLTextExpression.prototype.update=function(time){var result=this.m_expression();if(result==undefined){result="";}else{result=String(result);}if(result!=this.m_object.innerHTML){this.m_object.innerHTML=result;}};DWTextVariable=function(name){this.m_name=name;};DWTextVariable.prototype.m_name=null;DWTextVariable.prototype.start=function(){DWVariables.instance().registerCallback(this.m_name,this);this.variableChanged(this.m_name);};DWTextVariable.prototype.stop=function(){DWVariables.instance().unregisterCallback(this.m_name,this);};DWTextVariable.prototype.variableChanged=function(name){};DWHTMLTextVariable=function(objectID,name){DWTextVariable.call(this,name);this.m_object=document.getElementById(objectID);};__inherit(DWHTMLTextVariable,DWTextVariable);DWHTMLTextVariable.prototype.m_object=null;DWHTMLTextVariable.prototype.variableChanged=function(name){if(name==this.m_name){var value=DWVariables.instance().getValue(this.m_name);if(value==undefined){value="";}value=String(value);while(value.indexOf("<",0)!=(-1)){value=value.replace("<","&lt");}while(value.indexOf(">",0)!=(-1)){value=value.replace(">","&gt");}while(value.indexOf("\n",0)!=(-1)){value=value.replace("\n","<br>");}this.m_object.innerHTML=value;}};DWHypertext=function(element){this.m_element=element;this.m_element.addEventListener("click",this.onClick.bind(this),true);};__inherit(DWHypertext,DWHotspot);DWHypertext.prototype.m_element=null;DWHypertext.prototype.onClick=function(e){;this.onMouseUp(e);};DWImage=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWImage,DWGraphicalObject);DWImage.prototype.type=function(){return "Image";};DWImage.prototype.getScrollableContent=function(scrollRange){var image=this.getAdapter().getCurrentImage();if(image){if(image.m_mode==0){scrollRange.x=image.m_srcRect.width-this.getWidth();scrollRange.y=image.m_srcRect.height-this.getHeight();return this.getAdapter().getImageGroup();}}return null;};DWImageElement=function(image,mode,translateX,translateY,scaleX,scaleY){this.m_image=image;this.m_mode=mode;this.m_translate=new DWPoint(translateX,translateY);this.m_scale=new DWPoint(scaleX,scaleY);};DWImageElement.prototype.m_image=null;DWImageElement.prototype.m_mode=null;DWImageElement.prototype.m_translate=null;DWImageElement.prototype.m_scale=null;DWImageElement.prototype.m_polygons=null;DWImageElement.prototype.apply=function(object){object.getAdapter().setImage(this.m_image);};DWLaunchURLAction=function(url,target){this.m_url=url;this.m_target=target;};__inherit(DWLaunchURLAction,DWAction);DWLaunchURLAction.prototype.m_url=null;DWLaunchURLAction.prototype.m_target=null;DWLaunchURLAction.prototype.Go=function(callback){var variables=DWVariables.instance();var url="";for(var i=0;i<this.m_url.length;){if(this.m_url[i]=="<"){i++;var v="";while((i<this.m_url.length)&&(this.m_url[i]!=">")){v+=this.m_url[(i++)];}var value=variables.getValue(v);if(value!=null){url+=value;}i++;}else{url+=this.m_url[(i++)];}}window.open(url,this.m_target);return 0;};DWLinearGradientBrush=function(angle){this.m_angle=angle;};DWLinearGradientBrush.prototype.m_angle=null;DWLinearGradientBrush.prototype.m_stops=null;DWLinearGradientBrush.prototype.createCopy=function(){var copy=new DWLinearGradientBrush(this.m_angle);for(var i=0;i<this.m_stops.length;i++){copy.addColourStop(this.m_stops[i].pos,this.m_stops[i].colour);}return copy;};DWLinearGradientBrush.prototype.addColourStop=function(pos,colour){if(!this.m_stops){this.m_stops=new Array();}this.m_stops.push(new DWGradientColourStop(pos,colour));return this;};DWLinearGradientBrush.prototype.apply=function(ctx){var r=new DWRect(0,0,0x64,0x64);var p1=new DWPoint();var p2=new DWPoint();this.computePoints(p1,p2,r);var grd=ctx.createLinearGradient(p1.x,p1.y,p2.x,p2.y);for(var i=0;i<this.m_stops.length;i++){grd.addColorStop(this.m_stops[i].pos,this.m_stops[i].colour.toString());}ctx.fillStyle=grd;ctx.fill();};DWLinearGradientBrush.prototype.applyCanvas=function(ctx){ctx.fillStyle=this.m_stops[0].colour.toString();};DWLinearGradientBrush.m_idCount=0;DWLinearGradientBrush.prototype.m_lgElement=null;DWLinearGradientBrush.prototype.m_lgID=null;DWLinearGradientBrush.prototype.applySVG=function(obj){if(!this.m_lgElement){var defs=DWSVGHelper.getDefsElement(obj);this.m_lgElement=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");defs.appendChild(this.m_lgElement);this.m_lgID="_lgb"+String((DWLinearGradientBrush.m_idCount++));this.m_lgElement.setAttribute("id",this.m_lgID);}var r=new DWRect(0,0,0x64,0x64);var p1=new DWPoint();var p2=new DWPoint();this.computePoints(p1,p2,r);var rSVG=obj.getBBox();this.m_lgElement.setAttribute("x1",String(p1.x)+"%");this.m_lgElement.setAttribute("y1",String(p1.y)+"%");this.m_lgElement.setAttribute("x2",String(p2.x)+"%");this.m_lgElement.setAttribute("y2",String(p2.y)+"%");var s=0;var i=0;for(;(i<this.m_lgElement.childNodes.length)&&(s<this.m_stops.length);i++){if(this.m_lgElement.childNodes[i].nodeName=="stop"){var stop=this.m_lgElement.childNodes[i];stop.setAttribute("offset",String((this.m_stops[s].pos*0x64))+"%");stop.setAttribute("stop-color",this.m_stops[s].colour.toString());s++;}}if(s<this.m_stops.length){for(;s<this.m_stops.length;s++){var stop=document.createElementNS("http://www.w3.org/2000/svg","stop");this.m_lgElement.appendChild(stop);stop.setAttribute("offset",String((this.m_stops[s].pos*0x64))+"%");stop.setAttribute("stop-color",this.m_stops[s].colour.toString());}}else{if(i<this.m_lgElement.childNodes.length){for(;i<this.m_lgElement.childNodes.length;i++){if(this.m_lgElement.childNodes[i].nodeName=="stop"){this.m_lgElement.removeChild(this.m_lgElement.childNodes[i]);i--;}}}}obj.setAttribute("fill","url(#"+this.m_lgID+")");};DWLinearGradientBrush.prototype.removeSVG=function(obj){if(this.m_lgElement){var defs=DWSVGHelper.getDefsElement(obj);defs.removeChild(this.m_lgElement);DWSVGHelper.removeChildren(this.m_lgElement);this.m_lgElement=null;}obj.setAttribute("fill","none");};DWLinearGradientBrush.prototype.type=function(){return "Linear";};DWLinearGradientBrush.prototype.morph=function(b1,b2,pos){if((b1.type()!=this.type())||(b2.type()!=this.type())){return;}var l1=b1;var l2=b2;if(l1.m_stops.length!=l2.m_stops.length){return;}this.m_angle=l1.m_angle+(pos*(l2.m_angle-l1.m_angle));this.m_stops=new Array();for(var i=0;i<l1.m_stops.length;i++){var p=l1.m_stops[i].pos+(pos*(l2.m_stops[i].pos-l1.m_stops[i].pos));var c=DWColour.morph(l1.m_stops[i].colour,l2.m_stops[i].colour,pos);this.m_stops.push(new DWGradientColourStop(p,c));}};DWLinearGradientBrush.prototype.computePoints=function(start,end,rect){var width=rect.width/2;var height=rect.height/2;var beta=Math.atan2(width,height);var d=Math.sqrt((width*width)+(height*height));var theta=this.m_angle%Math.PI;if(theta>(Math.PI/2)){theta=Math.PI-theta;}var alpha=(Math.PI/2)-beta-theta;var l=d*Math.cos(alpha);start.x=rect.x+(width-(l*Math.cos(this.m_angle)));start.y=rect.y+(height-(l*Math.sin(this.m_angle)));end.x=rect.x+width+(l*Math.cos(this.m_angle));end.y=rect.y+height+(l*Math.sin(this.m_angle));};DWList=function(){};DWList.prototype.m_head=null;DWList.prototype.m_tail=null;DWList.prototype.m_count=0;DWList.prototype.size=function(){return this.m_count;};DWList.prototype.addTail=function(item){if(this.m_tail!=null){var n=new Object();this.m_tail.next=n;n.prev=this.m_tail;n.next=null;n.item=item;this.m_tail=n;}else{this.m_head=new Object();this.m_head.item=item;this.m_tail=this.m_head;this.m_head.next=null;this.m_head.prev=null;}this.m_count++;};DWList.prototype.push=function(item){this.addTail(item);};DWList.prototype.addHead=function(item){if(this.m_head!=null){var n=new Object();this.m_head.prev=n;n.next=this.m_head;n.prev=null;n.item=item;this.m_head=n;}else{this.m_head=new Object();this.m_head.item=item;this.m_tail=this.m_head;this.m_head.next=null;this.m_head.prev=null;}this.m_count++;};DWList.prototype.find=function(item){var it=this.m_head;while(it!=null){if(it.item==item){return it;}it=it.next;}return null;};DWList.prototype.remove=function(iterator){if(iterator.prev!=null){iterator.prev.next=iterator.next;}if(iterator.next!=null){iterator.next.prev=iterator.prev;}if(this.m_head==iterator){this.m_head=iterator.next;}if(this.m_tail==iterator){this.m_tail=iterator.prev;}this.m_count--;};DWList.prototype.getHeadPosition=function(){return this.m_head;};DWList.prototype.getTailPosition=function(){return this.m_tail;};DWList.prototype.getNext=function(iterator){return iterator.next;};DWList.prototype.getPrev=function(iterator){return iterator.prev;};DWList.prototype.getItem=function(iterator){return iterator.item;};DWMathVariableAction=function(name,value,isVariable,action){this.m_name=name;this.m_value=value;this.m_action=action;this.m_isVariable=isVariable;};__inherit(DWMathVariableAction,DWAction);DWMathVariableAction.prototype.m_name=null;DWMathVariableAction.prototype.m_value=null;DWMathVariableAction.prototype.m_action=null;DWMathVariableAction.prototype.m_isVariable=null;DWMathVariableAction.prototype.Go=function(callback){var variables=DWVariables.instance();var value=this.m_value;if(this.m_isVariable){value=variables.getValue(this.m_value);}var current=variables.getValue(this.m_name);if(this.m_action==0x6a4)current+=value;else if(this.m_action==0x6a5)current-=value;else if(this.m_action==0x6a6)current*=value;else if(this.m_action==0x6a7)current/=value;else if(this.m_action==0x6a8)current=Math.floor((value*Math.random())+1);else if(this.m_action==0x6a9)current=Math.floor(current+0.5);;;;;;variables.setValue(this.m_name,current);return 0;};DWMessage=function(isCreator){this.m_element=document.createElement("div");document.body.appendChild(this.m_element);window.addEventListener("resize",this.onWindowResize.bind(this),false);this.setStyleProperty("z-index","1000");this.setStyleProperty("background-color","#ffffff");this.setStyleProperty("color","#000020");this.setStyleProperty("position","fixed");this.setStyleProperty("padding","30px");this.setStyleProperty("border-style","double");this.setStyleProperty("border-width","5px");this.setStyleProperty("border-color","#333");this.setStyleProperty("opacity","0");this.setStyleProperty("visibility","hidden");this.setStyleProperty("text-align","center");this.m_element.addEventListener("mousedown",this.onMouseDown.bind(this),true);this.m_element.addEventListener("touchstart",this.onMouseDown.bind(this),true);if(isCreator){this.m_element.innerHTML=this.decode("\xcf\xe3\xe6\xe7\xa2\xf5\xeb\xf6\xea\xbe\xe0\xf0\xbc\xbe\xf1\xf2\xe3\xec\xa2\xf1\xf6\xfb\xee\xe7\xbf\xa0\xe4\xed\xec\xf6\xb8\xc3\xf0\xeb\xe3\xee\xb9\xa2\xe4\xed\xec\xf6\xaf\xf1\xeb\xf8\xe7\xb8\xb0\xb0\xf2\xfa\xb9\xa0\xbc\xcd\xf2\xf7\xf1\xa2\xc1\xf0\xe7\xe3\xf6\xed\xf0\xbe\xad\xf1\xf2\xe3\xec\xbc\xbe\xe0\xf0\xbc\xbe\xf1\xf2\xe3\xec\xa2\xf1\xf6\xfb\xee\xe7\xbf\xa0\xe4\xed\xec\xf6\xb8\xc3\xf0\xeb\xe3\xee\xb9\xa2\xe4\xed\xec\xf6\xaf\xf1\xeb\xf8\xe7\xb8\xb3\xb4\xf2\xfa\xb9\xa0\xbc\xc6\xe7\xef\xed\xa2\xd4\xe7\xf0\xf1\xeb\xed\xec\xbe\xad\xf1\xf2\xe3\xec\xbc\xbe\xe0\xf0\xbc\xbe\xf1\xf2\xe3\xec\xa2\xf1\xf6\xfb\xee\xe7\xbf\xa0\xe4\xed\xec\xf6\xb8\xc3\xf0\xeb\xe3\xee\xb9\xa2\xe4\xed\xec\xf6\xaf\xf1\xeb\xf8\xe7\xb8\xb3\xb4\xde\xa0\xbc\xbe\xe0\xf0\xbc\xbe\xc3\xa2\xea\xf0\xe7\xe4\xbf\xa0\xea\xf6\xf6\xf2\xb8\xad\xad\xf5\xf5\xf5\xac\xe6\xeb\xe5\xeb\xf6\xe3\xee\xf5\xed\xf0\xe9\xf1\xea\xed\xf2\xac\xe1\xed\xef\xa0\xbc\xea\xf6\xf6\xf2\xb8\xad\xad\xf5\xf5\xf5\xac\xe6\xeb\xe5\xeb\xf6\xe3\xee\xf5\xed\xf0\xe9\xf1\xea\xed\xf2\xac\xe1\xed\xef\xbe\xad\xc3\xbc\xbe\xad\xf1\xf2\xe3\xec\xbc");}else{this.m_element.innerHTML=this.decode("\xcf\xe3\xe6\xe7\xa2\xf5\xeb\xf6\xea\xbe\xe0\xf0\xbc\xbe\xf1\xf2\xe3\xec\xa2\xf1\xf6\xfb\xee\xe7\xbf\xa0\xe4\xed\xec\xf6\xb8\xc3\xf0\xeb\xe3\xee\xb9\xa2\xe4\xed\xec\xf6\xaf\xf1\xeb\xf8\xe7\xb8\xb0\xb0\xf2\xfa\xb9\xa0\xbc\xcd\xf2\xf7\xf1\xa2\xd2\xf0\xed\xe4\xe7\xf1\xf1\xeb\xed\xec\xe3\xee\xbe\xad\xf1\xf2\xe3\xec\xbc\xbe\xe0\xf0\xbc\xbe\xf1\xf2\xe3\xec\xa2\xf1\xf6\xfb\xee\xe7\xbf\xa0\xe4\xed\xec\xf6\xb8\xc3\xf0\xeb\xe3\xee\xb9\xa2\xe4\xed\xec\xf6\xaf\xf1\xeb\xf8\xe7\xb8\xb3\xb4\xf2\xfa\xb9\xa0\xbc\xc6\xe7\xef\xed\xa2\xd4\xe7\xf0\xf1\xeb\xed\xec\xbe\xad\xf1\xf2\xe3\xec\xbc\xbe\xe0\xf0\xbc\xbe\xf1\xf2\xe3\xec\xa2\xf1\xf6\xfb\xee\xe7\xbf\xa0\xe4\xed\xec\xf6\xb8\xc3\xf0\xeb\xe3\xee\xb9\xa2\xe4\xed\xec\xf6\xaf\xf1\xeb\xf8\xe7\xb8\xb3\xb4\xde\xa0\xbc\xbe\xe0\xf0\xbc\xbe\xc3\xa2\xea\xf0\xe7\xe4\xbf\xa0\xea\xf6\xf6\xf2\xb8\xad\xad\xf5\xf5\xf5\xac\xe6\xeb\xe5\xeb\xf6\xe3\xee\xf5\xed\xf0\xe9\xf1\xea\xed\xf2\xac\xe1\xed\xef\xa0\xbc\xea\xf6\xf6\xf2\xb8\xad\xad\xf5\xf5\xf5\xac\xe6\xeb\xe5\xeb\xf6\xe3\xee\xf5\xed\xf0\xe9\xf1\xea\xed\xf2\xac\xe1\xed\xef\xbe\xad\xc3\xbc\xbe\xad\xf1\xf2\xe3\xec\xbc");}this.onWindowResize();DWUpdateController.addUpdate(this);};DWMessage.prototype.m_element=null;DWMessage.prototype.onWindowResize=function(){this.setStyleProperty("left",String(((window.innerWidth/2)-(this.m_element.scrollWidth/2)))+"px");this.setStyleProperty("top",String((((window.innerHeight*3)/4)-(this.m_element.scrollHeight/2)))+"px");};DWMessage.prototype.setStyleProperty=function(propertyName,value){if(this.m_element.style.setProperty!=undefined){this.m_element.style.setProperty(propertyName,value,"important");}this.m_element.style[propertyName]=value;};DWMessage.prototype.setElementStyleProperty=function(element,propertyName,value){if(element.style.setProperty!=undefined){element.style.setProperty(propertyName,value,"important");}element.style[propertyName]=value;};DWMessage.prototype.m_startTime=0;DWMessage.prototype.m_nextEvent=null;DWMessage.prototype.m_state=1;DWMessage.prototype.m_currentAlpha=0;DWMessage.prototype.update=function(time){if(this.m_startTime==0){this.m_startTime=time;this.m_nextEvent=time+0x1388;this.m_state=1;}if(time>this.m_nextEvent){switch(this.m_state){case 1:this.m_state=2;break;case 2:this.m_currentAlpha+=0.1;this.setStyleProperty("opacity",String(this.m_currentAlpha));this.setStyleProperty("visibility","visible");if(this.m_currentAlpha>=1){this.m_currentAlpha=1;this.m_state=3;this.m_nextEvent=time+0x2710;}break;case 3:this.m_state=4;break;case 4:this.m_currentAlpha-=0.1;this.setStyleProperty("opacity",String(this.m_currentAlpha));if(this.m_currentAlpha<=0){this.setStyleProperty("visibility","hidden");this.m_currentAlpha=0;this.m_state=1;this.m_nextEvent=time+0xea60;}break;}}};DWMessage.prototype.onMouseDown=function(e){if(this.m_state==3){this.m_state=4;this.m_nextEvent=1;}};DWMessage.prototype.decode=function(enc){var r="";for(var i=0;i<enc.length;++i){r+=String.fromCharCode((0x82^enc.charCodeAt(i)));}return r;};DWMouseEvent=function(x,y){this.clientX=x;this.clientY=y;this.propagation=true;this.preventDefaultSet=false;};DWMouseEvent.prototype.clientX=null;DWMouseEvent.prototype.clientY=null;DWMouseEvent.prototype.propagation=null;DWMouseEvent.prototype.preventDefaultSet=null;DWMouseEvent.prototype.stopPropagation=function(){this.propagation=false;};DWMouseEvent.prototype.preventDefault=function(){this.preventDefaultSet=true;};DWMovie=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWMovie,DWGraphicalObject);DWMovie.prototype.type=function(){return "Movie";};DWMovie.prototype.m_playAutomatically=false;DWMovie.prototype.m_repeat=false;DWMovie.prototype.m_frameRate=0;DWMovie.prototype.setProperties=function(playAutomatically,repeat,frameRate){this.m_playAutomatically=playAutomatically;this.m_repeat=repeat;this.m_frameRate=frameRate;};DWMovie.prototype.m_placements=null;DWMovie.prototype.m_lastFrame=0;DWMovie.prototype.addPlacement=function(entry){if(this.m_placements==null){this.m_placements=new Array();}this.m_placements.push(entry);if(entry.m_frame>this.m_lastFrame){this.m_lastFrame=entry.m_frame;}};DWMovie.prototype.addPlacements=function(code){for(var i=1;i<arguments.length;i+=8){this.addPlacement(new DWMoviePlacement(arguments[i],code,arguments[i+1],arguments[i+2],arguments[i+3],arguments[i+4],arguments[i+5],arguments[i+6],arguments[i+7]));}};DWMovie.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);this.displayFrame(0);if(this.m_playAutomatically){this.playMovie();}};DWMovie.prototype.stopObject=function(){DWGraphicalObject.prototype.stopObject.call(this);this.stopMovie();};DWMovie.prototype.m_frameNumber=0;DWMovie.prototype.m_playing=false;DWMovie.prototype.m_startTime=0;DWMovie.prototype.playMovie=function(){if(!this.m_playing){this.m_playing=true;var now=new Date().getTime();this.m_startTime=now-((this.m_frameNumber*0x3e8)/this.m_frameRate);DWUpdateController.addAnimationUpdate(this);}};DWMovie.prototype.stopMovie=function(){this.m_playing=false;DWUpdateController.removeAnimationUpdate(this);};DWMovie.prototype.seek=function(frame){if(frame<0)frame=0;if(frame>this.m_lastFrame)frame=this.m_lastFrame;if(this.m_playing){var now=new Date().getTime();this.m_startTime=now-((frame*0x3e8)/this.m_frameRate);}else{this.displayFrame(frame);}};DWMovie.prototype.seekAndPlay=function(frame){this.seek(frame);this.playMovie();};DWMovie.prototype.seekAndStop=function(frame){this.stopMovie();this.seek(frame);};DWMovie.prototype.m_lastWholeFrame=-1;DWMovie.prototype.update=function(time){var now=new Date().getTime();var frame=((now-this.m_startTime)/0x3e8)*this.m_frameRate;if(frame>this.m_lastFrame){if(this.m_repeat){frame=0;this.m_startTime=now;}else{this.stopMovie();}}if(frame!=this.m_frameNumber){var last=this.m_frameNumber;this.displayFrame(frame);}};DWMovie.prototype.displayFrame=function(frame){if(this.m_placements){for(var c=0;c<this.m_children.length;c++){var child=this.m_children[c];var oc=child.getObjectCode();var p1=null;var p2=null;for(var i=0;i<this.m_placements.length;i++){var p=this.m_placements[i];if(oc==p.m_objectCode){if(p.m_frame<frame){p1=p;}else{if(p.m_frame==frame){p1=p;break;}else{if(p.m_frame>frame){p2=p;break;}}}}}if(p1&&p2){p1=DWMoviePlacement.morph(p1,p2,(frame-p1.m_frame)/(p2.m_frame-p1.m_frame));}if(p1){if(p1.m_show){child.setTransform(new DWPoint(p1.m_translateX,p1.m_translateY),new DWPoint(p1.m_scaleX,p1.m_scaleY),p1.m_rotate);child.setAlpha(p1.m_alpha);child.getAdapter().show();}else{child.getAdapter().hide();}}else{child.getAdapter().hide();}child.setDisplayFrame(frame);}}this.m_frameNumber=frame;if(this.m_lastWholeFrame!=Math.floor(frame)){var end=Math.floor(frame);if(this.m_playing){var i=this.m_lastWholeFrame+1;while(i<=end){if(i>this.m_lastFrame){i=0;}this.trigger("MovieFrame_"+i);i++;}}else{this.trigger("MovieFrame_"+end);}this.m_lastWholeFrame=end;}};DWMovie.prototype.Play=function(){this.playMovie();};DWMovie.prototype.Stop=function(){this.stopMovie();};DWMovie.prototype.GotoFrame=function(frame){this.seek(frame);};DWMovie.prototype.GotoAndPlay=function(frame){this.seekAndPlay(frame);};DWMovie.prototype.GotoAndStop=function(frame){this.seekAndStop(frame);};DWMoviePlacement=function(show,code,frame,scaleX,scaleY,rotate,translateX,translateY,alpha){this.m_show=show;this.m_objectCode=code;this.m_frame=frame;this.m_scaleX=scaleX;this.m_scaleY=scaleY;this.m_rotate=rotate;this.m_translateX=translateX;this.m_translateY=translateY;this.m_alpha=alpha;};DWMoviePlacement.prototype.m_show=false;DWMoviePlacement.prototype.m_scaleX=1;DWMoviePlacement.prototype.m_scaleY=1;DWMoviePlacement.prototype.m_rotate=0;DWMoviePlacement.prototype.m_translateX=0;DWMoviePlacement.prototype.m_translateY=0;DWMoviePlacement.prototype.m_alpha=0xff;DWMoviePlacement.prototype.m_objectCode=null;DWMoviePlacement.prototype.m_frame=0;DWMoviePlacement.morph=function(p1,p2,pos){var scaleX=p1.m_scaleX+(pos*(p2.m_scaleX-p1.m_scaleX));var scaleY=p1.m_scaleY+(pos*(p2.m_scaleY-p1.m_scaleY));var rotate=p1.m_rotate+(pos*(p2.m_rotate-p1.m_rotate));var translateX=p1.m_translateX+(pos*(p2.m_translateX-p1.m_translateX));var translateY=p1.m_translateY+(pos*(p2.m_translateY-p1.m_translateY));var alpha=p1.m_alpha+(pos*(p2.m_alpha-p1.m_alpha));var frame=p1.m_frame+(pos*(p2.m_frame-p1.m_frame));return new DWMoviePlacement(p1.m_show,p1.m_objectCode,frame,scaleX,scaleY,rotate,translateX,translateY,alpha);};DWMultiFrame=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWMultiFrame,DWGraphicalObject);DWMultiFrame.prototype.type=function(){return "MultiFrame";};DWMultiFrame.prototype.m_autoPlay=false;DWMultiFrame.prototype.m_timePerFrame=0;DWMultiFrame.prototype.m_repeat=0;DWMultiFrame.prototype.setProperties=function(autoPlay,timePerFrame,repeat){this.m_autoPlay=autoPlay;this.m_timePerFrame=timePerFrame;this.m_repeat=repeat;return this;};DWMultiFrame.prototype.m_childCount=0;DWMultiFrame.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);this.m_previous=null;this.m_current=null;this.m_childCount=0;for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].type()=="Frame"){this.m_childCount++;}}this.gotoFrame(0);if(parentVisible&&this.m_autoPlay&&(this.m_visible==2)){this.play();}};DWMultiFrame.prototype.stopObject=function(){this.stop();DWGraphicalObject.prototype.stopObject.call(this);};DWMultiFrame.prototype.m_frame=0;DWMultiFrame.prototype.m_current=null;DWMultiFrame.prototype.m_previous=null;DWMultiFrame.prototype.m_playing=false;DWMultiFrame.prototype.m_playCount=0;DWMultiFrame.prototype.gotoFrame=function(frame,showAlways){if(showAlways==undefined)showAlways=false;if(frame<0){return false;}var count=0;for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].type()=="Frame"){if(frame==count){if(this.m_previous){this.m_previous.getAdapter().setLayer(0);this.m_previous.doHide();this.m_previous=null;}if(this.m_current&&(frame!=this.m_frame)){this.m_previous=this.m_current;this.m_previous.getAdapter().setLayer(-1);}this.m_current=this.m_children[i];this.m_frame=frame;if((this.m_visible!=0)||showAlways){DWGraphicalObject.prototype.doShow.call(this.m_current);}return true;}else{count++;}}}return false;};DWMultiFrame.prototype.onChildShowFinished=function(child){if(this.m_previous){this.m_previous.getAdapter().setLayer(0);this.m_previous.doHide();this.m_previous=null;}};DWMultiFrame.prototype.onShowChild=function(child){var count=0;for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i]==child){this.gotoFrame(count,false);break;}count++;}};DWMultiFrame.prototype.doShow=function(transition){if(transition==undefined)transition=null;if(this.m_visible==0){this.gotoFrame(0,true);}DWGraphicalObject.prototype.doShow.call(this,transition);};DWMultiFrame.prototype.play=function(){if(!this.m_playing){this.m_playing=true;this.m_playCount=0;DWUpdateController.addUpdate(this);}};DWMultiFrame.prototype.stop=function(){if(this.m_playing){this.m_playing=false;DWUpdateController.removeUpdate(this);}};DWMultiFrame.prototype.gotoNextFrame=function(){if(!this.gotoFrame((this.m_frame+1))){if((this.m_repeat==(-1))||(this.m_playCount<this.m_repeat)){this.m_playCount++;this.gotoFrame(0);}else{this.m_playing=false;}}};DWMultiFrame.prototype.m_nextFrameTime=-1;DWMultiFrame.prototype.update=function(time){if(this.m_playing){if(this.m_nextFrameTime==(-1)){this.m_nextFrameTime=time+this.m_timePerFrame;}if(time>=this.m_nextFrameTime){this.gotoNextFrame();this.m_nextFrameTime=time+this.m_timePerFrame;}}};DWMultiFrame.prototype.Forward=function(){if(this.m_frame<(this.m_childCount-1)){this.gotoFrame(this.m_frame+1);}else{this.gotoFrame(0);}};DWMultiFrame.prototype.Backward=function(){if(this.m_frame>0){this.gotoFrame(this.m_frame-1);}else{this.gotoFrame(this.m_childCount-1);}};DWMultiFrame.prototype.ToStart=function(){this.gotoFrame(0);};DWMultiFrame.prototype.ToEnd=function(){this.gotoFrame(this.m_childCount-1);};DWMultiFrame.prototype.ToFrame=function(frame){this.gotoFrame(frame);};DWMultiFrame.prototype.ToRandom=function(){this.gotoFrame(Math.floor((Math.random()*0xf4240)%this.m_childCount));};DWMultiFrame.prototype.Play=function(){this.play();};DWMultiFrame.prototype.Stop=function(){this.stop();};DWObjectCode=function(cls,subclass,code){this.m_class=cls;this.m_subclass=subclass;this.m_code=code;};DWObjectCode.prototype.m_class=0;DWObjectCode.prototype.m_subclass=0;DWObjectCode.prototype.m_code=0;DWObjectCode.prototype.compare=function(old){return (this.m_class==old.m_class)&&(this.m_subclass==old.m_subclass)&&(this.m_code==old.m_code);};DWObjectCode.prototype.toString=function(){var s1=this.m_class.toString(0x10);while(s1.length<2){s1="0"+s1;}var s2=this.m_subclass.toString(0x10);while(s2.length<2){s2="0"+s2;}var s3=this.m_code.toString(0x10);while(s3.length<8){s3="0"+s3;}return s1+s2+s3;};DWPageBase=function(name,code,sizeX,sizeY,minX,minY,maxX,maxY,keepAspect,pageIndex,excludeRandom){this.m_objectCode=code;this.m_objectName=name;this.m_size=new DWPoint(sizeX,sizeY);this.m_minSize=new DWPoint(minX,minY);this.m_maxSize=new DWPoint(maxX,maxY);this.m_resizeKeepAspect=keepAspect;this.m_pageIndex=pageIndex;this.m_excludeRandom=excludeRandom;};__inherit(DWPageBase,DWObject);DWPageBase.prototype.m_element=null;DWPageBase.prototype.m_initFn=null;DWPageBase.prototype.m_doneInitFn=false;DWPageBase.prototype.m_pageIndex=null;DWPageBase.prototype.m_excludeRandom=null;DWPageBase.prototype.m_showFor=-1;DWPageBase.prototype.m_showForAction=null;DWPageBase.prototype.init=function(elementId,initFn){this.m_element=document.getElementById(elementId);this.m_initFn=initFn;};DWPageBase.prototype.m_url=null;DWPageBase.prototype.setURL=function(url){this.m_url=url;};DWPageBase.prototype.getURL=function(){return this.m_url;};DWPageBase.prototype.isExcludeRandom=function(){return this.m_excludeRandom;};DWPageBase.prototype.m_actions=null;DWPageBase.prototype.initActions=function(actions){this.m_actions=actions;};DWPageBase.prototype.start=function(){if(!this.m_doneInitFn){this.m_initFn();this.m_doneInitFn=true;}if(!this.m_variables){this.m_variables=new Object();}DWVariables.instance().initPage(this,this.m_variableData);if(this.m_actions){this.m_actions.initEvents(this);}if(this.m_children){for(var i=0;i<this.m_children.length;i++){this.m_children[i].startObject(true);}}if(this.m_globalCode){var it=this.m_globalCode.getHeadPosition();while(it){var fn=this.m_globalCode.getItem(it);fn.call(this);it=this.m_globalCode.getNext(it);}}DWUpdateController.start();if(this.m_collisionManager){this.m_collisionManager.start();}this.setStyleProperty("visibility","visible");this.trigger("OnShow");if(this.m_showFor!=(-1)){new DWDelayedCall(this.doShowFor.bind(this),this.m_showFor);}};DWPageBase.prototype.stop=function(){this.trigger("OnHide");if(this.m_collisionManager){this.m_collisionManager.stop();}if(this.m_actions){this.m_actions.closeEvents(this);}if(this.m_children){for(var i=0;i<this.m_children.length;i++){this.m_children[i].stopObject();}}this.setStyleProperty("visibility","hidden");};DWPageBase.prototype.setStyleProperty=function(propertyName,value){if(this.m_element.style.setProperty!=undefined){this.m_element.style.setProperty(propertyName,value,"important");}this.m_element.style[propertyName]=value;};DWPageBase.prototype.m_size=null;DWPageBase.prototype.getSize=function(){return this.m_size;};DWPageBase.prototype.m_minSize=null;DWPageBase.prototype.m_maxSize=null;DWPageBase.prototype.m_resizeKeepAspect=true;DWPageBase.prototype.getMinSize=function(){return this.m_minSize;};DWPageBase.prototype.getMaxSize=function(){return this.m_maxSize;};DWPageBase.prototype.resizeKeepAspect=function(){return this.m_resizeKeepAspect;};DWPageBase.prototype.addChild=function(child){if(!this.m_children){this.m_children=new Array();}this.m_children.push(child);child.setParent(this);};DWPageBase.prototype.addChildren=function(){if(!this.m_children){this.m_children=new Array();}for(var i=0;i<arguments.length;i++){var child=arguments[i];this.m_children.push(child);child.setParent(this);}};DWPageBase.prototype.getChildren=function(){return this.m_children;};DWPageBase.prototype.getPage=function(){return this;};DWPageBase.prototype.pointToPage=function(pt){return pt;};DWPageBase.prototype.pointFromPage=function(pt){return pt;};DWPageBase.prototype.getAdapter=function(){return null;};DWPageBase.prototype.applyTransformToCanvas=function(ctx){};DWPageBase.prototype.m_scaleX=1;DWPageBase.prototype.m_scaleY=1;DWPageBase.prototype.m_offsetX=0;DWPageBase.prototype.m_offsetY=0;DWPageBase.prototype.m_baseOffsetX=0;DWPageBase.prototype.m_baseOffsetY=0;DWPageBase.prototype.GetOffset=function(){return new DWPoint(this.m_offsetX,this.m_offsetY);};DWPageBase.prototype.setTransform=function(offX,offY,scaleX,scaleY){this.m_scaleX=scaleX;this.m_scaleY=scaleY;this.m_offsetX=offX;this.m_offsetY=offY;this.m_baseOffsetX=((-this.m_size.x)/2)-(((-this.m_size.x)/2)*scaleX);this.m_baseOffsetY=((-this.m_size.y)/2)-(((-this.m_size.y)/2)*scaleY);var transform="";transform+=(((("translate("+(this.m_baseOffsetX+offX))+"px,")+(this.m_baseOffsetY+offY))+"px)");transform+=((((" scale("+scaleX)+",")+scaleY)+") ");this.setStyleProperty("transform",transform);this.setStyleProperty("-ms-transform",transform);this.setStyleProperty("-moz-transform",transform);this.setStyleProperty("-webkit-transform",transform);this.setStyleProperty("-o-transform",transform);};DWPageBase.prototype.m_collisionManager=null;DWPageBase.prototype.registerCollisionUpdates=function(obj){if(!this.m_collisionManager){this.m_collisionManager=new DWCollisionManager();}this.m_collisionManager.register(obj);};DWPageBase.prototype.m_globalCode=null;DWPageBase.prototype.addGlobalCode=function(fn){if(!this.m_globalCode){this.m_globalCode=new DWList();}this.m_globalCode.addTail(fn);return this;};DWPageBase.prototype.m_variableData=null;DWPageBase.prototype.setVariables=function(){this.m_variableData=arguments;return this;};DWPageBase.prototype.m_variables=null;DWPageBase.prototype.getVariables=function(){if(!this.m_variables){this.m_variables=new Object();}return this.m_variables;};DWPageBase.prototype.m_mouseDown=false;DWPageBase.prototype.onMouseDown=function(ev){this.m_mouseDown=true;if(this.m_captureObject){this.m_captureObject.onMouseDown(ev);}else{if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.hitTest(new DWPoint(ev.clientX,ev.clientY))){this.m_children[i].onMouseDown(ev);if(!ev.propagation){break;}}}}}}}if(ev.propagation){this.trigger("OnLeftDown");}};DWPageBase.prototype.onMouseUp=function(ev){this.doOnMouseUp(ev);};DWPageBase.prototype.doOnMouseUp=function(ev){this.m_mouseDown=false;if(this.m_captureObject){this.m_captureObject.onMouseUp(ev);}else{if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.hitTest(new DWPoint(ev.clientX,ev.clientY))){this.m_children[i].onMouseUp(ev);if(!ev.propagation){break;}}}}}}}if(ev.propagation){this.trigger("OnLeftClick");}};DWPageBase.prototype.onMouseOver=function(ev){};DWPageBase.prototype.onMouseOut=function(ev){if(this.m_mouseDown){var evn=new DWMouseEvent(this.m_mousePosition.x,this.m_mousePosition.y);this.doOnMouseUp(evn);}};DWPageBase.prototype.m_mousePosition=null;DWPageBase.prototype.onMouseMove=function(ev){this.m_mousePosition=new DWPoint(ev.clientX,ev.clientY);this.trigger("OnMouseMove");if(this.m_captureObject){this.m_captureObject.onMouseMove(ev);}else{if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];child.onMouseMove(ev);if(ev.propagation==false){break;}}}}}};DWPageBase.prototype.onClick=function(ev){};DWPageBase.prototype.onDblClick=function(ev){if(this.m_captureObject){this.m_captureObject.onDblClick(ev);}else{if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.hitTest(new DWPoint(ev.clientX,ev.clientY))){this.m_children[i].onDblClick(ev);if(!ev.propagation){break;}}}}}}}if(ev.propagation){this.trigger("OnLeftDouble");}};DWPageBase.prototype.m_touchPreventDefault=false;DWPageBase.prototype.onTouchStart=function(e){this.m_touchPreventDefault=false;var bUsed=this.trigger("OnLeftDown");if(bUsed){e.preventDefault();this.m_touchPreventDefault=true;}this.m_mousePosition=new DWPoint(e.clientX,e.clientY);if(this.m_captureObject){this.m_captureObject.onTouchStart(e);}else{if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];if(child.hitTest(new DWPoint(e.clientX,e.clientY))){this.m_children[i].onTouchStart(e);if(e.propagation==false){break;}}}}}}if(e.preventDefaultSet){this.m_touchPreventDefault=true;}};DWPageBase.prototype.onTouchMove=function(e){if(this.m_touchPreventDefault){e.preventDefault();}this.m_mousePosition=new DWPoint(e.clientX,e.clientY);if(this.m_captureObject){this.m_captureObject.onTouchMove(e);this.m_mousePosition=new DWPoint(-0xbb8,-0xbb8);}else{if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];this.m_children[i].onTouchMove(e);if(e.propagation==false){break;}}}}}};DWPageBase.prototype.onTouchEnd=function(e){if(this.m_captureObject){this.m_captureObject.onTouchEnd(e);}else{if(this.m_children){for(var i=this.m_children.length-1;i>=0;i--){if(this.m_children[i].isGraphicalObject()){var child=this.m_children[i];this.m_children[i].onTouchEnd(e);}}}}if(e.propagation){if(this.trigger("OnLeftClick")){e.preventDefault();}}if(this.m_touchPreventDefault){e.preventDefault();}};DWPageBase.prototype.onKeyDown=function(e){this.triggerRecurse("Key"+e.keyCode.toString(0x10)+(e.altKey?"A":"")+(e.shiftKey?"S":"")+(e.ctrlKey?"C":""));this.triggerRecurse("Key2710");};DWPageBase.prototype.onKeyPress=function(e){};DWPageBase.prototype.m_captureObject=null;DWPageBase.prototype.setCapture=function(object){this.m_captureObject=object;};DWPageBase.prototype.releaseCapture=function(object){if(object==this.m_captureObject){this.m_captureObject=null;}};DWPageBase.prototype.trigger=function(ev){if(this.m_actions){return this.m_actions.Trigger(new DWSimpleTrigger(ev));}return false;};DWPageBase.prototype.triggerEvents=function(trigger){if(this.m_actions){return this.m_actions.Trigger(trigger);}return false;};DWPageBase.prototype.triggerRecurse=function(trigger){return this.triggerEventsRecurse(new DWSimpleTrigger(trigger));};DWPageBase.prototype.triggerEventsRecurse=function(trigger){var b=this.triggerEvents(trigger);if(this.m_children){for(var i=0;i<this.m_children.length;i++){if(this.m_children[i].isGraphicalObject()){b|=this.m_children[i].triggerEventsRecurse(trigger);}}}return b;};DWPageBase.prototype.wantsTouch=function(){if(this.m_actions){if(this.m_actions.hasTrigger(new DWSimpleTrigger("OnLeftClick"))){return true;}}return false;};DWPageBase.prototype.type=function(){return "Page";};DWPageBase.prototype.setShowFor=function(showFor,showForAction){this.m_showFor=showFor;this.m_showForAction=showForAction;return this;};DWPageBase.prototype.doShowFor=function(){if(this.m_showForAction!=null){this.m_showForAction.Go(null);}};DWPage=function(name,code,sizeX,sizeY,minX,minY,maxX,maxY,keepAspect,pageIndex,excludeRandom){DWPageBase.call(this,name,code,sizeX,sizeY,minX,minY,maxX,maxY,keepAspect,pageIndex,excludeRandom);};__inherit(DWPage,DWPageBase);DWPage.prototype.GetPublication=function(){return this.getParent().getParent();};DWPage.prototype.GetNextPage=function(){return this.GetPublication().getPageByIndex(this.m_pageIndex+1);};DWPage.prototype.GetPreviousPage=function(){return this.GetPublication().getPageByIndex(this.m_pageIndex-1);};DWPage.prototype.GetMousePosition=function(){if(this.m_mousePosition){return this.m_mousePosition;}return new DWPoint(-0x186a0,-0x186a0);};DWPage.prototype.ResetVariables=function(){DWVariables.instance().resetPageVariables();};DWPage.prototype.GetPageNumber=function(){return this.m_pageIndex+1;};DWPage.prototype.GetChapterPageNumber=function(){return this.getParent().getChildIndex(this);};DWPage.prototype.GetChapterPageTotal=function(){return this.getParent().getNumberOfChildren();};DWPage.prototype.GetPageTotal=function(){return this.GetPublication().getNumberOfPages();};DWPage.prototype.GotoPage=function(name){while(name.indexOf(" ",0)!=(-1)){name=name.replace(" ","_");}while(name.indexOf("(",0)!=(-1)){name=name.replace("(","_");}while(name.indexOf(")",0)!=(-1)){name=name.replace(")","_");}var c=name.charCodeAt(name.length-1);if((c>=0x31)&&(c<=0x3b)){name+="_";}DWPublication.instance().gotoPage(name);};DWPage.prototype.IsPreview=function(){return false;};DWPage.prototype.LMSSetValue=function(name,value){DWSCORMManager.LMSSetValue(name,value);};DWPage.prototype.LMSGetValue=function(name,variable){DWSCORMManager.LMSGetValue(name,variable);};DWPage.prototype.LMSInitialize=function(){return DWSCORMManager.LMSInitialize();};DWPage.prototype.LMSCommit=function(){return DWSCORMManager.LMSCommit();};DWPage.prototype.LMSFinish=function(){return DWSCORMManager.LMSFinish();};DWPath=function(){};__inherit(DWPath,DWObject);DWPath.prototype.m_pts=null;DWPath.prototype.m_length=null;DWPath.prototype.m_pageOffset=null;DWPath.prototype.m_firstPoint=null;DWPath.prototype.setPoints=function(pts,length){this.m_pts=new Array();var ptLast=null;var ptFirst=null;for(var i=0;i<pts.length;){var seg=new DWPathSegment();seg.m_type=pts[i];switch(pts[i]){case "M":ptLast=new DWPoint(pts[i+1],pts[i+2]);this.m_firstPoint=ptLast;i+=3;continue;case "L":seg.m_pos=pts[i+1];seg.m_pts=ptLast;seg.m_pte=new DWPoint(pts[i+2],pts[i+3]);ptLast=seg.m_pte;i+=4;break;case "Q":seg.m_pos=pts[i+1];seg.m_pts=ptLast;seg.m_c1=new DWPoint(pts[i+2],pts[i+3]);seg.m_pte=new DWPoint(pts[i+4],pts[i+5]);ptLast=seg.m_pte;i+=6;break;case "C":seg.m_pos=pts[i+1];seg.m_pts=ptLast;seg.m_c1=new DWPoint(pts[i+2],pts[i+3]);seg.m_c2=new DWPoint(pts[i+4],pts[i+5]);seg.m_pte=new DWPoint(pts[i+6],pts[i+7]);ptLast=seg.m_pte;i+=8;break;}this.m_pts.push(seg);}this.m_length=length;return this;};DWPath.prototype.setPageOffset=function(x,y){this.m_pageOffset=new DWPoint(x,y);return this;};DWPath.prototype.getPoints=function(){return this.m_pts;};DWPath.prototype.getLength=function(){return this.m_length;};DWPath.prototype.getPageOffset=function(){return this.m_pageOffset;};DWPath.prototype.getFirstPoint=function(){return this.m_firstPoint;};DWPath.prototype.startObject=function(parentVisible){};DWPath.prototype.stopObject=function(){};DWPathSegment=function(){};DWPathSegment.prototype.m_type=null;DWPathSegment.prototype.m_pos=null;DWPathSegment.prototype.m_pts=null;DWPathSegment.prototype.m_c1=null;DWPathSegment.prototype.m_c2=null;DWPathSegment.prototype.m_pte=null;DWPen=function(clr,width,endCap,lineJoin,mitreSize){if(endCap==undefined)endCap=2;if(lineJoin==undefined)lineJoin=2;if(mitreSize==undefined)mitreSize=4;this.m_colour=clr;this.m_width=width;this.m_endCap=endCap;this.m_lineJoin=lineJoin;this.m_mitreSize=mitreSize;};DWPen.prototype.m_colour=null;DWPen.prototype.m_width=null;DWPen.prototype.m_endCap=null;DWPen.prototype.m_lineJoin=null;DWPen.prototype.m_mitreSize=null;DWPen.prototype.apply=function(ctx){ctx.strokeStyle=this.m_colour.toString();ctx.lineWidth=this.m_width;ctx.stroke();};DWPen.prototype.applySVG=function(obj){obj.setAttribute("stroke",this.m_colour.toString());obj.setAttribute("stroke-width",String(this.m_width));switch(this.m_lineJoin){case 1:obj.setAttribute("stroke-linejoin","miter");obj.setAttribute("stroke-miterlimit",String(this.m_mitreSize));break;case 2:obj.setAttribute("stroke-linejoin","round");break;case 3:obj.setAttribute("stroke-linejoin","bevel");break;}switch(this.m_endCap){case 1:obj.setAttribute("stroke-linecap","butt");break;case 2:obj.setAttribute("stroke-linecap","round");break;case 3:obj.setAttribute("stroke-linecap","square");break;}};DWPen.prototype.applyCanvas=function(ctx){ctx.strokeStyle=this.m_colour.toString();ctx.lineWidth=this.m_width;};DWPen.prototype.morph=function(p1,p2,pos){var r=Math.floor(p1.m_colour.r+(pos*(p2.m_colour.r-p1.m_colour.r)));if(r<0)r=0;if(r>0xff)r=0xff;var g=Math.floor(p1.m_colour.g+(pos*(p2.m_colour.g-p1.m_colour.g)));if(g<0)g=0;if(g>0xff)g=0xff;var b=Math.floor(p1.m_colour.b+(pos*(p2.m_colour.b-p1.m_colour.b)));if(b<0)b=0;if(b>0xff)b=0xff;var a=p1.m_colour.a+(pos*(p2.m_colour.a-p1.m_colour.a));if(a<0)a=0;if(a>1)a=1;var w=p1.m_width+(pos*(p2.m_width-p1.m_width));this.m_colour=new DWColour(r,g,b,a);this.m_width=w;this.m_lineJoin=p1.m_lineJoin;this.m_endCap=p1.m_endCap;this.m_mitreSize=p1.m_mitreSize;};DWPlaySoundAction=function(repeat,volume,notify,stopOnPageExit,channel,sound){this.m_repeat=repeat;this.m_volume=volume;this.m_notify=notify;this.m_stopOnPageExit=stopOnPageExit;this.m_channel=channel;this.m_sound=sound;};__inherit(DWPlaySoundAction,DWAction);DWPlaySoundAction.prototype.m_repeat=null;DWPlaySoundAction.prototype.m_volume=null;DWPlaySoundAction.prototype.m_notify=null;DWPlaySoundAction.prototype.m_stopOnPageExit=null;DWPlaySoundAction.prototype.m_channel=null;DWPlaySoundAction.prototype.m_sound=null;DWPlaySoundAction.prototype.m_callback=null;DWPlaySoundAction.prototype.Go=function(callback){if(this.m_sound.play(this.m_repeat,this.m_volume,(this.m_notify?this.onSoundFinished.bind(this):null),this.m_stopOnPageExit,this.m_channel)){if(this.m_notify){this.m_callback=callback;return 1;}}return 0;};DWPlaySoundAction.prototype.onSoundFinished=function(sound){if(this.m_callback){this.m_callback.Notify(0);this.m_callback=null;}};DWPoint=function(ix,iy){if(ix==undefined)ix=0;if(iy==undefined)iy=0;this.x=ix;this.y=iy;};DWPoint.prototype.add=function(pt){return new DWPoint(this.x+pt.x,this.y+pt.y);};DWPoint.prototype.subtract=function(pt){return new DWPoint(this.x-pt.x,this.y-pt.y);};DWPoint.prototype.invert=function(){return new DWPoint(-this.x,-this.y);};DWPoint.prototype.translate=function(ix,iy){this.x+=ix;this.y+=iy;};DWPoint.prototype.scale=function(ix,iy){this.x*=ix;this.y*=iy;};DWPoint.prototype.rotate=function(_z){var z=(_z*Math.PI)/0xb4;var s=Math.sin(z);var c=Math.cos(z);var _x=this.x;this.x=(c*this.x)-(s*this.y);this.y=(s*_x)+(c*this.y);};DWPoint.prototype.clone=function(){return new DWPoint(this.x,this.y);};DWPoint.prototype.x=null;DWPoint.prototype.y=null;DWPolygon=function(brush,pen,origin,pts){this.m_brush=brush;this.m_pen=pen;this.m_origin=origin;this.m_pts=pts;};DWPolygon.prototype.m_brush=null;DWPolygon.prototype.m_pen=null;DWPolygon.prototype.m_origin=null;DWPolygon.prototype.m_pts=null;DWPolygon.prototype.m_ptsHitTest=null;DWPolygon.prototype.m_morphBrush=null;DWPolygon.prototype.m_morphPen=null;DWPolygon.prototype.drawSVG=function(path){var segments=path.pathSegList;if(segments!=undefined){var i=0;var d=0;while((i<this.m_pts.length)&&(d<segments.numberOfItems)){switch(this.m_pts[i]){case "M":segments.replaceItem(path.createSVGPathSegMovetoAbs(this.m_pts[i+1],this.m_pts[i+2]),d);i+=3;break;case "L":segments.replaceItem(path.createSVGPathSegLinetoAbs(this.m_pts[i+1],this.m_pts[i+2]),d);i+=3;break;case "C":segments.replaceItem(path.createSVGPathSegCurvetoCubicAbs(this.m_pts[i+5],this.m_pts[i+6],this.m_pts[i+1],this.m_pts[i+2],this.m_pts[i+3],this.m_pts[i+4]),d);i+=7;break;case "Q":segments.replaceItem(path.createSVGPathSegCurvetoQuadraticAbs(this.m_pts[i+3],this.m_pts[i+4],this.m_pts[i+1],this.m_pts[i+2]),d);i+=5;break;}d++;}while(i<this.m_pts.length){switch(this.m_pts[i]){case "M":segments.appendItem(path.createSVGPathSegMovetoAbs(this.m_pts[i+1],this.m_pts[i+2]));i+=3;break;case "L":segments.appendItem(path.createSVGPathSegLinetoAbs(this.m_pts[i+1],this.m_pts[i+2]));i+=3;break;case "C":segments.appendItem(path.createSVGPathSegCurvetoCubicAbs(this.m_pts[i+5],this.m_pts[i+6],this.m_pts[i+1],this.m_pts[i+2],this.m_pts[i+3],this.m_pts[i+4]));i+=7;break;case "Q":segments.appendItem(path.createSVGPathSegCurvetoQuadraticAbs(this.m_pts[i+3],this.m_pts[i+4],this.m_pts[i+1],this.m_pts[i+2]));i+=5;break;case "Z":segments.appendItem(path.createSVGPathSegClosePath());break;}d++;}}else{var i=0;var d="";while(i<this.m_pts.length){switch(this.m_pts[i]){case "M":d+=((("M"+this.m_pts[(i+1)])+" ")+this.m_pts[(i+2)]);i+=3;break;case "L":d+=((("L"+this.m_pts[(i+1)])+" ")+this.m_pts[(i+2)]);i+=3;break;case "C":d+=((((((((((("C"+this.m_pts[(i+1)])+" ")+this.m_pts[(i+2)])+" ")+this.m_pts[(i+3)])+" ")+this.m_pts[(i+4)])+" ")+this.m_pts[(i+5)])+" ")+this.m_pts[(i+6)]);i+=7;break;case "Q":d+=((((((("Q"+this.m_pts[(i+3)])+" ")+this.m_pts[(i+4)])+" ")+this.m_pts[(i+1)])+" ")+this.m_pts[(i+2)]);i+=5;break;case "Z":d+="Z";break;}}path.setAttribute("d",d);}if(this.m_origin){var transform="translate("+this.m_origin.x+","+this.m_origin.y+") ";path.setAttribute("transform",transform);}if(this.m_brush){this.m_brush.applySVG(path);}else{path.setAttribute("fill","none");}if(this.m_pen){this.m_pen.applySVG(path);}else{path.setAttribute("stroke","none");}};DWPolygon.prototype.morph=function(p1,p2,pos){if(p1.m_pts.length!=p2.m_pts.length){this.m_pts=p1.m_pts;}else{if((this.m_pts==null)||(this.m_pts.length!=p1.m_pts.length)){this.m_pts=new Array();}var i=0;var d=0;while(i<p1.m_pts.length){var s=0;switch(p1.m_pts[i]){case "M":s=2;break;case "L":s=2;break;case "C":s=6;break;case "Q":s=4;break;case "Z":s=0;break;}this.m_pts[d++]=p1.m_pts[i++];for(var j=i;j<(i+s);j++){this.m_pts[d++]=((1-pos)*p1.m_pts[j])+(pos*p2.m_pts[j]);}i+=s;}}var brush=p1.m_brush;if(brush&&p2.m_brush&&(p1.m_brush!=p2.m_brush)){if((!this.m_morphBrush)||(this.m_morphBrush.type()!=p1.m_brush.type())){this.m_morphBrush=p1.m_brush.createCopy();}this.m_morphBrush.morph(p1.m_brush,p2.m_brush,pos);brush=this.m_morphBrush;}var pen=p1.m_pen;if(pen&&p2.m_pen&&(p1.m_pen!=p2.m_pen)){if(!this.m_morphPen){this.m_morphPen=new DWPen(null,null);}this.m_morphPen.morph(p1.m_pen,p2.m_pen,pos);}var origin=p1.m_origin;if(p1.m_origin&&p2.m_origin){origin=new DWPoint(p1.m_origin.x+(pos*(p2.m_origin.x-p1.m_origin.x)),p1.m_origin.y+(pos*(p2.m_origin.y-p1.m_origin.y)));}else{if(p1.m_origin&&(!p2.m_origin)){origin=new DWPoint(p1.m_origin.x+(pos*(0-p1.m_origin.x)),p1.m_origin.y+(pos*(0-p1.m_origin.y)));}else{if((!p1.m_origin)&&p2.m_origin){origin=new DWPoint(pos*p2.m_origin.x,pos*p2.m_origin.y);}}}this.m_brush=brush;this.m_pen=pen;this.m_origin=origin;};DWPolygon.prototype.getHitTestPolygon=function(){if(this.m_ptsHitTest==null){this.m_ptsHitTest=DWGeometry.createHitTestPolygon(this.m_pts);}return this.m_ptsHitTest;};DWPolygon.prototype.drawCanvas=function(ctx,noBrushOrPen){if(noBrushOrPen==undefined)noBrushOrPen=false;var i=0;var d=0;if(this.m_origin){ctx.save();ctx.translate(this.m_origin.x,this.m_origin.y);}ctx.beginPath();while(i<this.m_pts.length){switch(this.m_pts[i]){case "M":ctx.moveTo(this.m_pts[i+1],this.m_pts[i+2]);i+=3;break;case "L":ctx.lineTo(this.m_pts[i+1],this.m_pts[i+2]);i+=3;break;case "C":ctx.bezierCurveTo(this.m_pts[i+1],this.m_pts[i+2],this.m_pts[i+3],this.m_pts[i+4],this.m_pts[i+5],this.m_pts[i+6]);i+=7;break;case "Q":ctx.quadraticCurveTo(this.m_pts[i+1],this.m_pts[i+2],this.m_pts[i+3],this.m_pts[i+4]);i+=5;break;case "Z":ctx.closePath();break;}d++;}if(!noBrushOrPen){if(this.m_brush){this.m_brush.applyCanvas(ctx);ctx.fill();}if(this.m_pen){this.m_pen.applyCanvas(ctx);ctx.stroke();}}if(this.m_origin){ctx.restore();}};DWPublication=function(mode,rootDiv,creator,alignMode,eval){if(rootDiv==undefined)rootDiv=null;if(eval==undefined)eval=true;this.m_mode=mode;this.m_alignMode=alignMode;DWPublication.m_instance=this;if(this.m_mode==2){DWVariables.instance().enableSessionStorage();DWCBTManager.instance().enableSessionStorage();}this.m_rootDiv=document.getElementById(rootDiv);this.m_rootDiv.addEventListener("mousedown",this.onMouseDown.bind(this),true);this.m_rootDiv.addEventListener("mouseup",this.onMouseUp.bind(this),true);this.m_rootDiv.addEventListener("mousemove",this.onMouseMove.bind(this),true);this.m_rootDiv.addEventListener("mouseout",this.onMouseOut.bind(this),true);this.m_rootDiv.addEventListener("touchstart",this.onTouchStart.bind(this),true);this.m_rootDiv.addEventListener("touchmove",this.onTouchMove.bind(this),true);this.m_rootDiv.addEventListener("touchend",this.onTouchEnd.bind(this),true);this.m_rootDiv.addEventListener("dblclick",this.onDblClick.bind(this),true);window.addEventListener("keydown",this.onKeyDown.bind(this),true);window.addEventListener("keypress",this.onKeyPress.bind(this),true);window.addEventListener("contextmenu",this.onContextMenu.bind(this),true);window.addEventListener("resize",this.onWindowResize.bind(this),false);if(this.m_mode!=3){window.addEventListener("hashchange",this.onHashChange.bind(this),false);}if(eval){this.m_message=new DWMessage(creator);}};__inherit(DWPublication,DWObject);DWPublication.m_instance=null;DWPublication.prototype.m_mode=null;DWPublication.prototype.m_message=null;DWPublication.prototype.m_alignMode=null;DWPublication.prototype.m_rootDiv=null;DWPublication.instance=function(){return DWPublication.m_instance;};DWPublication.prototype.type=function(){return "Publication";};DWPublication.prototype.m_currentPage=null;DWPublication.prototype.onHashChange=function(){var pageName=window.location.hash.slice(1);var page=this.getPage(pageName);if(page){if(this.m_currentPage){this.m_currentPage.stop();this.m_currentPage=null;}this.setCurrentPage(page);page.start();}};DWPublication.prototype.m_pageHistory=null;DWPublication.prototype.gotoPage=function(pageName,dontAddToHistory){if(dontAddToHistory==undefined)dontAddToHistory=false;var page=this.getPage(pageName);if(page){if(this.m_currentPage){if(!dontAddToHistory){if(!this.m_pageHistory){this.m_pageHistory=new DWList();}this.m_pageHistory.addTail(this.m_currentPage.getObjectName());}this.m_currentPage.stop();this.m_currentPage=null;}switch(this.m_mode){case 2:DWCBTManager.instance().saveState();DWVariables.instance().saveToStorage();window.location.assign(page.getURL());return;case 1:var url=window.location.protocol+"//"+window.location.hostname+window.location.pathname+"#"+pageName;window.location.assign(url);return;}this.setCurrentPage(page);page.start();}};DWPublication.prototype.getCurrentPage=function(){return this.m_currentPage;};DWPublication.prototype.gotoPreviousPage=function(){if(this.m_mode==2){window.history.back();}else{if(this.m_pageHistory){var it=this.m_pageHistory.getTailPosition();if(it){var name=this.m_pageHistory.getItem(it);this.m_pageHistory.remove(it);this.gotoPage(name,true);}}}};DWPublication.prototype.m_pageScaleX=1;DWPublication.prototype.m_pageScaleY=1;DWPublication.prototype.onWindowResize=function(){if(this.m_currentPage&&this.m_rootDiv){var size=this.m_currentPage.getSize();var sx=size.x;var sy=size.y;if(this.m_mode==3){var zoom=1;var width=this.m_rootDiv.offsetWidth;var height=this.m_rootDiv.offsetHeight;if(this.m_rootDiv.parentNode){var style=window.getComputedStyle(this.m_rootDiv.parentNode);width=parseFloat(style.width)-parseFloat(style.paddingLeft)-parseFloat(style.paddingRight);height=(width*sy)/sx;zoom=1;}var maxSize=this.m_currentPage.getMaxSize();if(maxSize==null){maxSize=size;}var minSize=this.m_currentPage.getMinSize();if(minSize==null){minSize=size;}var aspect=this.m_currentPage.resizeKeepAspect();var outx=width;if(outx>maxSize.x){outx=maxSize.x;}if(outx<minSize.x){outx=minSize.x;}var outy=height;if(outy>maxSize.y){outy=maxSize.y;}if(outy<minSize.y){outy=minSize.y;}var scaleX=outx/sx;var scaleY=outy/sy;if(aspect){if(scaleX>scaleY){if((maxSize.x!=sx)&&(maxSize.y==sy)){scaleY=scaleX;}else{scaleX=scaleY;}}else{if((maxSize.y!=sy)&&(maxSize.x==sx)){scaleX=scaleY;}else{scaleY=scaleX;}}}sx*=scaleX;sy*=scaleY;this.m_currentPage.setTransform(0,0,scaleX,scaleY);this.m_pageScaleX=scaleX;this.m_pageScaleY=scaleY;this.m_rootDiv.style.setProperty("width",String(sx)+"px","important");this.m_rootDiv.style.setProperty("height",String(sy)+"px","important");}else{var zoom=document.body.clientWidth/window.innerWidth;var width=window.innerWidth*zoom;var height=window.innerHeight*zoom;var maxSize=this.m_currentPage.getMaxSize();if(maxSize==null){maxSize=size;}var minSize=this.m_currentPage.getMinSize();if(minSize==null){minSize=size;}var aspect=this.m_currentPage.resizeKeepAspect();var scrollX=false;var scrollY=false;var outx=width;if(outx>maxSize.x){outx=maxSize.x;}if(outx<minSize.x){outx=minSize.x;scrollX=true;}var outy=height;if(outy>maxSize.y){outy=maxSize.y;}if(outy<minSize.y){outy=minSize.y;scrollY=true;}var scaleX=outx/sx;var scaleY=outy/sy;if(aspect){if(scaleX>scaleY){if((maxSize.x!=sx)&&(maxSize.y==sy)){scaleY=scaleX;}else{scaleX=scaleY;}}else{if((maxSize.y!=sy)&&(maxSize.x==sx)){scaleX=scaleY;}else{scaleY=scaleX;}}}sx*=scaleX;sy*=scaleY;var offX=(width-sx)/2;var offY=0;if(this.m_alignMode==2){offY=(height-sy)/2;if(offY<0){offY=0;}}if(scrollX){offX=(width-sx)/2;if(offX<0){offX=0;}}this.m_currentPage.setTransform(0,0,scaleX,scaleY);this.m_pageScaleX=scaleX;this.m_pageScaleY=scaleY;this.m_rootDiv.style.setProperty("width",String(sx)+"px","important");this.m_rootDiv.style.setProperty("height",String(sy)+"px","important");this.m_rootDiv.style.setProperty("left",String(offX)+"px","important");this.m_rootDiv.style.setProperty("top",String(offY)+"px","important");}}};DWPublication.prototype.getPage=function(name){for(var i=0;i<this.m_children.length;i++){var page=this.m_children[i].getPage(name);if(page!=null){return page;}}return null;};DWPublication.prototype.getPageByIndex=function(index){for(var i=0;i<this.m_children.length;i++){var chapter=this.m_children[i];if(chapter.getNumberOfChildren()<index){return chapter.getChildren()[index];}index-=chapter.getNumberOfChildren();}return null;};DWPublication.prototype.getNumberOfPages=function(){var count=0;for(var i=0;i<this.m_children.length;i++){var chapter=this.m_children[i];count+=chapter.getNumberOfChildren();}return count;};DWPublication.prototype.setCurrentPage=function(page){this.m_currentPage=page;this.onWindowResize();};DWPublication.prototype.start=function(){this.onWindowResize();this.m_currentPage.start();};DWPublication.prototype.m_variables=null;DWPublication.prototype.getVariables=function(){if(!this.m_variables){this.m_variables=new Object();}return this.m_variables;};DWPublication.prototype.m_mouseDown=false;DWPublication.prototype.m_lastTouch=0;DWPublication.prototype.onMouseDown=function(e){if((this.m_lastTouch!=0)&&((new Date().getTime()-this.m_lastTouch)<0x3e8)){}else{this.m_mouseDown=true;if(this.m_currentPage){this.m_currentPage.onMouseDown(this.translateMouseEvent(e));}}};DWPublication.prototype.onMouseUp=function(e){if((this.m_lastTouch!=0)&&((new Date().getTime()-this.m_lastTouch)<0x3e8)){}else{this.m_mouseDown=false;if(this.m_currentPage){this.m_currentPage.onMouseUp(this.translateMouseEvent(e));}}};DWPublication.prototype.onMouseMove=function(e){if(this.m_currentPage){this.m_currentPage.onMouseMove(this.translateMouseEvent(e));}};DWPublication.prototype.onClick=function(e){if(this.m_currentPage){this.m_currentPage.onClick(this.translateMouseEvent(e));}};DWPublication.prototype.onDblClick=function(e){if(this.m_currentPage){this.m_currentPage.onDblClick(this.translateMouseEvent(e));}};DWPublication.prototype.m_disableContextMenu=false;DWPublication.prototype.setDisableContextMenu=function(s){this.m_disableContextMenu=s;return this;};DWPublication.prototype.onContextMenu=function(e){if(this.m_disableContextMenu){e.preventDefault();}};DWPublication.prototype.m_touchPosition=null;DWPublication.prototype.m_touchPreventDefault=false;DWPublication.prototype.onTouchStart=function(e){if(this.m_currentPage){this.m_touchPreventDefault=false;e.stopPropagation();if(e.touches.length==1){this.m_touchPosition=e.touches[0];var ev=new DWMouseEvent(this.m_touchPosition.pageX,this.m_touchPosition.pageY);this.m_currentPage.onTouchStart(this.translateTouchEvent(ev));if(ev.preventDefaultSet){e.preventDefault();this.m_touchPreventDefault=true;}}}this.m_lastTouch=new Date().getTime();};DWPublication.prototype.onTouchMove=function(e){if(this.m_currentPage){if(this.m_touchPreventDefault){e.preventDefault();}if(e.touches.length==1){this.m_touchPosition=e.touches[0];var ev=new DWMouseEvent(this.m_touchPosition.pageX,this.m_touchPosition.pageY);this.m_currentPage.onTouchMove(this.translateTouchEvent(ev));}}};DWPublication.prototype.onTouchEnd=function(e){if(this.m_currentPage){if(this.m_touchPreventDefault){e.preventDefault();this.m_touchPreventDefault=false;}if(this.m_touchPosition){var ev=new DWMouseEvent(this.m_touchPosition.pageX,this.m_touchPosition.pageY);this.m_currentPage.onTouchEnd(this.translateTouchEvent(ev));}}this.m_lastTouch=new Date().getTime();};DWPublication.prototype.onMouseOut=function(e){if(this.m_currentPage){var target=e.relatedTarget;while(target!=null){if(target.parentNode==this.m_rootDiv){return;}target=target.parentNode;};this.m_currentPage.onMouseOut(this.translateMouseEvent(e));}};DWPublication.prototype.onKeyDown=function(e){if(this.m_currentPage){this.m_currentPage.onKeyDown(e);}};DWPublication.prototype.onKeyPress=function(e){if(this.m_currentPage){this.m_currentPage.onKeyPress(e);}};DWPublication.prototype.m_offsetBaseDiv=null;DWPublication.prototype.getBoundingClientRect=function(){if((!this.m_offsetBaseDiv)&&document.body){this.m_offsetBaseDiv=document.createElement("div");this.m_offsetBaseDiv.style.cssText="position:absolute;left:0;top:0";document.body.appendChild(this.m_offsetBaseDiv);}var boundingRect=this.m_rootDiv.getBoundingClientRect();var baseRect=this.m_offsetBaseDiv.getBoundingClientRect();var o=new Object();o.left=boundingRect.left-baseRect.left;o.top=boundingRect.top-baseRect.top;o.width=boundingRect.right-boundingRect.left;o.height=boundingRect.bottom-boundingRect.top;o.right=o.left+o.width;o.bottom=o.top+o.height;return o;};DWPublication.prototype.translateMouseEvent=function(e){var ne=new DWSlaveMouseEvent(e);if((this.m_mode==3)&&this.m_currentPage){var r=this.getBoundingClientRect();ne.clientX-=r.left;ne.clientY-=r.top;var off=this.m_currentPage.GetOffset();ne.clientX-=off.x;ne.clientY-=off.y;}else{ne.clientX-=this.m_rootDiv.offsetLeft;ne.clientY-=this.m_rootDiv.offsetTop;}ne.clientX/=this.m_pageScaleX;ne.clientY/=this.m_pageScaleY;return ne;};DWPublication.prototype.translateTouchEvent=function(e){if((this.m_mode==3)&&this.m_currentPage){var r=this.getBoundingClientRect();e.clientX-=r.left;e.clientY-=r.top;var off=this.m_currentPage.GetOffset();e.clientX-=off.x;e.clientY-=off.y;}else{e.clientX-=this.m_rootDiv.offsetLeft;e.clientY-=this.m_rootDiv.offsetTop;}e.clientX/=this.m_pageScaleX;e.clientY/=this.m_pageScaleY;return e;};DWPublication.prototype.ResetVariables=function(){DWVariables.instance().resetPublicationVariables();};DWQuestion=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWQuestion,DWGraphicalObject);DWQuestion.prototype.type=function(){return "Question";};DWQuestion.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);DWCBTManager.instance().initialiseObject(this);};DWQuestion.prototype.GetQuestionValue=function(){return DWCBTManager.instance().questionValue(this.getObjectCode().m_code);};DWQuestion.prototype.GetQuestionPossible=function(){return DWCBTManager.instance().questionPossible(this.getObjectCode().m_code);};DWQuestion.prototype.GetQuestionCorrect=function(){return DWCBTManager.instance().questionCorrect(this.getObjectCode().m_code);};DWQuestion.prototype.GetQuestionIncorrect=function(){return DWCBTManager.instance().questionIncorrect(this.getObjectCode().m_code);};DWQuestion.prototype.ConfirmQuestion=function(){DWCBTManager.instance().confirm(this.getObjectCode().m_code,this);};DWQuestion.prototype.ResetQuestion=function(){DWCBTManager.instance().reset(this.getObjectCode().m_code,this);};DWQuestion.prototype.SetUserAnswer=function(answer){DWCBTManager.instance().answer(this.getObjectCode().m_code,answer-1,this);};DWQuestion.prototype.ResetUserAnswer=function(answer){DWCBTManager.instance().resetAnswer(this.getObjectCode().m_code,answer-1);};DWRadialGradientBrush=function(x1,y1,r1){this.m_x1=x1;this.m_y1=y1;this.m_r1=r1;};DWRadialGradientBrush.prototype.m_x1=null;DWRadialGradientBrush.prototype.m_y1=null;DWRadialGradientBrush.prototype.m_r1=null;DWRadialGradientBrush.prototype.m_stops=null;DWRadialGradientBrush.prototype.createCopy=function(){var copy=new DWRadialGradientBrush(this.m_x1,this.m_y1,this.m_r1);for(var i=0;i<this.m_stops.length;i++){copy.addColourStop(this.m_stops[i].pos,this.m_stops[i].colour);}return copy;};DWRadialGradientBrush.prototype.addColourStop=function(pos,colour){if(!this.m_stops){this.m_stops=new Array();}this.m_stops.push(new DWGradientColourStop(pos,colour));return this;};DWRadialGradientBrush.prototype.apply=function(ctx){};DWRadialGradientBrush.prototype.applyCanvas=function(ctx){ctx.fillStyle=this.m_stops[0].colour.toString();};DWRadialGradientBrush.m_idCount=0;DWRadialGradientBrush.prototype.m_lgElement=null;DWRadialGradientBrush.prototype.m_lgID=null;DWRadialGradientBrush.prototype.applySVG=function(obj){if(!this.m_lgElement){var defs=DWSVGHelper.getDefsElement(obj);this.m_lgElement=document.createElementNS("http://www.w3.org/2000/svg","radialGradient");defs.appendChild(this.m_lgElement);this.m_lgID="_rgb"+String((DWRadialGradientBrush.m_idCount++));this.m_lgElement.setAttribute("id",this.m_lgID);}this.m_lgElement.setAttribute("cx",String(this.m_x1)+"%");this.m_lgElement.setAttribute("cy",String(this.m_y1)+"%");this.m_lgElement.setAttribute("r",String(this.m_r1)+"%");var s=0;var i=0;for(;(i<this.m_lgElement.childNodes.length)&&(s<this.m_stops.length);i++){if(this.m_lgElement.childNodes[i].nodeName=="stop"){var stop=this.m_lgElement.childNodes[i];stop.setAttribute("offset",String((this.m_stops[s].pos*0x64))+"%");stop.setAttribute("stop-color",this.m_stops[s].colour.toString());s++;}}if(s<this.m_stops.length){for(;s<this.m_stops.length;s++){var stop=document.createElementNS("http://www.w3.org/2000/svg","stop");this.m_lgElement.appendChild(stop);stop.setAttribute("offset",String((this.m_stops[s].pos*0x64))+"%");stop.setAttribute("stop-color",this.m_stops[s].colour.toString());}}else{if(i<this.m_lgElement.childNodes.length){for(;i<this.m_lgElement.childNodes.length;i++){if(this.m_lgElement.childNodes[i].nodeName=="stop"){this.m_lgElement.removeChild(this.m_lgElement.childNodes[i]);i--;}}}}obj.setAttribute("fill","url(#"+this.m_lgID+")");};DWRadialGradientBrush.prototype.removeSVG=function(obj){if(this.m_lgElement){var defs=DWSVGHelper.getDefsElement(obj);defs.removeChild(this.m_lgElement);DWSVGHelper.removeChildren(this.m_lgElement);this.m_lgElement=null;}obj.setAttribute("fill","none");};DWRadialGradientBrush.prototype.type=function(){return "Radial";};DWRadialGradientBrush.prototype.morph=function(b2,pos){return this;};DWRect=function(_x,_y,_width,_height){if(_x==undefined)_x=0;if(_y==undefined)_y=0;if(_width==undefined)_width=0;if(_height==undefined)_height=0;this.x=_x;this.y=_y;this.width=_width;this.height=_height;};DWRect.prototype.x=null;DWRect.prototype.y=null;DWRect.prototype.width=null;DWRect.prototype.height=null;DWRect.fromPoints=function(pts){if(pts.length){var l=pts[0].x;var r=l;var t=pts[0].y;var b=t;for(var i=1;i<pts.length;i++){if(pts[i].x<l){l=pts[i].x;}else{if(pts[i].x>r){r=pts[i].x;}}if(pts[i].y<t){t=pts[i].y;}else{if(pts[i].y>b){b=pts[i].y;}}}return new DWRect(l,t,r-l,b-t);}return new DWRect(0,0,0,0);};DWRect.fromSize=function(size){return new DWRect(0,0,size.x,size.y);};DWRect.prototype.left=function(){return this.x;};DWRect.prototype.top=function(){return this.y;};DWRect.prototype.right=function(){return this.x+this.width;};DWRect.prototype.bottom=function(){return this.y+this.height;};DWRect.prototype.topLeft=function(){return new DWPoint(this.x,this.y);};DWRect.prototype.topRight=function(){return new DWPoint(this.x+this.width,this.y);};DWRect.prototype.bottomLeft=function(){return new DWPoint(this.x,this.y+this.height);};DWRect.prototype.bottomRight=function(){return new DWPoint(this.x+this.width,this.y+this.height);};DWRect.prototype.topLeftPoint=function(){return new DWPoint(this.x,this.y);};DWRect.prototype.topRightPoint=function(){return new DWPoint((this.x+this.width)-1,this.y);};DWRect.prototype.bottomLeftPoint=function(){return new DWPoint(this.x,(this.y+this.height)-1);};DWRect.prototype.bottomRightPoint=function(){return new DWPoint((this.x+this.width)-1,(this.y+this.height)-1);};DWRect.prototype.centre=function(){return new DWPoint(this.x+(this.width/2),this.y+(this.height/2));};DWRect.prototype.center=function(){return new DWPoint(this.x+(this.width/2),this.y+(this.height/2));};DWRect.prototype.containsPoint=function(pt){return (pt.x>=this.x)&&(pt.x<(this.x+this.width))&&(pt.y>=this.y)&&(pt.y<(this.y+this.height));};DWRect.prototype.intersects=function(r){return !((((this.x>(r.x+r.width))||((this.x+this.width)<r.x))||(this.y>(r.y+r.height)))||((this.y+this.height)<r.y));};DWRect.intersect=function(r1,r2){var l=(r1.x>r2.x?r1.x:r2.x);var t=(r1.y>r2.y?r1.y:r2.y);var r=((r1.x+r1.width)<(r2.x+r2.width)?r1.x+r1.width:r2.x+r2.width);var b=((r1.y+r1.height)<(r2.y+r2.height)?r1.y+r1.height:r2.y+r2.height);var r=new DWRect(l,t,r-l,b-t);return r;};DWRect.prototype.isEmpty=function(){return (this.width==0)&&(this.height==0);};DWRect.union=function(r1,r2){var l=(r1.x<r2.x?r1.x:r2.x);var t=(r1.y<r2.y?r1.y:r2.y);var r=((r1.x+r1.width)>(r2.x+r2.width)?r1.x+r1.width:r2.x+r2.width);var b=((r1.y+r1.height)>(r2.y+r2.height)?r1.y+r1.height:r2.y+r2.height);var r=new DWRect(l,t,r-l,b-t);return r;};DWRect.prototype.contains=function(r){return (r.x>=this.x)&&((r.x+r.width)<=(this.x+this.width))&&(r.y>=this.y)&&((r.y+r.height)<=(this.y+this.height));};DWRect.prototype.offsetRect=function(_x,_y){this.x+=_x;this.y+=_y;};DWRect.prototype.inflateRect=function(_x,_y){this.x-=_x;this.y-=_y;this.width+=(_x*2);this.height+=(_y*2);};DWRect.prototype.toIntegerRectExpand=function(){return new DWRect(Math.floor(this.x),Math.floor(this.y),Math.ceil((this.x+this.width))-Math.floor(this.x),Math.ceil((this.y+this.height))-Math.floor(this.y));};DWRect.prototype.moveLeftEdge=function(val){this.x+=val;this.width-=val;};DWRect.prototype.moveTopEdge=function(val){this.y+=val;this.height-=val;};DWRect.prototype.moveRightEdge=function(val){this.width+=val;};DWRect.prototype.moveBottomEdge=function(val){this.height+=val;};DWTransition=function(time){if(time<=0)time=10;this.m_time=time;};DWTransition.prototype.m_time=null;DWTransition.prototype.m_object=null;DWTransition.prototype.m_callback=null;DWTransition.prototype.m_start=0;DWTransition.prototype.m_speedFunction=null;DWTransition.prototype.m_imageGroup=null;DWTransition.prototype.setSpeedFunction=function(fn){this.m_speedFunction=fn;return this;};DWTransition.prototype.start=function(callback){this.m_callback=callback;this.m_start=new Date().getTime();this.updateTransition(0);DWUpdateController.addAnimationUpdate(this);};DWTransition.prototype.setImageGroup=function(imageGroup){this.m_imageGroup=imageGroup;};DWTransition.prototype.cancel=function(){DWUpdateController.removeAnimationUpdate(this);this.updateTransition(1);};DWTransition.prototype.createInstance=function(object){return null;};DWTransition.prototype.getPos=function(){var pos=time/this.m_time;return pos;};DWTransition.prototype.update=function(time){var now=new Date().getTime()-this.m_start;var pos=now/this.m_time;if(now>=this.m_time){DWUpdateController.removeAnimationUpdate(this);this.updateTransition(1);this.m_callback();}else{if(this.m_speedFunction){pos=this.m_speedFunction(pos);}this.updateTransition(pos);}};DWTransition.prototype.updateTransition=function(pos){};DWRevealTransition=function(time,reverse){DWTransition.call(this,time);this.m_reverse=reverse;};__inherit(DWRevealTransition,DWTransition);DWRevealTransition.prototype.m_reverse=null;DWRevealTransition.prototype.m_blocks=null;DWRevealTransition.prototype.addBlock=function(x1,y1,x2,y2,x1s,y1s,x2s,y2s,startTime,endTime,startAlpha,endAlpha,alphaFn){if(startAlpha==undefined)startAlpha=0;if(endAlpha==undefined)endAlpha=1;if(alphaFn==undefined)alphaFn=-1;var n=new DWRevealTransitionBlock();n.m_x1=x1;n.m_y1=y1;n.m_x2=x2;n.m_y2=y2;n.m_x1s=x1s;n.m_y1s=y1s;n.m_x2s=x2s;n.m_y2s=y2s;n.m_startTime=startTime;n.m_endTime=endTime;n.m_startAlpha=startAlpha;n.m_endAlpha=endAlpha;if(!this.m_blocks){this.m_blocks=new Array();}this.m_blocks.push(n);return this;};DWRevealTransition.prototype.createInstance=function(object){var n=new DWRevealTransition(this.m_time,this.m_reverse);n.m_blocks=this.m_blocks;n.m_object=object;return n;};DWRevealTransition.prototype.m_mask=null;DWRevealTransition.prototype.m_clipRects=null;DWRevealTransition.prototype.m_clipPath=null;DWRevealTransition.prototype.start=function(callback){if(this.m_blocks[0].m_startAlpha==this.m_blocks[0].m_endAlpha){this.m_clipPath=this.m_object.getAdapter().getTransitionClipPath(this.m_imageGroup);}else{this.m_mask=this.m_object.getAdapter().getTransitionMask(this.m_imageGroup);if(this.m_mask){this.m_clipRects=new Array();for(var i=0;i<this.m_blocks.length;i++){var rect=document.createElementNS("http://www.w3.org/2000/svg","path");this.m_clipRects.push(rect);this.m_mask.appendChild(rect);}}else{this.m_clipPath=this.m_object.getAdapter().getTransitionClipPath(this.m_imageGroup);}}DWTransition.prototype.start.call(this,callback);};DWRevealTransition.prototype.updateTransition=function(pos){if(this.m_reverse){pos=1-pos;}if(this.m_mask||this.m_clipPath){var width=this.m_object.getWidth();var height=this.m_object.getHeight();var previousD="";for(var i=0;i<this.m_blocks.length;i++){var b=this.m_blocks[i];var s=b.m_startTime/0x64;var e=b.m_endTime/0x64;var p=(pos-s)/(e-s);if(p<0)p=0;if(p>1)p=1;var x1=b.m_x1s+((0-b.m_x1s)*p);var y1=b.m_y1s+((0-b.m_y1s)*p);var x2=b.m_x2s+((0x3e8-b.m_x2s)*p);var y2=b.m_y2s+((0x3e8-b.m_y2s)*p);x1=b.m_x1+((x1*(b.m_x2-b.m_x1))/0x3e8);y1=b.m_y1+((y1*(b.m_y2-b.m_y1))/0x3e8);x2=b.m_x1+((x2*(b.m_x2-b.m_x1))/0x3e8);y2=b.m_y1+((y2*(b.m_y2-b.m_y1))/0x3e8);if(x2!=0)x2++;if(y2!=0)y2++;x1=((x1*width)/0x3e8)-(width/2);y1=((y1*height)/0x3e8)-(height/2);x2=((x2*width)/0x3e8)-(width/2);y2=((y2*height)/0x3e8)-(height/2);var a=b.m_startAlpha+((b.m_endAlpha-b.m_startAlpha)*p);var d="M "+x1+" "+y1;d+=(((" L "+x2)+" ")+y1);d+=(((" L "+x2)+" ")+y2);d+=(((" L "+x1)+" ")+y2);d+=" Z";if(this.m_clipPath){d=previousD+" "+d;this.m_clipPath.setAttribute("d",d);previousD=d;}else{this.m_clipRects[i].setAttribute("fill","rgba(255,255,255,"+a+")");this.m_clipRects[i].setAttribute("d",d);}}}if(((!this.m_reverse)&&(pos>=1))||(this.m_reverse&&(pos<=0))){if(this.m_mask){this.m_object.getAdapter().removeTransitionMask(this.m_imageGroup);this.m_mask=null;}else{if(this.m_clipPath){this.m_object.getAdapter().removeTransitionClipPath(this.m_imageGroup);this.m_clipPath=null;}}}};DWRevealTransitionBlock=function(){};DWRevealTransitionBlock.prototype.m_x1=null;DWRevealTransitionBlock.prototype.m_y1=null;DWRevealTransitionBlock.prototype.m_x2=null;DWRevealTransitionBlock.prototype.m_y2=null;DWRevealTransitionBlock.prototype.m_x1s=null;DWRevealTransitionBlock.prototype.m_y1s=null;DWRevealTransitionBlock.prototype.m_x2s=null;DWRevealTransitionBlock.prototype.m_y2s=null;DWRevealTransitionBlock.prototype.m_startTime=null;DWRevealTransitionBlock.prototype.m_endTime=null;DWRevealTransitionBlock.prototype.m_startAlpha=null;DWRevealTransitionBlock.prototype.m_endAlpha=null;DWRollover=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWRollover,DWGraphicalObject);DWRollover.prototype.type=function(){return "Rollover";};DWRollover.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);if(this.m_entries&&(this.m_entries[1]!=undefined)){this.m_entries[1].Show();this.m_current=this.m_entries[1];}};DWRollover.prototype.m_entries=null;DWRollover.prototype.setEntry=function(handle,object){if(!this.m_entries){this.m_entries=new Array();}this.m_entries[handle]=object;return this;};DWRollover.prototype.m_current=null;DWRollover.prototype.setAppearance=function(handle){DWGraphicalObject.prototype.setAppearance.call(this,handle);if(this.m_entries){if(this.m_entries[handle]!=undefined){if(this.m_current){this.m_current.Hide();}this.m_current=this.m_entries[handle];this.m_current.Show();}}};DWSCORMManager=function(){};DWSCORMManager.m_instance=null;DWSCORMManager.instance=function(){if(!DWSCORMManager.m_instance){DWSCORMManager.m_instance=new DWSCORMManager();DWSCORMManager.m_instance.initialise();}return DWSCORMManager.m_instance;};DWSCORMManager.LMSInitialize=function(){var t=DWSCORMManager.instance();if(t.m_lms!=null){var error=t.m_lms.LMSInitialize("");DWVariables.instance().setValue("LMS_INITIALIZE_RETURN",error);DWVariables.instance().setValue("JSREADY","true");return error;}else{if(t.m_lms2004!=null){var error=t.m_lms2004.Initialize("");DWVariables.instance().setValue("LMS_INITIALIZE_RETURN",error);DWVariables.instance().setValue("JSREADY","true");return error;}else{DWVariables.instance().setValue("LMS_INITIALIZE_RETURN","NOAPI");DWVariables.instance().setValue("JSREADY","true");return "NOAPI";}}};DWSCORMManager.LMSGetValue=function(name,retvar){var t=DWSCORMManager.instance();if(t.m_lms!=null){var value=t.m_lms.LMSGetValue(name);DWVariables.instance().setValue(retvar,value);DWVariables.instance().setValue("JSREADY","true");return value;}else{if(t.m_lms2004!=null){var value=t.m_lms2004.GetValue(name);DWVariables.instance().setValue(retvar,value);DWVariables.instance().setValue("JSREADY","true");return value;}else{DWVariables.instance().setValue(retvar,0);DWVariables.instance().setValue("JSREADY","true");}}return null;};DWSCORMManager.LMSSetValue=function(name,value){var t=DWSCORMManager.instance();if(t.m_lms!=null){t.m_lms.LMSSetValue(name,value);DWVariables.instance().setValue("JSREADY","true");}else{if(t.m_lms2004!=null){t.m_lms2004.SetValue(name,value);DWVariables.instance().setValue("JSREADY","true");}else{DWVariables.instance().setValue("JSREADY","true");}}};DWSCORMManager.LMSSetValueFromVariable=function(name,variable){DWSCORMManager.LMSSetValue(name,DWVariables.instance().getValue(variable));};DWSCORMManager.LMSFinish=function(){var t=DWSCORMManager.instance();if(t.m_lms!=null){var error=t.m_lms.LMSFinish("");DWVariables.instance().setValue("LMS_FINISH_RETURN",error);DWVariables.instance().setValue("JSREADY","true");return error;}else{if(t.m_lms2004!=null){var error=t.m_lms2004.Terminate("");DWVariables.instance().setValue("LMS_FINISH_RETURN",error);DWVariables.instance().setValue("JSREADY","true");return error;}else{DWVariables.instance().setValue("JSREADY","true");return "NOAPI";}}};DWSCORMManager.LMSCommit=function(){var t=DWSCORMManager.instance();if(t.m_lms!=null){var error=t.m_lms.LMSCommit("");DWVariables.instance().setValue("LMS_COMMIT_RETURN",error);DWVariables.instance().setValue("JSREADY","true");return error;}else{if(t.m_lms2004!=null){var error=t.m_lms2004.Commit("");DWVariables.instance().setValue("LMS_COMMIT_RETURN",error);DWVariables.instance().setValue("JSREADY","true");return error;}else{DWVariables.instance().setValue("JSREADY","true");return "NOAPI";}}};DWSCORMManager.prototype.m_lms=null;DWSCORMManager.prototype.m_lms2004=null;DWSCORMManager.prototype.initialise=function(){this.m_lms=DWSCORMManager.getAPI();this.m_lms2004=DWSCORMManager.getAPI2004();};DWSCORMManager.findAPI2004=function(win){var findAPITries=0;var tempObj=null;var validLocation=true;var winAPI=null;try{tempObj=win.API_1484_11;}catch(e){validLocation=false;}try{tempObj=win.parent;}catch(e){validLocation=false;}while(validLocation&&(win.API_1484_11==null)&&(win.parent!=null)&&(win.parent!=win)){findAPITries++;if(findAPITries>7){return null;}win=win.parent;try{tempObj=win.API_1484_11;}catch(e){validLocation=false;}try{tempObj=win.parent;}catch(e){validLocation=false;}}try{winAPI=win.API_1484_11;}catch(e){}return winAPI;};DWSCORMManager.findAPI=function(win){var findAPITries=0;var tempObj=null;var validLocation=true;var winAPI=null;try{tempObj=win.API;}catch(e){validLocation=false;}try{tempObj=win.parent;}catch(e){validLocation=false;}while(validLocation&&(win.API==null)&&(win.parent!=null)&&(win.parent!=win)){findAPITries++;if(findAPITries>7){return null;}win=win.parent;try{tempObj=win.API;}catch(e){validLocation=false;}try{tempObj=win.parent;}catch(e){validLocation=false;}}try{winAPI=win.API;}catch(e){}return winAPI;};DWSCORMManager.getAPI2004=function(){var tempObj=null;var validLocation=true;var theAPI=DWSCORMManager.findAPI2004(window);try{tempObj=window.opener;}catch(e){validLocation=false;}if(validLocation&&(theAPI==null)&&(window.opener!=null)&&(typeof(window.opener)!="undefined"))theAPI=DWSCORMManager.findAPI(window.opener);if(theAPI==null){}return theAPI;};DWSCORMManager.getAPI=function(){var tempObj=null;var validLocation=true;var theAPI=DWSCORMManager.findAPI(window);try{tempObj=window.opener;}catch(e){validLocation=false;}if(validLocation&&(theAPI==null)&&(window.opener!=null)&&(typeof(window.opener)!="undefined"))theAPI=DWSCORMManager.findAPI(window.opener);return theAPI;};DWSVGEffectsFilter=function(){};DWSVGEffectsFilter.prototype.m_blurX=0;DWSVGEffectsFilter.prototype.m_blurY=0;DWSVGEffectsFilter.prototype.m_blurRepeat=0;DWSVGEffectsFilter.prototype.m_flareWidth=0;DWSVGEffectsFilter.prototype.m_flareBlur=0;DWSVGEffectsFilter.prototype.m_flareColour=null;DWSVGEffectsFilter.prototype.m_shadowX=0;DWSVGEffectsFilter.prototype.m_shadowY=0;DWSVGEffectsFilter.prototype.m_shadowBlur=0;DWSVGEffectsFilter.prototype.m_shadowColour=null;DWSVGEffectsFilter.prototype.m_filter=null;DWSVGEffectsFilter.prototype.m_filterID=null;DWSVGEffectsFilter.m_idCount=0;DWSVGEffectsFilter.prototype.update=function(object){if(!this.m_filter){var svg=object.ownerSVGElement;var defs=null;for(var i=0;i<svg.childNodes.length;i++){if(svg.childNodes[i].nodeName=="defs"){defs=svg.childNodes[i];break;}}if(defs==null){defs=document.createElementNS("http://www.w3.org/2000/svg","defs");svg.appendChild(defs);}this.m_filter=document.createElementNS("http://www.w3.org/2000/svg","filter");defs.appendChild(this.m_filter);this.m_filterID="_fx"+String((DWSVGEffectsFilter.m_idCount++));this.m_filter.setAttribute("id",this.m_filterID);}while(this.m_filter.childNodes.length){this.m_filter.removeChild(this.m_filter.childNodes[0]);}var hasEffect=false;if((this.m_blurX>0)||(this.m_blurY>0)){this.updateBlur();hasEffect=true;}if(this.m_flareWidth>0){this.updateFlare();hasEffect=true;}if((this.m_shadowX>0)||(this.m_shadowY>0)){this.updateShadow();hasEffect=true;}if(hasEffect){object.setAttribute("filter","url(#"+this.m_filterID+")");}else{object.removeAttribute("filter");}};DWSVGEffectsFilter.prototype.updateBlur=function(){for(var i=0;i<this.m_blurRepeat;i++){var pBlur=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");pBlur.setAttribute("stdDeviation",String(this.m_blurX)+","+String(this.m_blurY));this.m_filter.appendChild(pBlur);if(i==(this.m_blurRepeat-1)){pBlur.setAttribute("result","blurOut");}}};DWSVGEffectsFilter.prototype.updateFlare=function(){var pMorph=document.createElementNS("http://www.w3.org/2000/svg","feMorphology");this.m_filter.appendChild(pMorph);pMorph.setAttribute("operator","dilate");pMorph.setAttribute("radius",String(this.m_flareWidth));pMorph.setAttribute("in","SourceAlpha");if(this.m_flareBlur>0){var pBlur=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");this.m_filter.appendChild(pBlur);pBlur.setAttribute("stdDeviation",String(this.m_flareBlur));}if((this.m_flareColour.r!=0)||(this.m_flareColour.g!=0)||(this.m_flareColour.b!=0)||(this.m_flareColour.a!=0xff)){var pMatrix=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix");this.m_filter.appendChild(pMatrix);pMatrix.setAttribute("type","matrix");var m="0 0 0 "+(this.m_flareColour.r/0xff)+" 0 ";m+=(("0 0 0 "+(this.m_flareColour.g/0xff))+" 0 ");m+=(("0 0 0 "+(this.m_flareColour.b/0xff))+" 0 ");m+=(("0 0 0 "+this.m_flareColour.a)+" 0 ");pMatrix.setAttribute("values",m);pMatrix.setAttribute("result","res");}var pBlend=document.createElementNS("http://www.w3.org/2000/svg","feBlend");this.m_filter.appendChild(pBlend);if((this.m_blurX>0)||(this.m_blurY>0)){pBlend.setAttribute("in","blurOut");}else{pBlend.setAttribute("in","SourceGraphic");}pBlend.setAttribute("mode","normal");pBlend.setAttribute("result","flareOut");};DWSVGEffectsFilter.prototype.updateShadow=function(){var pOffset=document.createElementNS("http://www.w3.org/2000/svg","feOffset");this.m_filter.appendChild(pOffset);pOffset.setAttribute("result","offOut");if(this.m_flareWidth==0){pOffset.setAttribute("in","SourceAlpha");}pOffset.setAttribute("dx",String(this.m_shadowX));pOffset.setAttribute("dy",String(this.m_shadowY));if(this.m_shadowBlur>0){var pBlur=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");this.m_filter.appendChild(pBlur);pBlur.setAttribute("stdDeviation",String(this.m_shadowBlur));}if((this.m_shadowColour.r!=0)||(this.m_shadowColour.g!=0)||(this.m_shadowColour.b!=0)||(this.m_shadowColour.a!=0xff)){var pMatrix=document.createElementNS("http://www.w3.org/2000/svg","feColorMatrix");this.m_filter.appendChild(pMatrix);pMatrix.setAttribute("type","matrix");var m="0 0 0 "+(this.m_shadowColour.r/0xff)+" 0 ";m+=(("0 0 0 "+(this.m_shadowColour.g/0xff))+" 0 ");m+=(("0 0 0 "+(this.m_shadowColour.b/0xff))+" 0 ");m+=(("0 0 0 "+this.m_shadowColour.a)+" 0 ");pMatrix.setAttribute("values",m);pMatrix.setAttribute("result","res");}var pBlend=document.createElementNS("http://www.w3.org/2000/svg","feBlend");this.m_filter.appendChild(pBlend);if(this.m_flareWidth>0){pBlend.setAttribute("in","flareOut");}else{if((this.m_blurX>0)||(this.m_blurY>0)){pBlend.setAttribute("in","blurOut");}else{pBlend.setAttribute("in","SourceGraphic");}}pBlend.setAttribute("mode","normal");pBlend.setAttribute("result","flareOut");};DWSVGHelper=function(){};DWSVGHelper.getDefsElement=function(element){var svg=element.ownerSVGElement;var defs=null;for(var i=0;i<svg.childNodes.length;i++){if(svg.childNodes[i].nodeName=="defs"){defs=svg.childNodes[i];break;}}if(defs==null){defs=document.createElementNS("http://www.w3.org/2000/svg","defs");svg.appendChild(defs);}return defs;};DWSVGHelper.setRect=function(e,r){e.setAttribute("x",String(r.x));e.setAttribute("y",String(r.y));e.setAttribute("width",String(r.width));e.setAttribute("height",String(r.height));};DWSVGHelper.removeChildren=function(e){while(e.childNodes.length){e.removeChild(e.childNodes[0]);}};DWSVGHelper.addRect=function(e,r){var rect=document.createElementNS("http://www.w3.org/2000/svg","rect");e.appendChild(rect);DWSVGHelper.setRect(rect,r);rect.setAttribute("fill","none");rect.setAttribute("stroke","none");return rect;};DWSVGHelper.addRoundedRect=function(e,r,radius){var rect=document.createElementNS("http://www.w3.org/2000/svg","rect");e.appendChild(rect);DWSVGHelper.updateRoundedRect(rect,r,radius);return rect;};DWSVGHelper.updateRoundedRect=function(rect,r,radius){DWSVGHelper.setRect(rect,r);rect.setAttribute("rx",String(radius));rect.setAttribute("ry",String(radius));rect.setAttribute("fill","none");rect.setAttribute("stroke","none");};DWSVGHelper.addImage=function(e,r,url){var rect=document.createElementNS("http://www.w3.org/2000/svg","image");e.appendChild(rect);DWSVGHelper.setRect(rect,r);rect.setAttributeNS("http://www.w3.org/1999/xlink","href",url);return rect;};DWSVGHelper.addPath=function(parent,clr,strokeWidth){if(clr==undefined)clr=null;if(strokeWidth==undefined)strokeWidth=0;var p=document.createElementNS("http://www.w3.org/2000/svg","path");parent.appendChild(p);var args=new Array();args[0]=p;for(var i=1;i<arguments.length;i++){args[i]=arguments[i];}DWSVGHelper.updatePath.apply(null,args);return p;};DWSVGHelper.updatePath=function(p,clr,strokeWidth){if(clr==undefined)clr=null;if(strokeWidth==undefined)strokeWidth=0;p.setAttribute("fill-rule","evenodd");p.setAttribute("fill","none");if(clr!=null){p.setAttribute("stroke",clr.toString());p.setAttribute("stroke-width",String(strokeWidth));}if(arguments.length>3){var d="";for(var i=3;i<arguments.length;i++){var pt=arguments[i];if(i==3){d+="M ";}else{d+="L ";}d+=((String(pt.x)+" ")+String(pt.y));}p.setAttribute("d",d);}};DWSVGHelper.addClipPath=function(parent,pts){var cp=document.createElementNS("http://www.w3.org/2000/svg","clipPath");var defs=DWSVGHelper.getDefsElement(parent);defs.appendChild(cp);var p=document.createElementNS("http://www.w3.org/2000/svg","path");cp.appendChild(p);p.setAttribute("fill-rule","evenodd");if(pts){var d="";for(var i=0;i<pts.length;i++){d+=pts[i];d+=" ";}p.setAttribute("d",d);}return cp;};DWSVGHelper.setFillColour=function(e,clr){e.setAttribute("fill",clr.toString());};DWSVGHelper.setAlpha=function(e,alpha){e.setAttribute("opacity",String(alpha));};DWSVGHelper.setTransform=function(e,translate,scale,rotate,preTranslate){if(translate==undefined)translate=null;if(scale==undefined)scale=null;if(rotate==undefined)rotate=0;if(preTranslate==undefined)preTranslate=null;var transform="";if(translate){transform+=(((("translate("+String(translate.x))+",")+String(translate.y))+") ");}if(rotate!=0){transform+=(("rotate("+rotate)+") ");}if(scale&&((scale.x!=1)||(scale.y!=1))){transform+=(((("scale("+scale.x)+",")+scale.y)+") ");}if(preTranslate){transform+=(((("translate("+preTranslate.x)+",")+preTranslate.y)+") ");}e.setAttribute("transform",transform);};DWSVGHelper.resetTransform=function(e){e.setAttribute("transform","");};DWSVGTextExpression=function(objectID,expression){DWTextExpression.call(this,expression);this.m_object=document.getElementById(objectID);};__inherit(DWSVGTextExpression,DWTextExpression);DWSVGTextExpression.prototype.m_object=null;DWSVGTextExpression.prototype.update=function(time){var result=this.m_expression();if(result==undefined){result="";}else{result=String(result);}if(result!=this.m_object.textContent){this.m_object.textContent=result;}};DWSVGTextVariable=function(objectID,name){DWTextVariable.call(this,name);this.m_object=document.getElementById(objectID);};__inherit(DWSVGTextVariable,DWTextVariable);DWSVGTextVariable.prototype.m_object=null;DWSVGTextVariable.prototype.variableChanged=function(name){if(name==this.m_name){var value=DWVariables.instance().getValue(this.m_name);if(value==undefined){value="";}this.m_object.textContent=String(value);}};DWScoreAction=function(name,correct,update,value,totalValue,type){this.m_name=name;this.m_correct=correct;this.m_update=update;this.m_value=value;this.m_totalValue=totalValue;this.m_type=type;};__inherit(DWScoreAction,DWAction);DWScoreAction.prototype.m_name=null;DWScoreAction.prototype.m_correct=null;DWScoreAction.prototype.m_update=null;DWScoreAction.prototype.m_value=null;DWScoreAction.prototype.m_totalValue=null;DWScoreAction.prototype.m_type=null;DWScoreAction.prototype.Go=function(callback){if(this.m_type==0x320){this.DWScoreStoreAction(this.m_name,this.m_correct,this.m_value,this.m_totalValue,false);}else{if(this.m_type==0x326){this.DWScoreStoreAction(this.m_name,this.m_correct,this.m_value,this.m_totalValue,true);}else{if(this.m_type==0x321){this.DWScoreResetAction();}else{if(this.m_type==0x324){this.DWScoreUpdateAction(this.m_name,this.m_correct,this.m_update,this.m_value,this.m_totalValue);}else{if(this.m_type==0x325){this.DWScoreResetAllAction(this.m_value);}}}}}return 0;};DWScoreAction.prototype.DWScoreUpdateAction=function(name,correct,update,value,total){if(name.length==0){return;}var previous_score=0;var previous_correct=false;var s=DWVariables.instance().getValue(name,host).split(";");var scored_previous=s.length==2;if(scored_previous){previous_score=parseInt(s[1]);previous_correct=s[0]=="true";}var new_score=value;if(update){new_score+=previous_score;}DWVariables.instance().setValue(name,(correct?"true;":"false;")+new_score);var value=DWVariables.instance().getValue("SCORE_VALUE")-0;value+=(new_score-previous_score);DWVariables.instance().setValue("SCORE_VALUE",value);var value_total=DWVariables.instance().getValue("SCORE_VALUE_TOTAL")-0;if(!scored_previous){value_total+=total;}DWVariables.instance().setValue("SCORE_VALUE_TOTAL",value_total);var value_percent=0;if(value_total){value_percent=Math.floor(((value*0x64)/value_total)+0.5);}DWVariables.instance().setValue("SCORE_VALUE_PERCENT",value_percent);var score_correct=DWVariables.instance().getValue("SCORE_CORRECT")-0;if(previous_correct)score_correct--;if(correct)score_correct++;DWVariables.instance().setValue("SCORE_CORRECT",score_correct);var score_total=DWVariables.instance().getValue("SCORE_TOTAL")-0;if(!scored_previous)score_total++;DWVariables.instance().setValue("SCORE_TOTAL",score_total);DWVariables.instance().setValue("SCORE_INCORRECT",score_total-score_correct);var score_percent=0;if(score_total){score_percent=Math.floor(((score_correct*0x64)/score_total)+0.5);}DWVariables.instance().setValue("SCORE_PERCENT",score_percent);};DWScoreAction.prototype.DWScoreStoreAction=function(name,correct,value,total,reverse){var score_value=DWVariables.instance().getValue("SCORE_VALUE")-0;score_value+=(reverse?(-value):value);DWVariables.instance().setValue("SCORE_VALUE",score_value);var score_value_total=DWVariables.instance().getValue("SCORE_VALUE_TOTAL")-0;score_value_total+=(reverse?(-total):total);DWVariables.instance().setValue("SCORE_VALUE_TOTAL",score_value_total);var score_value_percent;if(score_value_total){score_value_percent=Math.floor(((score_value*0x64)/score_value_total)+0.5);}else{score_value_percent=0;}DWVariables.instance().setValue("SCORE_VALUE_PERCENT",score_value_percent);var score_correct=DWVariables.instance().getValue("SCORE_CORRECT")-0;if(correct){if(reverse){score_correct--;}else{score_correct++;}}DWVariables.instance().setValue("SCORE_CORRECT",score_correct);var score_total=DWVariables.instance().getValue("SCORE_TOTAL")-0;if(reverse){score_total--;}else{score_total++;}DWVariables.instance().setValue("SCORE_TOTAL",score_total);DWVariables.instance().setValue("SCORE_INCORRECT",score_total-score_correct);var percent_correct=0;if(score_total){percent_correct=Math.floor(((score_correct*0x64)/score_total)+0.5);}DWVariables.instance().setValue("SCORE_PERCENT",percent_correct);};DWScoreAction.prototype.DWScoreResetAction=function(){DWVariables.instance().setValue("SCORE_VALUE",0);DWVariables.instance().setValue("SCORE_VALUE_TOTAL",0);DWVariables.instance().setValue("SCORE_VALUE_PERCENT",0);DWVariables.instance().setValue("SCORE_CORRECT",0);DWVariables.instance().setValue("SCORE_INCORRECT",0);DWVariables.instance().setValue("SCORE_TOTAL",0);DWVariables.instance().setValue("SCORE_PERCENT",0);};DWScoreAction.prototype.DWScoreResetAllAction=function(value){if((value==0)||(value==2)){DWVariables.instance().resetPageVariables();}if((value==1)||(value==2)){DWVariables.instance().resetPublicationVariables();}};DWScriptAction=function(script){this.m_script=script;};__inherit(DWScriptAction,DWAction);DWScriptAction.prototype.m_script=null;DWScriptAction.prototype.m_host=null;DWScriptAction.prototype.Go=function(callback){this.m_script.call(this.m_host);return 0;};DWScriptAction.prototype.initEvents=function(host){DWAction.prototype.initEvents.call(this,host);this.m_host=host;};DWScriptAction.prototype.closeEvents=function(host){this.m_host=null;DWAction.prototype.closeEvents.call(this,host);};DWScrollAngleTransition=function(time,reverse){DWTransition.call(this,time);this.m_reverse=reverse;};__inherit(DWScrollAngleTransition,DWTransition);DWScrollAngleTransition.prototype.m_reverse=null;DWScrollAngleTransition.prototype.m_angle=null;DWScrollAngleTransition.prototype.m_startTime=null;DWScrollAngleTransition.prototype.m_endTime=null;DWScrollAngleTransition.prototype.m_startAlpha=null;DWScrollAngleTransition.prototype.m_endAlpha=null;DWScrollAngleTransition.prototype.setParams=function(angle,startTime,endTime,startAlpha,endAlpha){if(startAlpha==undefined)startAlpha=0;if(endAlpha==undefined)endAlpha=1;this.m_angle=angle;this.m_startTime=startTime;this.m_endTime=endTime;this.m_startAlpha=startAlpha;this.m_endAlpha=endAlpha;return this;};DWScrollAngleTransition.prototype.createInstance=function(object){var n=new DWScrollAngleTransition(this.m_time,this.m_reverse);n.setSpeedFunction(this.m_speedFunction);n.setParams(this.m_angle,this.m_startTime,this.m_endTime,this.m_startAlpha,this.m_endAlpha);n.m_object=object;return n;};DWScrollAngleTransition.prototype.m_ptStart=null;DWScrollAngleTransition.prototype.m_ptFinal=null;DWScrollAngleTransition.prototype.start=function(callback){var parent=this.m_object.getParent();var bounding=null;if(parent.type()=="Page"){bounding=DWRect.fromSize(parent.getSize());}else{bounding=parent.getTransformedBoundingRect();}this.m_ptFinal=this.m_object.getTransformedBoundingRect().centre();this.m_ptStart=this.edgeIntersect(bounding,this.m_ptFinal,this.m_angle);this.m_ptStart=this.m_ptStart.subtract(this.m_ptFinal);this.m_ptFinal=this.m_ptFinal.subtract(this.m_ptFinal);DWTransition.prototype.start.call(this,callback);};DWScrollAngleTransition.prototype.updateTransition=function(pos){if(this.m_reverse){pos=1-pos;}var width=this.m_object.getWidth();var height=this.m_object.getHeight();var s=this.m_startTime/0x64;var e=this.m_endTime/0x64;var translateX=this.m_ptStart.x+((this.m_ptFinal.x-this.m_ptStart.x)*pos);var translateY=this.m_ptStart.y+((this.m_ptFinal.y-this.m_ptStart.y)*pos);var a=this.m_startAlpha+((this.m_endAlpha-this.m_startAlpha)*pos);if(this.m_imageGroup){DWSVGHelper.setTransform(this.m_imageGroup,new DWPoint(translateX,translateY));DWSVGHelper.setAlpha(this.m_imageGroup,a);}else{this.m_object.setTranslate(translateX,translateY);this.m_object.setAlpha(a);}};DWScrollAngleTransition.prototype.edgeIntersect=function(bounding,start,angle){var result=new DWPoint();var DEG_TO_RAD2=3.14159/0xb4;if((angle==0x5a)||(angle==0x10e)){if(angle==0x5a){return new DWPoint(bounding.right(),start.y);}if(angle==0x10e){return new DWPoint(bounding.left(),start.y);}}else{if((angle>0x5a)&&(angle<0x10e)){result.x=start.x+((start.y-bounding.bottom())*Math.tan((DEG_TO_RAD2*angle)));result.y=bounding.bottom();if((result.x>=bounding.left())&&(result.x<bounding.right())){return result;}}else{result.x=start.x-((bounding.top()-start.y)*Math.tan((DEG_TO_RAD2*angle)));result.y=bounding.top();if((result.x>=bounding.left())&&(result.x<bounding.right())){return result;}}}if(angle<0xb4){result.x=bounding.right();result.y=start.y+((bounding.right()-start.x)*Math.tan((DEG_TO_RAD2*(angle-0x5a))));return result;}else{result.x=bounding.left();result.y=start.y+((start.x-bounding.left())*Math.tan((DEG_TO_RAD2*(0x10e-angle))));return result;}};DWScrollTransition=function(time,reverse){DWTransition.call(this,time);this.m_reverse=reverse;};__inherit(DWScrollTransition,DWTransition);DWScrollTransition.prototype.m_reverse=null;DWScrollTransition.prototype.m_blocks=null;DWScrollTransition.prototype.addBlock=function(x1,y1,x2,y2,x1s,y1s,x2s,y2s,startTime,endTime,startAlpha,endAlpha,alphaFn){if(startAlpha==undefined)startAlpha=0;if(endAlpha==undefined)endAlpha=1;if(alphaFn==undefined)alphaFn=-1;var n=new DWScrollTransitionBlock();n.m_x1=x1;n.m_y1=y1;n.m_x2=x2;n.m_y2=y2;n.m_x1s=x1s;n.m_y1s=y1s;n.m_x2s=x2s;n.m_y2s=y2s;n.m_startTime=startTime;n.m_endTime=endTime;n.m_startAlpha=startAlpha;n.m_endAlpha=endAlpha;if(!this.m_blocks){this.m_blocks=new Array();}this.m_blocks.push(n);return this;};DWScrollTransition.prototype.createInstance=function(object){var n=new DWScrollTransition(this.m_time,this.m_reverse);n.setSpeedFunction(this.m_speedFunction);n.m_blocks=this.m_blocks;n.m_object=object;return n;};DWScrollTransition.prototype.m_clipPath=null;DWScrollTransition.prototype.start=function(callback){this.m_clipPath=this.m_object.getAdapter().getTransitionClipPath(this.m_imageGroup);DWTransition.prototype.start.call(this,callback);};DWScrollTransition.prototype.updateTransition=function(pos){if(this.m_reverse){pos=1-pos;}if(this.m_blocks.length==1){var width=this.m_object.getWidth();var height=this.m_object.getHeight();var b=this.m_blocks[0];var s=b.m_startTime/0x64;var e=b.m_endTime/0x64;var p=(pos-s)/(e-s);if(p<0)p=0;if(p>1)p=1;var x1=b.m_x1s+((b.m_x1-b.m_x1s)*p);var y1=b.m_y1s+((b.m_y1-b.m_y1s)*p);var x2=b.m_x2s+((b.m_x2-b.m_x2s)*p);var y2=b.m_y2s+((b.m_y2-b.m_y2s)*p);x1=(x1*width)/0x3e8;y1=(y1*height)/0x3e8;x2=(x2*width)/0x3e8;y2=(y2*height)/0x3e8;var zoomX=(x2-x1)/width;var zoomY=(y2-y1)/height;var translateX=x1+(((x2-x1)-width)/2);var translateY=y1+(((y2-y1)-height)/2);var a=b.m_startAlpha+((b.m_endAlpha-b.m_startAlpha)*p);if(this.m_imageGroup){DWSVGHelper.setTransform(this.m_imageGroup,new DWPoint(translateX,translateY),new DWPoint(zoomX,zoomY));DWSVGHelper.setAlpha(this.m_imageGroup,a);}else{this.m_object.setScale(zoomX,zoomY);this.m_object.setTranslate(translateX,translateY);this.m_object.setAlpha(a);}var l=(-translateX)-(width/2);var r=l+width;var t=(-translateY)-(height/2);var b=t+height;var d="M "+l+" "+t;d+=(((" L "+r)+" ")+t);d+=(((" L "+r)+" ")+b);d+=(((" L "+l)+" ")+b);d+="Z";this.m_clipPath.setAttribute("d",d);}if(((!this.m_reverse)&&(pos>=1))||(this.m_reverse&&(pos<=0))){this.m_object.getAdapter().removeTransitionClipPath(this.m_imageGroup);this.m_clipPath=null;}};DWScrollTransitionBlock=function(){};DWScrollTransitionBlock.prototype.m_x1=null;DWScrollTransitionBlock.prototype.m_y1=null;DWScrollTransitionBlock.prototype.m_x2=null;DWScrollTransitionBlock.prototype.m_y2=null;DWScrollTransitionBlock.prototype.m_x1s=null;DWScrollTransitionBlock.prototype.m_y1s=null;DWScrollTransitionBlock.prototype.m_x2s=null;DWScrollTransitionBlock.prototype.m_y2s=null;DWScrollTransitionBlock.prototype.m_startTime=null;DWScrollTransitionBlock.prototype.m_endTime=null;DWScrollTransitionBlock.prototype.m_startAlpha=null;DWScrollTransitionBlock.prototype.m_endAlpha=null;DWScrollbar=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWScrollbar,DWGraphicalObject);DWScrollbar.prototype.type=function(){return "Scrollbar";};DWScrollbar.prototype.m_thumb=null;DWScrollbar.prototype.m_thumbArea=null;DWScrollbar.prototype.m_vertical=true;DWScrollbar.prototype.setVertical=function(vertical){this.m_vertical=vertical;return this;};DWScrollbar.prototype.isVertical=function(){return this.m_vertical;};DWScrollbar.prototype.setCodes=function(upCode,downCode,thumb){this.m_thumbArea=new DWRect(0,0,this.getWidth(),this.getHeight());this.m_thumb=this.findChildByCode(thumb);var upButton=this.findChildByCode(upCode);if(upButton){if(this.m_vertical){this.m_thumbArea.moveTopEdge(upButton.getHeight());}else{this.m_thumbArea.moveLeftEdge(upButton.getWidth());}}var downButton=this.findChildByCode(downCode);if(downButton){if(this.m_vertical){this.m_thumbArea.moveBottomEdge(-downButton.getHeight());}else{this.m_thumbArea.moveRightEdge(-downButton.getWidth());}}return this;};DWScrollbar.prototype.m_registeredCallback=false;DWScrollbar.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);if(!this.m_registeredCallback){var parent=this.getParent();parent.registerScrollCallback(this.onParentScroll.bind(this));}};DWScrollbar.prototype.onParentScroll=function(){this.updateScrollThumb();};DWScrollbar.prototype.updateScrollThumb=function(){if(this.m_thumb){var scrollRange=this.getParent().getScrollRange();var scrollPos=this.getParent().getScrollPosition();var scrollPage=this.getParent().getScrollPage();if(this.m_vertical){var thumbScale=1;var thumbHeight=this.m_thumb.getHeight()*thumbScale;var pos=(scrollPos.y/scrollRange.y)*(this.m_thumbArea.height-thumbHeight);this.m_thumb.setTranslate(0,pos);this.m_thumb.setScale(1,thumbScale);}else{var thumbScale=1;var thumbWidth=this.m_thumb.getWidth()*thumbScale;var pos=(scrollPos.x/scrollRange.x)*(this.m_thumbArea.width-thumbWidth);this.m_thumb.setTranslate(pos,0);this.m_thumb.setScale(thumbScale,1);}}};DWScrollbar.prototype.m_dragging=false;DWScrollbar.prototype.m_dragStart=null;DWScrollbar.prototype.m_dragStartTranslate=null;DWScrollbar.prototype.onMouseDown=function(e){DWGraphicalObject.prototype.onMouseDown.call(this,e);if(this.m_thumb){var pt=this.pointFromPage(new DWPoint(e.clientX,e.clientY));var parent=this.getParent();var thumbPos=this.pointFromPage(this.m_thumb.getTransformedBoundingRect().centre());if(this.m_vertical){if((pt.y>=(thumbPos.y-(this.m_thumb.getHeight()/2)))&&(pt.y<(thumbPos.y+(this.m_thumb.getHeight()/2)))){this.m_dragging=true;this.m_dragStart=pt;this.m_dragStartTranslate=this.m_thumb.getTranslate();this.setCapture();e.preventDefault();}else{if(pt.y<thumbPos.y){parent.scrollAction(0x1fa,true);}else{if(pt.y>thumbPos.y){parent.scrollAction(0x1fb,true);}}}}else{if((pt.x>=(thumbPos.x-(this.m_thumb.getWidth()/2)))&&(pt.x<(thumbPos.x+(this.m_thumb.getWidth()/2)))){this.m_dragging=true;this.m_dragStart=pt;this.m_dragStartTranslate=this.m_thumb.getTranslate();this.setCapture();e.preventDefault();}else{if(pt.x<thumbPos.x){parent.scrollAction(0x1fa,false);}else{if(pt.x>thumbPos.x){parent.scrollAction(0x1fb,false);}}}}}};DWScrollbar.prototype.onMouseMove=function(e){DWGraphicalObject.prototype.onMouseMove.call(this,e);if(this.m_dragging){var pt=this.pointFromPage(new DWPoint(e.clientX,e.clientY));var scrollRange=this.getParent().getScrollRange();var scrollPos=this.getParent().getScrollPosition();var scrollPage=this.getParent().getScrollPage();if(this.m_vertical){this.m_thumb.setTranslate(this.m_dragStartTranslate.x,(this.m_dragStartTranslate.y+pt.y)-this.m_dragStart.y);var pos=(((this.m_dragStartTranslate.y+pt.y)-this.m_dragStart.y)*scrollRange.y)/(this.m_thumbArea.height-this.m_thumb.getHeight());this.getParent().setScrollPosition(scrollPos.x,pos);}else{this.m_thumb.setTranslate((this.m_dragStartTranslate.x+pt.x)-this.m_dragStart.x,this.m_dragStartTranslate.y);var pos=(((this.m_dragStartTranslate.x+pt.x)-this.m_dragStart.x)*scrollRange.x)/(this.m_thumbArea.width-this.m_thumb.getWidth());this.getParent().setScrollPosition(pos,scrollPos.y);}e.preventDefault();}};DWScrollbar.prototype.onMouseUp=function(e){if(this.m_dragging){this.releaseCapture();this.m_dragging=false;}DWGraphicalObject.prototype.onMouseUp.call(this,e);};DWSetVariableAction=function(name,index,value,type){this.m_name=name;this.m_index=index;this.m_value=value;this.m_type=type;};__inherit(DWSetVariableAction,DWAction);DWSetVariableAction.prototype.m_name=null;DWSetVariableAction.prototype.m_index=null;DWSetVariableAction.prototype.m_value=null;DWSetVariableAction.prototype.m_type=null;DWSetVariableAction.prototype.Go=function(callback){var value=this.m_value;var append=this.m_type&4;var type=this.m_type&3;if(type==1){value=DWVariables.instance().getValue(this.m_value);}else{if(type==2){var fn=this.m_value;value=fn();}}if(append){value=DWVariables.instance().getValue(this.m_name)+value;}if(this.m_index!=(-1)){DWVariables.instance().setArrayValue(this.m_name,this.m_index,value);}else{DWVariables.instance().setValue(this.m_name,value);}return 0;};DWShadowElement=function(direction,width,blur,colour){this.m_direction=direction;this.m_width=width;this.m_blur=blur;this.m_colour=colour;};DWShadowElement.prototype.m_direction=null;DWShadowElement.prototype.m_width=null;DWShadowElement.prototype.m_blur=null;DWShadowElement.prototype.m_colour=null;DWShadowElement.prototype.apply=function(object){var x=this.m_width;var y=this.m_width;switch(this.m_direction){case 0:case 0:x=-x;break;case 0:case 0:y=-y;break;}object.getAdapter().setShadow(x,y,this.m_blur,this.m_colour);};DWShapeTransition=function(time,reverse){DWTransition.call(this,time);this.m_reverse=reverse;};__inherit(DWShapeTransition,DWTransition);DWShapeTransition.prototype.m_reverse=null;DWShapeTransition.prototype.m_blocks=null;DWShapeTransition.prototype.addBlock=function(x1,y1,x2,y2,type,ratio,points,rotation,borderWidth,borderColour,startTime,endTime){var n=new DWShapeTransitionBlock();n.m_x1=x1;n.m_y1=y1;n.m_x2=x2;n.m_y2=y2;n.m_type=type;n.m_ratio=ratio;n.m_points=points;n.m_rotation=rotation;n.m_borderWidth=borderWidth;n.m_borderColour=borderColour;n.m_startTime=startTime;n.m_endTime=endTime;if(!this.m_blocks){this.m_blocks=new Array();}this.m_blocks.push(n);return this;};DWShapeTransition.prototype.createInstance=function(object){var n=new DWShapeTransition(this.m_time,this.m_reverse);n.m_blocks=this.m_blocks;n.m_object=object;return n;};DWShapeTransition.prototype.m_mask=null;DWShapeTransition.prototype.m_clipRects=null;DWShapeTransition.prototype.m_singleClip=null;DWShapeTransition.prototype.start=function(callback){this.m_mask=this.m_object.getAdapter().getTransitionMask(this.m_imageGroup);if(this.m_mask){if(this.m_reverse){var rect=document.createElementNS("http://www.w3.org/2000/svg","rect");rect.setAttribute("fill","#ffffff");DWSVGHelper.setRect(rect,new DWRect((-this.m_object.getWidth())/2,(-this.m_object.getHeight())/2,this.m_object.getWidth(),this.m_object.getHeight()));this.m_mask.appendChild(rect);}this.m_clipRects=new Array();}else{this.m_singleClip=this.m_object.getAdapter().getTransitionClipPath(this.m_imageGroup);}DWTransition.prototype.start.call(this,callback);};DWShapeTransition.prototype.updateTransition=function(pos){for(var i=0;i<this.m_blocks.length;i++){var b=this.m_blocks[i];var s=b.m_startTime/0x64;var e=b.m_endTime/0x64;var p=(pos-s)/(e-s);if(p<0)p=0;if(p>1)p=1;switch(b.m_type){case 0:this.drawCircle(i,p);break;case 1:this.drawPolygon(i,p);break;case 2:this.drawStar(i,p);break;}}if(pos>=1){if(this.m_mask){this.m_object.getAdapter().removeTransitionMask(this.m_imageGroup);this.m_mask=null;this.m_clipRects=null;}else{if(this.m_singleClip){this.m_object.getAdapter().removeTransitionClipPath(this.m_imageGroup);this.m_singleClip=null;}}}};DWShapeTransition.prototype.drawCircle=function(block,pos){var b=this.m_blocks[block];var w=this.m_object.getWidth();var h=this.m_object.getHeight();var x1=((b.m_x1/0x3e8)*w)-(w/2);var y1=((b.m_y1/0x3e8)*h)-(h/2);var x2=((b.m_x2/0x3e8)*w)-(w/2);var y2=((b.m_y2/0x3e8)*h)-(h/2);if((this.m_clipRects[block]==null)||(this.m_clipRects[block]==undefined)){var rect=document.createElementNS("http://www.w3.org/2000/svg","ellipse");this.m_clipRects[block]=rect;this.m_mask.appendChild(rect);this.m_clipRects[block].setAttribute("fill",(this.m_reverse?"#000000":"#ffffff"));}this.m_clipRects[block].setAttribute("cx",String(x1+((x2-x1)/2)));this.m_clipRects[block].setAttribute("cy",String(y1+((y2-y1)/2)));var r=0.5*Math.sqrt(((w*w)+(h*h)));r*=pos;this.m_clipRects[block].setAttribute("rx",String(r));this.m_clipRects[block].setAttribute("ry",String(r));};DWShapeTransition.prototype.drawPolygon=function(block,pos){var b=this.m_blocks[block];var w=this.m_object.getWidth();var h=this.m_object.getHeight();var x1=((b.m_x1/0x3e8)*w)-(w/2);var y1=((b.m_y1/0x3e8)*h)-(h/2);var x2=((b.m_x2/0x3e8)*w)-(w/2);var y2=((b.m_y2/0x3e8)*h)-(h/2);w=x2-x1;h=y2-y1;if(this.m_singleClip==null){if((this.m_clipRects[block]==null)||(this.m_clipRects[block]==undefined)){var rect=document.createElementNS("http://www.w3.org/2000/svg","path");this.m_clipRects[block]=rect;this.m_mask.appendChild(rect);this.m_clipRects[block].setAttribute("fill",(this.m_reverse?"#000000":"#ffffff"));}}var fRadius=0.5*Math.sqrt(((w*w)+(h*h)));fRadius*=pos;var fArc=Math.PI/b.m_points;var fArc2=2*fArc;var angle=b.m_rotation*pos;var outer_radius=fRadius/Math.cos(fArc);var centre_x=(x1+x2)*0.5;var centre_y=(y1+y2)*0.5;var radian_angle=(((-0x5a)+angle)*Math.PI)/0xb4;if(b.m_ratio<0)radian_angle+=fArc;var d="";for(var i=0;i<b.m_points;i++){var x=centre_x+(outer_radius*Math.cos(radian_angle));var y=centre_y+(outer_radius*Math.sin(radian_angle));radian_angle+=fArc2;if(i==0){d+="M ";}else{d+=" L ";}d+=((String(x)+" ")+String(y));}if(this.m_singleClip){var od=this.m_singleClip.getAttribute("d");if(od){d=od+" "+d;}this.m_singleClip.setAttribute("d",d);}else{this.m_clipRects[block].setAttribute("d",d);}};DWShapeTransition.prototype.drawStar=function(block,pos){var b=this.m_blocks[block];var w=this.m_object.getWidth();var h=this.m_object.getHeight();var x1=((b.m_x1/0x3e8)*w)-(w/2);var y1=((b.m_y1/0x3e8)*h)-(h/2);var x2=((b.m_x2/0x3e8)*w)-(w/2);var y2=((b.m_y2/0x3e8)*h)-(h/2);w=x2-x1;h=y2-y1;if((this.m_clipRects[block]==null)||(this.m_clipRects[block]==undefined)){var rect=document.createElementNS("http://www.w3.org/2000/svg","path");this.m_clipRects[block]=rect;this.m_mask.appendChild(rect);this.m_clipRects[block].setAttribute("fill",(this.m_reverse?"#000000":"#ffffff"));}var fRadius=0.5*Math.sqrt(((w*w)+(h*h)));fRadius*=pos;var fArc=Math.PI/b.m_points;var outer_radius=fRadius*(1+(Math.abs(b.m_ratio)*0.00390625));var centre_x=(x1+x2)*0.5;var centre_y=(y1+y2)*0.5;var angle=b.m_rotation*pos;var radian_angle=(((-0x5a)+angle)*Math.PI)/0xb4;if(b.m_ratio<0)radian_angle+=fArc;var d="";for(var i=0;i<b.m_points;i++){var x=centre_x+(outer_radius*Math.cos(radian_angle));var y=centre_y+(outer_radius*Math.sin(radian_angle));radian_angle+=fArc;if(i==0){d+="M ";}else{d+=" L ";}d+=((String(x)+" ")+String(y));x=centre_x+(fRadius*Math.cos(radian_angle));y=centre_y+(fRadius*Math.sin(radian_angle));d+=(((" L "+String(x))+" ")+String(y));radian_angle+=fArc;}this.m_clipRects[block].setAttribute("d",d);};DWShapeTransitionBlock=function(){};DWShapeTransitionBlock.prototype.m_x1=null;DWShapeTransitionBlock.prototype.m_y1=null;DWShapeTransitionBlock.prototype.m_x2=null;DWShapeTransitionBlock.prototype.m_y2=null;DWShapeTransitionBlock.prototype.m_type=null;DWShapeTransitionBlock.prototype.m_ratio=null;DWShapeTransitionBlock.prototype.m_points=null;DWShapeTransitionBlock.prototype.m_rotation=null;DWShapeTransitionBlock.prototype.m_borderWidth=null;DWShapeTransitionBlock.prototype.m_borderColour=null;DWShapeTransitionBlock.prototype.m_startTime=null;DWShapeTransitionBlock.prototype.m_endTime=null;DWShuffleAction=function(){this.m_objects=arguments;};__inherit(DWShuffleAction,DWAction);DWShuffleAction.prototype.m_objects=null;DWShuffleAction.prototype.Go=function(callback){var numChildren=this.m_objects.length;var positions=new Array();for(var i=0;i<numChildren;i++){positions[i]=this.m_objects[i].getParentOffset().add(this.m_objects[i].getTranslate());}var arrayOfIndexes=new Array(numChildren);arrayOfIndexes[0]=-1;for(var j=0;j<numChildren;j++){var numberTaken=true;while(numberTaken==true){var rand=Math.round(Math.random()*(numChildren-1));numberTaken=false;for(var k=0;k<numChildren;k++){if(arrayOfIndexes[k]==rand){numberTaken=true;}}if(numberTaken==false){arrayOfIndexes[j]=rand;}}}for(var m=0;m<numChildren;m++){var pt=positions[arrayOfIndexes[m]];pt=pt.subtract(this.m_objects[m].getParentOffset());this.m_objects[m].setTranslate(pt.x,pt.y);}return 0;};DWSimpleAction=function(fn){this.m_function=fn;};__inherit(DWSimpleAction,DWAction);DWSimpleAction.prototype.m_function=null;DWSimpleAction.prototype.m_running=false;DWSimpleAction.prototype.m_callback=null;DWSimpleAction.prototype.m_inCall=false;DWSimpleAction.prototype.Go=function(callback){if(this.m_running){return 1;}this.m_callback=callback;this.m_running=true;this.m_inCall=true;var r=this.m_function(this);this.m_inCall=false;if((r==1)&&(this.m_running==true)){return 1;}this.m_running=false;return 0;};DWSimpleAction.prototype.Notify=function(status){if(status==0){this.m_running=false;}if((!this.m_inCall)&&this.m_callback){this.m_callback.Notify(status);}};DWSimpleTrigger=function(trigger){this.m_trigger=trigger;};__inherit(DWSimpleTrigger,DWTrigger);DWSimpleTrigger.prototype.m_trigger=null;DWSimpleTrigger.prototype.match=function(other){if(other.type()=="DWSimpleTrigger"){if(other.m_trigger==this.m_trigger){return true;}}return false;};DWSimpleTrigger.prototype.type=function(){return "DWSimpleTrigger";};DWSlaveMouseEvent=function(e){this.m_slave=e;DWMouseEvent.call(this,e.pageX,e.pageY);};__inherit(DWSlaveMouseEvent,DWMouseEvent);DWSlaveMouseEvent.prototype.m_slave=null;DWSlaveMouseEvent.prototype.stopPropagation=function(){this.m_slave.stopPropagation();DWMouseEvent.prototype.stopPropagation.call(this);};DWSlaveMouseEvent.prototype.preventDefault=function(){this.m_slave.preventDefault();DWMouseEvent.prototype.preventDefault.call(this);};DWSlideshow=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);this.m_slides=new Array();};__inherit(DWSlideshow,DWGraphicalObject);DWSlideshow.prototype.m_autoStart=false;DWSlideshow.prototype.m_repeat=0;DWSlideshow.prototype.type=function(){return "Slideshow";};DWSlideshow.prototype.m_slides=null;DWSlideshow.prototype.addSlide=function(slide,time,transition){this.m_slides.push(new DWSlideshowEntry(slide,time,transition));return this;};DWSlideshow.prototype.setAutoStart=function(val){this.m_autoStart=val;return this;};DWSlideshow.prototype.setRepeat=function(val){this.m_repeat=val;return this;};DWSlideshow.prototype.m_currentSlide=0;DWSlideshow.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);this.m_currentSlide=0;if(this.m_slides&&(this.m_slides.length>0)){this.getAdapter().setImage(this.m_slides[0].m_image);}this.preloadSlides();if(parentVisible&&this.m_autoStart){this.play();}};DWSlideshow.prototype.stopObject=function(){if(this.m_playing){this.stop();}DWGraphicalObject.prototype.stopObject.call(this);};DWSlideshow.prototype.m_playing=false;DWSlideshow.prototype.play=function(){if(!this.m_playing){this.m_playing=true;this.m_nextFrameTime=-1;DWUpdateController.addUpdate(this);}};DWSlideshow.prototype.stop=function(){if(this.m_playing){this.m_playing=false;DWUpdateController.removeUpdate(this);}};DWSlideshow.prototype.m_waitingTransition=false;DWSlideshow.prototype.showSlide=function(slide){if((slide>=0)&&(slide<this.m_slides.length)){if(this.m_slides[slide].m_transition){this.getAdapter().saveImageGroup();this.getAdapter().setImage(this.m_slides[slide].m_image);var transition=this.m_slides[slide].m_transition.createInstance(this);transition.setImageGroup(this.getAdapter().getImageGroup());this.m_waitingTransition=true;transition.start(this.onTransitionFinished.bind(this));}else{this.getAdapter().setImage(this.m_slides[slide].m_image);}}};DWSlideshow.prototype.m_donePreload=false;DWSlideshow.prototype.preloadSlides=function(){if(!this.m_donePreload){for(var slide=1;slide<this.m_slides.length;slide++){if(this.m_slides[slide].m_image){if(this.m_slides[slide].m_image.type()=="DWBitmapImage"){if(this.m_svgGroup){var rect=document.createElementNS("http://www.w3.org/2000/svg","image");rect.setAttributeNS("http://www.w3.org/1999/xlink","href",this.m_slides[slide].m_image.m_url);this.m_svgGroup.appendChild(rect);rect.setAttribute("opacity","0");}}}}this.m_donePreload=true;}};DWSlideshow.prototype.onTransitionFinished=function(){this.getAdapter().removeSavedImageGroup();this.m_waitingTransition=false;};DWSlideshow.prototype.m_nextFrameTime=-1;DWSlideshow.prototype.update=function(time){if(this.m_playing){if(this.m_nextFrameTime==(-1)){this.m_nextFrameTime=time+this.m_slides[this.m_currentSlide].m_time;}if((time>=this.m_nextFrameTime)&&(!this.m_waitingTransition)){if(this.m_currentSlide==(this.m_slides.length-1)){if((this.m_repeat==(-1))||(this.m_repeat>0)){this.m_currentSlide=0;this.showSlide(this.m_currentSlide);if(this.m_repeat!=(-1))this.m_repeat--;}else{this.stop();}}else{this.m_currentSlide++;this.showSlide(this.m_currentSlide);}if(this.m_playing){this.m_nextFrameTime=time+this.m_slides[this.m_currentSlide].m_time;}}}};DWSlideshow.prototype.Play=function(){this.PlayFrom(0);};DWSlideshow.prototype.PlayFrom=function(slide){this.GotoSlide(slide);this.play();};DWSlideshow.prototype.Stop=function(){this.stop();};DWSlideshow.prototype.Pause=function(){this.stop();};DWSlideshow.prototype.Continue=function(){this.play();};DWSlideshow.prototype.IsPlaying=function(){return this.m_playing;};DWSlideshow.prototype.GotoSlide=function(slide){if((slide>=0)&&(slide<this.m_slides.length)){this.m_currentSlide=slide;this.showSlide(this.m_currentSlide);this.m_nextFrameTime=-1;}};DWSlideshow.prototype.GotoEnd=function(){this.GotoSlide(this.m_slides.length-1);};DWSlideshow.prototype.GetSlideCount=function(){return this.m_slides.length;};DWSlideshow.prototype.Forward=function(){this.GotoSlide(this.m_currentSlide+1);};DWSlideshow.prototype.Backward=function(){this.GotoSlide(this.m_currentSlide-1);};DWSlideshowEntry=function(image,time,transition){this.m_image=image;this.m_time=time;this.m_transition=transition;};DWSlideshowEntry.prototype.m_image=null;DWSlideshowEntry.prototype.m_time=null;DWSlideshowEntry.prototype.m_transition=null;DWSolidBrush=function(clr){this.m_colour=clr;};DWSolidBrush.prototype.m_colour=null;DWSolidBrush.prototype.createCopy=function(){var copy=new DWSolidBrush(this.m_colour);return copy;};DWSolidBrush.prototype.apply=function(ctx){ctx.fillStyle=this.m_colour.toString();ctx.fill();};DWSolidBrush.prototype.applySVG=function(obj){var clr=this.m_colour.toString();obj.setAttribute("fill",clr);};DWSolidBrush.prototype.removeSVG=function(obj){obj.setAttribute("fill","none");};DWSolidBrush.prototype.applyCanvas=function(ctx){ctx.fillStyle=this.m_colour.toString();};DWSolidBrush.prototype.type=function(){return "Solid";};DWSolidBrush.prototype.morph=function(b1,b2,pos){if((b1.type()!=this.type())||(b2.type()!=this.type())){return;}var s1=b1;var s2=b2;var c=DWColour.morph(s1.m_colour,s2.m_colour,pos);this.m_colour=c;};DWText=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);this.m_textGroup=document.getElementById(elementId+"_txt");};__inherit(DWText,DWGraphicalObject);DWText.prototype.m_textGroup=null;DWText.prototype.type=function(){return "Text";};DWText.prototype.m_linePositions=null;DWText.prototype.m_paragraphPositions=null;DWText.prototype.setLinePositions=function(positions){this.m_linePositions=positions;return this;};DWText.prototype.setParagraphPositions=function(positions){this.m_paragraphPositions=positions;return this;};DWText.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);if(this.m_variables){for(var i=0;i<this.m_variables.length;i++){this.m_variables[i].start();}}if(this.m_expressions){for(var i=0;i<this.m_expressions.length;i++){this.m_expressions[i].start();}}};DWText.prototype.stopObject=function(){DWGraphicalObject.prototype.stopObject.call(this);if(this.m_variables){for(var i=0;i<this.m_variables.length;i++){this.m_variables[i].stop();}}if(this.m_expressions){for(var i=0;i<this.m_expressions.length;i++){this.m_expressions[i].stop();}}};DWText.prototype.m_variables=null;DWText.prototype.addVariable=function(variable){if(this.m_variables==null){this.m_variables=new Array();}this.m_variables.push(variable);};DWText.prototype.m_expressions=null;DWText.prototype.addExpression=function(expression){if(this.m_expressions==null){this.m_expressions=new Array();}this.m_expressions.push(expression);};DWText.prototype.getScrollableContent=function(scrollRange){scrollRange.x=0;scrollRange.y=0;if(this.m_textGroup){if(this.m_linePositions){scrollRange.y=this.m_linePositions[this.m_linePositions.length-1]-this.getHeight();}}return this.m_textGroup;};DWText.prototype.GetSelectionText=function(){if(this.m_textGroup){return this.m_textGroup.textContent;}return this.m_element.textContent;};DWText.prototype.SetSelection=function(start,end){};DWText.prototype.ReplaceSelection=function(value){if(this.m_element!=null){if(value==undefined){value="";}value=String(value);while(value.indexOf("<",0)!=(-1)){value=value.replace("<","&lt");}while(value.indexOf(">",0)!=(-1)){value=value.replace(">","&gt");}this.m_element.innerHTML=value;}};DWTextInput=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);for(var i=0;i<this.m_element.childNodes.length;i++){if((this.m_element.childNodes[i].tagName=="div")||(this.m_element.childNodes[i].tagName=="DIV")){var div=this.m_element.childNodes[i];for(var j=0;j<div.childNodes.length;j++){if((div.childNodes[j].tagName=="input")||(div.childNodes[j].tagName=="INPUT")){this.m_inputElement=div.childNodes[j];break;}if((div.childNodes[j].tagName=="textarea")||(div.childNodes[j].tagName=="TEXTAREA")){this.m_inputElement=div.childNodes[j];this.m_multiLine=true;break;}}}}if(this.m_inputElement){this.m_inputElement.addEventListener("change",this.onChange.bind(this),true);this.m_inputElement.addEventListener("input",this.onInput.bind(this),true);this.m_inputElement.addEventListener("keydown",this.onKeyDown.bind(this),true);this.m_inputElement.addEventListener("keypress",this.onKeyPress.bind(this),true);}};__inherit(DWTextInput,DWGraphicalObject);DWTextInput.prototype.m_inputElement=null;DWTextInput.prototype.m_variable=null;DWTextInput.prototype.m_variableIndex=-1;DWTextInput.prototype.m_questionAnswer=-1;DWTextInput.prototype.m_updateOnEachKey=false;DWTextInput.prototype.m_tabSkipsToNext=true;DWTextInput.prototype.m_enterSkipsToNext=true;DWTextInput.prototype.m_autoFocus=false;DWTextInput.prototype.m_multiLine=false;DWTextInput.prototype.m_allowNumbers=true;DWTextInput.prototype.m_allowLetters=true;DWTextInput.prototype.m_allowOtherChars=true;DWTextInput.prototype.m_forceUpper=false;DWTextInput.prototype.m_forceLower=false;DWTextInput.prototype.m_maxLength=-1;DWTextInput.prototype.type=function(){return "TextInput";};DWTextInput.prototype.setVariable=function(variable,updateOnEachKey,arrayIndex){if(arrayIndex==undefined)arrayIndex=-1;this.m_variable=variable;this.m_updateOnEachKey=updateOnEachKey;this.m_variableIndex=arrayIndex;return this;};DWTextInput.prototype.setFlags=function(tabSkipsToNext,enterSkipsToNext,autoFocus,allowNumbers,allowLetters,allowOtherChars,forceUpper,forceLower){this.m_tabSkipsToNext=tabSkipsToNext;this.m_enterSkipsToNext=enterSkipsToNext;this.m_autoFocus=autoFocus;this.m_allowNumbers=allowNumbers;this.m_allowLetters=allowLetters;this.m_allowOtherChars=allowOtherChars;this.m_forceUpper=forceUpper;this.m_forceLower=forceLower;return this;};DWTextInput.prototype.setMaxLength=function(maxLength){this.m_maxLength=maxLength;return this;};DWTextInput.prototype.setQuestionAnswer=function(answer){this.m_questionAnswer=answer;return this;};DWTextInput.prototype.getQuestionAnswer=function(){return this.m_questionAnswer;};DWTextInput.prototype.enable=function(){DWGraphicalObject.prototype.enable.call(this);this.m_inputElement.removeAttribute("disabled");};DWTextInput.prototype.disable=function(){DWGraphicalObject.prototype.disable.call(this);this.m_inputElement.setAttribute("disabled","1");};DWTextInput.prototype.variableChanged=function(name){if(name==this.m_variable){this.updateFromVariable();}};DWTextInput.prototype.getText=function(){return this.m_inputElement.value;};DWTextInput.prototype.setText=function(text){this.m_inputElement.value=text;};DWTextInput.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);this.m_inputElement.value="";if(this.m_variable){DWVariables.instance().registerCallback(this.m_variable,this);this.updateFromVariable();}if(this.m_autoFocus){this.m_inputElement.focus();}if(!this.m_enabled){this.m_inputElement.setAttribute("disabled","1");}};DWTextInput.prototype.stopObject=function(){DWGraphicalObject.prototype.stopObject.call(this);if(this.m_variable){DWVariables.instance().unregisterCallback(this.m_variable,this);}};DWTextInput.prototype.updateVariable=function(){var value=this.m_inputElement.value;if(this.m_forceUpper){value=value.toUpperCase();}else{if(this.m_forceLower){value=value.toLowerCase();}}if(this.m_variableIndex==(-1)){DWVariables.instance().setValue(this.m_variable,value);}else{DWVariables.instance().setArrayValue(this.m_variable,this.m_variableIndex,value);}};DWTextInput.prototype.updateFromVariable=function(){var val=(this.m_variableIndex==(-1)?DWVariables.instance().getValue(this.m_variable):DWVariables.instance().getArrayValue(this.m_variable,this.m_variableIndex));if(val!=this.m_inputElement.value){if(val==undefined){val="";}this.m_inputElement.value=val;}};DWTextInput.prototype.onChange=function(ev){if(this.m_variable&&(!this.m_updateOnEachKey)){this.updateVariable();}};DWTextInput.prototype.onInput=function(ev){if(this.m_variable&&this.m_updateOnEachKey){this.updateVariable();}};DWTextInput.prototype.onKeyDown=function(ev){if(((ev.keyCode==13)&&(!this.m_multiLine))||(ev.keyCode==9)){if(this.m_variable&&(!this.m_updateOnEachKey)){this.updateVariable();}ev.preventDefault();ev.stopPropagation();if((this.m_tabSkipsToNext&&(ev.keyCode==9))||(this.m_enterSkipsToNext&&(ev.keyCode==13))){var objs=this.getPage().getChildrenRecurse();for(var i=0;i<objs.length;i++){if(objs[i]==this){var j=i+1;while(j!=i){if(j>=objs.length)j=0;if((objs[j].type()=="TextInput")&&objs[j].isObjectEnabled()){var ti=objs[j];ti.m_inputElement.focus();break;}j++;}break;}}}}};DWTextInput.prototype.onKeyPress=function(ev){if(ev.charCode==0){return;}if((ev.charCode>=0x30)&&(ev.charCode<=0x39)){if(!this.m_allowNumbers){ev.stopPropagation();ev.preventDefault();}}else{if(((ev.charCode>=0x61)&&(ev.charCode<=0x7a))||((ev.charCode>=0x41)&&(ev.charCode<=0x5a))){if(!this.m_allowLetters){ev.stopPropagation();ev.preventDefault();}}else{if(!this.m_allowOtherChars){ev.stopPropagation();ev.preventDefault();}}}if(this.m_maxLength!=(-1)){if(this.m_inputElement.value.length>=this.m_maxLength){ev.stopPropagation();ev.preventDefault();}}};DWTickerTrigger=function(delay){this.m_delay=delay;};__inherit(DWTickerTrigger,DWTrigger);DWTickerTrigger.prototype.m_delay=null;DWTickerTrigger.prototype.match=function(other){if(other==this){return true;}return false;};DWTickerTrigger.prototype.type=function(){return "DWTickerTrigger";};DWTickerTrigger.prototype.m_host=null;DWTickerTrigger.prototype.initEvents=function(host){this.m_host=host;DWUpdateController.addUpdate(this);};DWTickerTrigger.prototype.closeEvents=function(host){DWUpdateController.removeUpdate(this);this.m_host=null;};DWTickerTrigger.prototype.m_lastTime=-1;DWTickerTrigger.prototype.update=function(time){if(this.m_lastTime==(-1)){this.m_lastTime=time;}if((time-this.m_lastTime)>this.m_delay){this.m_host.triggerEvents(this);this.m_lastTime=time;}};DWTimeline=function(){};__inherit(DWTimeline,DWObject);DWTimeline.prototype.m_autoStart=false;DWTimeline.prototype.m_repeat=0;DWTimeline.prototype.setProperties=function(autoStart,repeat){this.m_autoStart=autoStart;this.m_repeat=repeat;return this;};DWTimeline.prototype.m_tracks=null;DWTimeline.prototype.addTrack=function(track){if(!this.m_tracks){this.m_tracks=new Array();}this.m_tracks.push(track);return this;};DWTimeline.prototype.startObject=function(parentVisible){if(this.m_autoStart&&parentVisible){this.start();}};DWTimeline.prototype.stopObject=function(){this.stop();};DWTimeline.prototype.m_startTime=-1;DWTimeline.prototype.m_playing=false;DWTimeline.prototype.start=function(){if(!this.m_playing){this.m_playing=true;this.m_startTime=new Date().getTime();for(var i=0;i<this.m_tracks.length;i++){this.m_tracks[i].start();}DWUpdateController.addUpdate(this);}};DWTimeline.prototype.stop=function(){if(this.m_playing){this.m_playing=false;for(var i=0;i<this.m_tracks.length;i++){this.m_tracks[i].stop();}DWUpdateController.removeUpdate(this);}};DWTimeline.prototype.update=function(time){if(this.m_tracks){var finished=true;for(var i=0;i<this.m_tracks.length;i++){this.m_tracks[i].update(time);if(!this.m_tracks[i].isFinished()){finished=false;}}if(finished){this.stop();if((this.m_repeat==(-1))||(this.m_repeat>0)){this.start();if(this.m_repeat!=(-1)){this.m_repeat--;}}}}};DWTimelineTrack=function(){this.m_entries=new Array();for(var i=0;i<arguments.length;i+=2){var e=new DWTimelineTrackEntry();e.m_time=arguments[i];e.m_action=arguments[i+1];this.m_entries.push(e);}};DWTimelineTrack.prototype.m_entries=null;DWTimelineTrack.prototype.m_startTime=-1;DWTimelineTrack.prototype.m_playing=false;DWTimelineTrack.prototype.start=function(){if(!this.m_playing){this.m_playing=true;this.m_startTime=new Date().getTime();this.m_current=0;}};DWTimelineTrack.prototype.stop=function(){if(this.m_playing){this.m_playing=false;}};DWTimelineTrack.prototype.m_current=0;DWTimelineTrack.prototype.m_waiting=false;DWTimelineTrack.prototype.update=function(time){if((!this.m_waiting)&&(this.m_current<this.m_entries.length)){var t=time-this.m_startTime;while(this.m_current<this.m_entries.length){var i=this.m_current;if(this.m_entries[i].m_time<=t){this.m_current++;var state=this.m_entries[i].m_action.Go(this);if(state==1){this.m_waiting=true;break;}}else{break;}}}};DWTimelineTrack.prototype.Notify=function(state){this.m_waiting=false;};DWTimelineTrack.prototype.isFinished=function(){return (!this.m_entries)||(this.m_current==this.m_entries.length);};DWTimelineTrackEntry=function(){};DWTimelineTrackEntry.prototype.m_time=null;DWTimelineTrackEntry.prototype.m_action=null;DWTransform=function(){};DWTransform.prototype.m_preTranslateX=0;DWTransform.prototype.m_preTranslateY=0;DWTransform.prototype.m_scaleX=1;DWTransform.prototype.m_scaleY=1;DWTransform.prototype.m_rotateZ=0;DWTransform.prototype.m_skewX=0;DWTransform.prototype.m_skewY=0;DWTransform.prototype.m_translateX=0;DWTransform.prototype.m_translateY=0;DWTransform.prototype.m_baseTranslateX=0;DWTransform.prototype.m_baseTranslateY=0;DWTransform.prototype.copyFrom=function(old){this.m_preTranslateX=old.m_preTranslateX;this.m_preTranslateY=old.m_preTranslateY;this.m_scaleX=old.m_scaleX;this.m_scaleY=old.m_scaleY;this.m_rotateZ=old.m_rotateZ;this.m_skewX=old.m_skewX;this.m_skewY=old.m_skewY;this.m_translateX=old.m_translateX;this.m_translateY=old.m_translateY;this.m_baseTranslateX=old.m_baseTranslateX;this.m_baseTranslateY=old.m_baseTranslateY;};DWTransform.prototype.setPreTranslate=function(x,y){this.m_preTranslateX=x;this.m_preTranslateY=y;};DWTransform.prototype.getPreTranslate=function(){var obj=new DWPoint();obj.x=this.m_preTranslateX;obj.y=this.m_preTranslateY;return obj;};DWTransform.prototype.setScale=function(scaleX,scaleY){this.m_scaleX=scaleX;this.m_scaleY=scaleY;};DWTransform.prototype.getScale=function(){var obj=new DWPoint();obj.x=this.m_scaleX;obj.y=this.m_scaleY;return obj;};DWTransform.prototype.setRotate=function(rotate){this.m_rotateZ=rotate;};DWTransform.prototype.getRotate=function(){return this.m_rotateZ;};DWTransform.prototype.setTranslate=function(x,y){this.m_translateX=x;this.m_translateY=y;};DWTransform.prototype.getTranslate=function(){var obj=new DWPoint();obj.x=this.m_translateX;obj.y=this.m_translateY;return obj;};DWTransform.prototype.setBaseTranslate=function(x,y){this.m_baseTranslateX=x;this.m_baseTranslateY=y;};DWTransform.prototype.getBaseTranslate=function(){var obj=new DWPoint();obj.x=this.m_baseTranslateX;obj.y=this.m_baseTranslateY;return obj;};DWTransform.prototype.setSkew=function(x,y){this.m_skewX=x;this.m_skewY=y;};DWTransform.prototype.getSkew=function(){var obj=new DWPoint();obj.x=this.m_skewX;obj.y=this.m_skewY;return obj;};DWTransform.prototype.setTransform=function(translate,scale,rotate){var changed=false;if(this.m_translateX!=translate.x){this.m_translateX=translate.x;changed=true;}if(this.m_translateY!=translate.y){this.m_translateY=translate.y;changed=true;}if(this.m_scaleX!=scale.x){this.m_scaleX=scale.x;changed=true;}if(this.m_scaleY!=scale.y){this.m_scaleY=scale.y;changed=true;}if(this.m_rotateZ!=rotate){this.m_rotateZ=rotate;changed=true;}return changed;};DWTransform.prototype.pointToParent=function(_pt){var pt=new DWPoint(_pt.x,_pt.y);pt.translate(this.m_preTranslateX,this.m_preTranslateY);pt.scale(this.m_scaleX,this.m_scaleY);if(this.m_rotateZ!=0){pt.rotate(this.m_rotateZ);}pt.translate(this.m_translateX+this.m_baseTranslateX,this.m_translateY+this.m_baseTranslateY);return pt;};DWTransform.prototype.rectToParent=function(_r){var pts=new Array();pts[0]=this.pointToParent(_r.topLeft());pts[1]=this.pointToParent(_r.topRight());pts[2]=this.pointToParent(_r.bottomRight());pts[3]=this.pointToParent(_r.bottomLeft());return DWRect.fromPoints(pts);};DWTransform.prototype.pointFromParent=function(_pt){var pt=new DWPoint(_pt.x,_pt.y);pt.translate(-(this.m_translateX+this.m_baseTranslateX),-(this.m_translateY+this.m_baseTranslateY));if(this.m_rotateZ!=0){pt.rotate(-this.m_rotateZ);}pt.scale(1/this.m_scaleX,1/this.m_scaleY);pt.translate(-this.m_preTranslateX,-this.m_preTranslateY);return pt;};DWTransform.prototype.rectFromParent=function(_r){var pts=new Array();pts[0]=this.pointFromParent(_r.topLeft());pts[1]=this.pointFromParent(_r.topRight());pts[2]=this.pointFromParent(_r.bottomRight());pts[3]=this.pointFromParent(_r.bottomLeft());return DWRect.fromPoints(pts);};DWTransform.prototype.applyToCanvas=function(ctx){ctx.translate(this.m_translateX+this.m_baseTranslateX,this.m_translateY+this.m_baseTranslateY);ctx.rotate((this.m_rotateZ*Math.PI)/0xb4);ctx.scale(this.m_scaleX,this.m_scaleY);ctx.translate(this.m_preTranslateX,this.m_preTranslateY);};DWTransparencyElement=function(alpha){this.m_alpha=alpha;};DWTransparencyElement.prototype.m_alpha=null;DWTransparencyElement.prototype.apply=function(object){object.getAdapter().setAlpha(this.m_alpha);};DWTriggerList=function(){this.length=arguments.length;for(var i=0;i<this.length;i++){this[i]=arguments[i];}};DWTriggerList.prototype.initEvents=function(host){for(var i=0;i<this.length;i++){this[i].initEvents(host);}};DWTriggerList.prototype.closeEvents=function(host){for(var i=0;i<this.length;i++){this[i].closeEvents(host);}};DWUpdateController=function(){DWUpdateController.m_instance=this;this.m_list=new DWList();this.m_animationList=new DWList();this.m_requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;};DWUpdateController.m_instance=null;DWUpdateController.instance=function(){if(!DWUpdateController.m_instance){DWUpdateController.m_instance=new DWUpdateController();}return DWUpdateController.m_instance;};DWUpdateController.prototype.m_list=null;DWUpdateController.prototype.m_animationList=null;DWUpdateController.prototype.m_startTime=0;DWUpdateController.prototype.m_requestAnimationFrame=null;DWUpdateController.addUpdate=function(target){var thisObj=DWUpdateController.instance();if(thisObj.m_list.find(target)==null){thisObj.m_list.addTail(target);}};DWUpdateController.addAnimationUpdate=function(target){var thisObj=DWUpdateController.instance();if(thisObj.m_animationList.find(target)==null){thisObj.m_animationList.addTail(target);thisObj.kickAnimationUpdate();}};DWUpdateController.removeUpdate=function(target){var thisObj=DWUpdateController.instance();var it=thisObj.m_list.find(target);if(it!=null){thisObj.m_list.remove(it);}};DWUpdateController.removeAnimationUpdate=function(target){var thisObj=DWUpdateController.instance();var it=thisObj.m_animationList.find(target);if(it!=null){thisObj.m_animationList.remove(it);}};DWUpdateController.prototype.m_oneShotCalls=null;DWUpdateController.addOneShotUpdateCall=function(fn){var thisObj=DWUpdateController.instance();if(!thisObj.m_oneShotCalls){thisObj.m_oneShotCalls=new Array();}thisObj.m_oneShotCalls.push(fn);thisObj.kickAnimationUpdate();};DWUpdateController.start=function(){var thisObj=DWUpdateController.instance();thisObj.m_startTime=new Date().getTime();window.setInterval(thisObj.update.bind(thisObj),0x10);};DWUpdateController.prototype.update=function(){var time=new Date().getTime();var it=this.m_list.getHeadPosition();while(it!=null){var target=this.m_list.getItem(it);target.update(time);it=this.m_list.getNext(it);}if(this.m_requestAnimationFrame==undefined){this.updateAnimation();}return this.m_list.size()>0;};DWUpdateController.prototype.m_animationUpdateSet=false;DWUpdateController.prototype.kickAnimationUpdate=function(){if(this.m_requestAnimationFrame&&(!this.m_animationUpdateSet)){var fn=this.m_requestAnimationFrame;fn(DWUpdateController.callUpdateAnimation);this.m_animationUpdateSet=true;}};DWUpdateController.callUpdateAnimation=function(){var thisObj=DWUpdateController.instance();if(thisObj.updateAnimation()){var fn=thisObj.m_requestAnimationFrame;fn(DWUpdateController.callUpdateAnimation);thisObj.m_animationUpdateSet=true;}else{thisObj.m_animationUpdateSet=false;}};DWUpdateController.prototype.updateAnimation=function(){if(this.m_oneShotCalls){var oneShotCalls=this.m_oneShotCalls;this.m_oneShotCalls=null;for(var i=0;i<oneShotCalls.length;i++){var fn=oneShotCalls[i];try{fn();}catch(err){console.log(err);}}}var time=new Date().getTime();var it=this.m_animationList.getHeadPosition();while(it!=null){var target=this.m_animationList.getItem(it);try{target.update(time);}catch(err){console.log(err);}it=this.m_animationList.getNext(it);}return this.m_animationList.size()>0;};DWVariableChangedTrigger=function(variable){this.m_variable=variable;};__inherit(DWVariableChangedTrigger,DWTrigger);DWVariableChangedTrigger.prototype.m_variable=null;DWVariableChangedTrigger.prototype.match=function(other){if(other==this){return true;}return false;};DWVariableChangedTrigger.prototype.type=function(){return "DWVariableChangedTrigger";};DWVariableChangedTrigger.prototype.m_host=null;DWVariableChangedTrigger.prototype.initEvents=function(host){DWVariables.instance().registerCallback(this.m_variable,this);this.m_host=host;};DWVariableChangedTrigger.prototype.closeEvents=function(host){DWVariables.instance().unregisterCallback(this.m_variable,this);this.m_host=null;};DWVariableChangedTrigger.prototype.variableChanged=function(name){if((name==this.m_variable)&&this.m_host){this.m_host.triggerEvents(this);}};DWVariables=function(){DWVariables.m_instance=this;this.m_persist=new Object();this.m_changedPage=new Object();this.m_changedPublication=new Object();};DWVariables.m_instance=null;DWVariables.prototype.m_persist=null;DWVariables.prototype.m_callbacks=null;DWVariables.prototype.m_changedPage=null;DWVariables.prototype.m_changedPublication=null;DWVariables.prototype.m_publication=null;DWVariables.prototype.m_page=null;DWVariables.prototype.m_initPublicationArgs=null;DWVariables.prototype.m_initPageArgs=null;DWVariables.prototype.m_updateRegistered=false;DWVariables.instance=function(){if(!DWVariables.m_instance){DWVariables.m_instance=new DWVariables();}return DWVariables.m_instance;};DWVariables.prototype.m_sessionStorageEnabled=false;DWVariables.prototype.enableSessionStorage=function(){this.m_sessionStorageEnabled=true;};DWVariables.prototype.getValue=function(name){if(this.m_page){var vars=this.m_page.getVariables();if(vars.hasOwnProperty(name)){return vars[name];}}var vars=this.m_publication.getVariables();if(vars.hasOwnProperty(name)){return vars[name];}return null;};DWVariables.prototype.setValue=function(name,value){var changed=false;var done=false;if(this.m_page){var vars=this.m_page.getVariables();if(vars.hasOwnProperty(name)){if(value!=vars[name]){vars[name]=value;changed=true;this.m_changedPage[name]=true;}done=true;}}if(!done){var vars=this.m_publication.getVariables();if(vars.hasOwnProperty(name)){if(value!=vars[name]){vars[name]=value;changed=true;this.m_changedPublication[name]=true;}done=true;}}if(!done){if(this.m_page){var vars=this.m_page.getVariables();vars[name]=value;changed=true;}}};DWVariables.prototype.getArrayValue=function(name,index){if(this.m_page){var vars=this.m_page.getVariables();if(vars.hasOwnProperty(name)){if(typeof(vars[name])=="object"){return vars[name][index];}}}var vars=this.m_publication.getVariables();if(vars.hasOwnProperty(name)){if(typeof(vars[name])=="object"){return vars[name][index];}}return null;};DWVariables.prototype.setArrayValue=function(name,index,value){var done=false;if(this.m_page){var vars=this.m_page.getVariables();if(vars.hasOwnProperty(name)){if(typeof(vars[name])=="object"){vars[name][index]=value;done=true;}}}if(!done){var vars=this.m_publication.getVariables();if(vars.hasOwnProperty(name)){if(typeof(vars[name])=="object"){vars[name][index]=value;done=true;}}}};DWVariables.prototype.registerCallback=function(name,callback){if(!this.m_callbacks){this.m_callbacks=new Object();}if((!this.m_callbacks.hasOwnProperty(name))||(this.m_callbacks[name]==null)){this.m_callbacks[name]=new Array();}this.m_callbacks[name].push(callback);if(!this.m_updateRegistered){DWUpdateController.addUpdate(this);this.m_updateRegistered=true;}};DWVariables.prototype.unregisterCallback=function(name,callback){if(this.m_callbacks&&this.m_callbacks.hasOwnProperty(name)){var cb=this.m_callbacks[name];var nb=new Array();if(cb!=null){for(var i=0;i<cb.length;i++){if(cb[i]==callback){cb[i]=null;}else{nb.push(cb[i]);}}}if(nb.length){this.m_callbacks[name]=nb;}else{this.m_callbacks[name]=null;}}};DWVariables.prototype.initPublication=function(pub){this.m_publication=pub;this.m_initPublicationArgs=arguments;var vars=this.m_publication.getVariables();for(var i=1;i<arguments.length;i+=2){var name=arguments[i];var value=arguments[i+1];var prop=new Object();prop["set"]=this.setPublicationVariable.bind(this,name);prop["get"]=this.getPublicationVariable.bind(this,name);Object.defineProperty(this.m_publication,name,prop);vars[name]=value;if(this.m_sessionStorageEnabled&&(window.sessionStorage!=undefined)){var s="Publication."+name;if(window.sessionStorage.hasOwnProperty(s)){vars[name]=this.readSessionStorageValue(window.sessionStorage[s]);}}}};DWVariables.prototype.initPage=function(page,variables){this.m_page=page;this.m_initPageArgs=variables;if(variables){var vars=this.m_page.getVariables();for(var i=0;i<variables.length;i+=3){var name=variables[i];var value=variables[i+1];var persist=variables[i+2];if(!this.m_page.hasOwnProperty(name)){var prop=new Object();prop["set"]=this.setPageVariable.bind(this,this.m_page,name);prop["get"]=this.getPageVariable.bind(this,this.m_page,name);Object.defineProperty(this.m_page,name,prop);}this.m_persist[name]=persist;if(!persist){vars[name]=value;}else{if(!vars.hasOwnProperty(name)){vars[name]=value;}}if(this.m_sessionStorageEnabled&&(window.sessionStorage!=undefined)){var s=page.GetName()+"."+name;if(window.sessionStorage.hasOwnProperty(s)){vars[name]=this.readSessionStorageValue(window.sessionStorage[s]);}}}}};DWVariables.prototype.setPageVariable=function(page,name,value){if(page==this.m_page){var vars=this.m_page.getVariables();vars[name]=value;this.m_changedPage[name]=true;}};DWVariables.prototype.getPageVariable=function(page,name){var vars=page.getVariables();return vars[name];};DWVariables.prototype.setPublicationVariable=function(name,value){var vars=this.m_publication.getVariables();vars[name]=value;this.m_changedPublication[name]=true;};DWVariables.prototype.getPublicationVariable=function(name){var vars=this.m_publication.getVariables();return vars[name];};DWVariables.prototype.resetPublicationVariables=function(){if(this.m_initPublicationArgs){for(var i=1;i<this.m_initPublicationArgs.length;i+=2){var name=this.m_initPublicationArgs[i];var value=this.m_initPublicationArgs[i+1];this.setValue(name,value);}}};DWVariables.prototype.resetPageVariables=function(){if(this.m_initPageArgs){var vars=this.m_page.getVariables();for(var i=0;i<this.m_initPageArgs.length;i+=3){this.setPageVariable(this.m_page,this.m_initPageArgs[i],this.m_initPageArgs[i+1]);}}};DWVariables.prototype.m_lastTimeVariableUpdate=0;DWVariables.prototype.m_firstUpdate=null;DWVariables.prototype.update=function(time){if(!this.m_firstUpdate){this.m_firstUpdate=new Date();}var vars=this.m_publication.getVariables();var pageVars=this.m_page.getVariables();var v;for(v in this.m_changedPage){if(this.m_callbacks){if(this.m_callbacks.hasOwnProperty(v)){var callbacks=this.m_callbacks[v];if(callbacks){for(var i=0;i<callbacks.length;i++){if(callbacks[i]){callbacks[i].variableChanged(v);}}}}}}for(v in this.m_changedPublication){if(this.m_callbacks){if(this.m_callbacks.hasOwnProperty(v)){var callbacks=this.m_callbacks[v];if(callbacks){for(var i=0;i<callbacks.length;i++){if(callbacks[i]){callbacks[i].variableChanged(v);}}}}}}this.saveToStorage();this.m_changedPage=new Object();this.m_changedPublication=new Object();if((time-this.m_lastTimeVariableUpdate)>=0x3e8){this.updateTimeVariables();this.m_lastTimeVariableUpdate=time;}};DWVariables.prototype.saveToStorage=function(){if(this.m_sessionStorageEnabled&&(window.sessionStorage!=undefined)){var vars=this.m_publication.getVariables();var pageVars=this.m_page.getVariables();var v;for(v in this.m_changedPage){if(this.m_persist[v]==true){window.sessionStorage[this.m_page.GetName()+"."+v]=this.writeSessionStorageValue(pageVars[name]);}}for(v in this.m_changedPublication){window.sessionStorage["Publication."+v]=this.writeSessionStorageValue(vars[v]);}}};DWVariables.prototype.updateTimeVariables=function(){var date=new Date();this.setValue("SYSTEM_TIME_YEAR",date.getFullYear());this.setValue("SYSTEM_TIME_MONTH","JanFebMarAprMayJunJulAugSepOctNovDec".substr(date.getMonth()*3,3));this.setValue("SYSTEM_TIME_DATE",date.getDate()+"");this.setValue("SYSTEM_TIME_DAY","SunMonTueWedThuFriSatSun".substr(date.getDay()*3,3));this.setValue("SYSTEM_TIME_HOUR",date.getHours());this.setValue("SYSTEM_TIME_MINUTE",date.getMinutes());this.setValue("SYSTEM_TIME_SECOND",date.getSeconds());this.setValue("SYSTEM_TIME_12HOUR",((date.getHours()+11)%12)+1);this.setValue("SYSTEM_TIME_AMPM",(date.getHours()<12?"AM":"PM"));var months=["January","February","March","April","May","June","July","August","September","October","November","December"];this.setValue("SYSTEM_DATE_FULL",date.getDate()+" "+months[date.getMonth()]+" "+date.getFullYear());this.setValue("PUBLICATION_TIME",Math.round((date.getTime()-this.m_firstUpdate.getTime())/0x3e8));};DWVariables.prototype.writeSessionStorageValue=function(v){if(typeof(v)=="number"){return "N"+String(v);}if(typeof(v)=="string"){return "S"+String(v);}if(typeof(v)=="boolean"){return "B"+String(v);}return "U"+String(v);};DWVariables.prototype.readSessionStorageValue=function(s){if(s.length>1){switch(s.substr(0,1)){case "N":return Number(s.substr(1));case "S":return String(s.substr(1));case "B":return s.substr(1)=="true";}return s.substr(1);}return null;};DWVector=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);};__inherit(DWVector,DWGraphicalObject);DWVector.prototype.type=function(){return "Vector";};DWVector.prototype.m_polygons=null;DWVector.prototype.addPolygon=function(index,object,frame,polygon){if(!this.m_polygons){this.m_polygons=new Array();}if((index>=this.m_polygons.length)||(this.m_polygons[index]==undefined)){this.m_polygons[index]=new Array();}var entry=new DWVectorPolygonEntry();if(object==null){object=document.createElementNS("http://www.w3.org/2000/svg","path");object.setAttribute("d","");object.setAttribute("fill","none");this.m_svgGroup.appendChild(object);}entry.m_object=object;entry.m_frame=frame;entry.m_polygon=polygon;this.m_polygons[index].push(entry);};DWVector.prototype.addPolygons=function(index,object){if(object==null){object=document.createElementNS("http://www.w3.org/2000/svg","path");object.setAttribute("d","");object.setAttribute("fill","none");this.m_svgGroup.appendChild(object);}for(var i=2;i<arguments.length;i+=2){this.addPolygon(index,object,arguments[i],arguments[i+1]);}};DWVector.prototype.m_tempPolygons=null;DWVector.prototype.m_lastPolygonEntries=null;DWVector.prototype.setDisplayFrame=function(frame){if(!this.m_lastPolygonEntries){this.m_lastPolygonEntries=new Array();}if(this.m_polygons){for(var i=0;i<this.m_polygons.length;i++){var p1=null;var p2=null;for(var e=0;e<this.m_polygons[i].length;e++){var p=this.m_polygons[i][e];if(p.m_frame<frame){p1=p;}else{if(p.m_frame>=frame){p2=p;break;}}}var poly=null;var obj=null;var morphed=false;if(p1&&p2&&(p1!=p2)){if(!this.m_tempPolygons){this.m_tempPolygons=new Array();}if((this.m_tempPolygons[i]==null)||(this.m_tempPolygons[i]==undefined)){this.m_tempPolygons[i]=new DWPolygon(null,null,null,null);}this.m_tempPolygons[i].morph(p1.m_polygon,p2.m_polygon,(frame-p1.m_frame)/(p2.m_frame-p1.m_frame));poly=this.m_tempPolygons[i];obj=p1.m_object;morphed=true;}else{if(p1){poly=p1.m_polygon;obj=p1.m_object;}else{if(p2){poly=p2.m_polygon;obj=p2.m_object;}}}if(morphed||(this.m_lastPolygonEntries[i]!=poly)){if(poly&&obj){poly.drawSVG(obj);}this.m_lastPolygonEntries[i]=poly;}}}};DWVector.prototype.hitTest=function(ptPage){if(this.m_visible==2){var pt=this.pointFromPage(ptPage);var r=new DWRect((-this.m_width)/2,(-this.m_height)/2,this.m_width,this.m_height);if(r.containsPoint(pt)){if(!this.m_ignoreTransparentArea){return true;}if(this.m_tempPolygons){for(var i=0;i<this.m_tempPolygons.length;i++){if(DWGeometry.pointInDWPolygon(pt,this.m_tempPolygons[i])){return true;}}}else{if(this.m_polygons){for(var i=0;i<this.m_polygons.length;i++){if(DWGeometry.pointInDWPolygon(pt,this.m_polygons[i][0].m_polygon)){return true;}}}}return false;}}return false;};DWVector.prototype.drawContentCanvas=function(ctx){if(this.m_tempPolygons){for(var i=0;i<this.m_tempPolygons.length;i++){this.m_tempPolygons[i].drawCanvas(ctx);}}else{if(this.m_polygons){for(var i=0;i<this.m_polygons.length;i++){this.m_polygons[i][0].m_polygon.drawCanvas(ctx);}}}};DWVectorImage=function(polys,rSrc,mode){DWImageBase.call(this,rSrc,mode);this.m_polygons=polys;};__inherit(DWVectorImage,DWImageBase);DWVectorImage.prototype.m_polygons=null;DWVectorImage.prototype.type=function(){return "DWVectorImage";};DWVectorPolygonEntry=function(){};DWVectorPolygonEntry.prototype.m_object=null;DWVectorPolygonEntry.prototype.m_frame=0;DWVectorPolygonEntry.prototype.m_polygon=null;DWVertex=function(ix,iy,it){DWPoint.call(this,ix,iy);this.type=it;};__inherit(DWVertex,DWPoint);DWVertex.prototype.type=null;DWVideo=function(elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY){DWGraphicalObject.call(this,elementId,code,name,parentOffsetX,parentOffsetY,sizeX,sizeY);if(this.m_element){for(var i=0;i<this.m_element.childNodes.length;i++){if((this.m_element.childNodes[i].tagName=="video")||(this.m_element.childNodes[i].tagName=="VIDEO")){this.m_videoElement=this.m_element.childNodes[i];break;}}}};__inherit(DWVideo,DWGraphicalObject);DWVideo.prototype.m_iframeElement=null;DWVideo.prototype.m_url=null;DWVideo.prototype.m_videoElement=null;DWVideo.prototype.m_autoStart=false;DWVideo.prototype.type=function(){return "Video";};DWVideo.prototype.videoElement=function(){return this.m_videoElement;};DWVideo.prototype.setEmbeddedURL=function(url){this.m_url=url;return this;};DWVideo.prototype.setAutoStart=function(autoStart){this.m_autoStart=autoStart;return this;};DWVideo.prototype.startObject=function(parentVisible){DWGraphicalObject.prototype.startObject.call(this,parentVisible);if(this.m_url){this.m_iframeElement=document.createElement("iframe");this.m_iframeElement.setAttribute("width",String(this.getWidth()));this.m_iframeElement.setAttribute("height",String(this.getHeight()));this.m_iframeElement.setAttribute("src",this.m_url);this.m_iframeElement.style.setProperty("position","absolute","important");this.m_iframeElement.style.setProperty("width",String(this.getWidth())+"px","important");this.m_iframeElement.style.setProperty("height",String(this.getHeight())+"px","important");this.m_element.appendChild(this.m_iframeElement);}if(parentVisible&&(this.m_visible==1)&&this.m_videoElement){if(this.m_autoStart){this.m_videoElement.play();}}};DWVideo.prototype.stopObject=function(){DWGraphicalObject.prototype.stopObject.call(this);if(this.m_iframeElement){this.m_element.removeChild(this.m_iframeElement);this.m_iframeElement=null;}if(this.m_videoElement){this.m_videoElement.pause();}};DWVideo.prototype.onShowFinished=function(){DWGraphicalObject.prototype.onShowFinished.call(this);if(this.m_videoElement&&this.m_autoStart){this.m_videoElement.play();}};DWVideo.prototype.onHideFinished=function(){if(this.m_videoElement){this.m_videoElement.pause();}DWGraphicalObject.prototype.onHideFinished.call(this);};DWVideo.prototype.resume=function(){if(this.m_videoElement){this.m_videoElement.play();}};DWVideo.prototype.Play=function(from){if(this.m_videoElement){if(from!=undefined){this.m_videoElement.currentTime=from/0x3e8;}this.m_videoElement.play();}};DWVideo.prototype.Stop=function(reset){if(this.m_videoElement){this.m_videoElement.pause();if(reset){this.m_videoElement.currentTime=0;}}};DWVideo.prototype.seekSet=function(pos){if(this.m_videoElement){this.m_videoElement.currentTime=pos/0x3e8;}};DWVideo.prototype.seekCur=function(pos){if(this.m_videoElement){this.m_videoElement.currentTime=this.m_videoElement.currentTime+(pos/0x3e8);}};DWVideo.prototype.seekEnd=function(pos){if(this.m_videoElement){this.m_videoElement.currentTime=this.m_videoElement.duration+(pos/0x3e8);}};DWWebPostAction=function(url,src,dst){this.m_url=url;this.m_src=src;this.m_dst=dst;};__inherit(DWWebPostAction,DWAction);DWWebPostAction.prototype.m_url=null;DWWebPostAction.prototype.m_src=null;DWWebPostAction.prototype.m_dst=null;DWWebPostAction.prototype.m_request=null;DWWebPostAction.prototype.m_callback=null;DWWebPostAction.prototype.Go=function(callback){this.m_request=new XMLHttpRequest();this.m_request.onload=this.onLoad.bind(this);if(this.m_src){this.m_request.open("POST",this.m_url,true);var str="";for(var i=0;i<this.m_src.length;i+=2){if(i!=0){str+="&";}var value=DWVariables.instance().getValue(this.m_src[i+1]);str+=((this.m_src[i]+"=")+encodeURIComponent(value));}this.m_request.setRequestHeader("Content-type","application/x-www-form-urlencoded");this.m_request.send(str);}else{this.m_request.open("GET",this.m_url,true);this.m_request.send();}this.m_callback=callback;return 1;};DWWebPostAction.prototype.onLoad=function(){if(this.m_request.status==0xc8){if(this.m_dst){if((this.m_dst.length==2)&&(this.m_dst[0]==null)){DWVariables.instance().setValue(this.m_dst[1],this.m_request.responseText);}else{var response=this.m_request.responseText.split("&");for(var i=0;i<response.length;i++){var field=response[i].split("=");if(field.length>=2){for(var k=0;k<this.m_dst.length;k+=2){if(field[0]==this.m_dst[k]){DWVariables.instance().setValue(this.m_dst[k+1],field[1]);}}}}}}}this.m_request=null;this.m_callback.Notify(0);};DWZoomTransition=function(time,reverse){DWTransition.call(this,time);this.m_reverse=reverse;};__inherit(DWZoomTransition,DWTransition);DWZoomTransition.prototype.m_reverse=null;DWZoomTransition.prototype.m_blocks=null;DWZoomTransition.prototype.addBlock=function(x1,y1,x2,y2,x1s,y1s,x2s,y2s,startTime,endTime,startAlpha,endAlpha,alphaFn){if(startAlpha==undefined)startAlpha=0;if(endAlpha==undefined)endAlpha=1;if(alphaFn==undefined)alphaFn=-1;var n=new DWZoomTransitionBlock();n.m_x1=x1;n.m_y1=y1;n.m_x2=x2;n.m_y2=y2;n.m_x1s=x1s;n.m_y1s=y1s;n.m_x2s=x2s;n.m_y2s=y2s;n.m_startTime=startTime;n.m_endTime=endTime;n.m_startAlpha=startAlpha;n.m_endAlpha=endAlpha;if(!this.m_blocks){this.m_blocks=new Array();}this.m_blocks.push(n);return this;};DWZoomTransition.prototype.createInstance=function(object){var n=new DWZoomTransition(this.m_time,this.m_reverse);n.m_blocks=this.m_blocks;n.m_object=object;return n;};DWZoomTransition.prototype.start=function(callback){DWTransition.prototype.start.call(this,callback);};DWZoomTransition.prototype.updateTransition=function(pos){if(this.m_reverse){pos=1-pos;}if(this.m_blocks.length==1){var width=this.m_object.getWidth();var height=this.m_object.getHeight();var b=this.m_blocks[0];var s=b.m_startTime/0x64;var e=b.m_endTime/0x64;var p=(pos-s)/(e-s);if(p<0)p=0;if(p>1)p=1;var x1=b.m_x1s+((b.m_x1-b.m_x1s)*p);var y1=b.m_y1s+((b.m_y1-b.m_y1s)*p);var x2=b.m_x2s+((b.m_x2-b.m_x2s)*p);var y2=b.m_y2s+((b.m_y2-b.m_y2s)*p);x1=(x1*width)/0x3e8;y1=(y1*height)/0x3e8;x2=(x2*width)/0x3e8;y2=(y2*height)/0x3e8;var zoomX=(x2-x1)/width;var zoomY=(y2-y1)/height;var a=b.m_startAlpha+((b.m_endAlpha-b.m_startAlpha)*p);if(this.m_imageGroup){if((zoomX==0)||(zoomY==0)){DWSVGHelper.setAlpha(this.m_imageGroup,0);}else{DWSVGHelper.setTransform(this.m_imageGroup,new DWPoint(x1+(((x2-x1)-width)/2),y1+(((y2-y1)-height)/2)),new DWPoint(zoomX,zoomY));DWSVGHelper.setAlpha(this.m_imageGroup,a);}}else{this.m_object.setScale(zoomX,zoomY);this.m_object.setTranslate(x1+(((x2-x1)-width)/2),y1+(((y2-y1)-height)/2));this.m_object.setAlpha(a);}}};DWZoomTransitionBlock=function(){};DWZoomTransitionBlock.prototype.m_x1=null;DWZoomTransitionBlock.prototype.m_y1=null;DWZoomTransitionBlock.prototype.m_x2=null;DWZoomTransitionBlock.prototype.m_y2=null;DWZoomTransitionBlock.prototype.m_x1s=null;DWZoomTransitionBlock.prototype.m_y1s=null;DWZoomTransitionBlock.prototype.m_x2s=null;DWZoomTransitionBlock.prototype.m_y2s=null;DWZoomTransitionBlock.prototype.m_startTime=null;DWZoomTransitionBlock.prototype.m_endTime=null;DWZoomTransitionBlock.prototype.m_startAlpha=null;DWZoomTransitionBlock.prototype.m_endAlpha=null;Debug=function(){};Debug.m_traceEnabled=false;Debug.enableTrace=function(enabled){if(enabled==undefined)enabled=true;Debug.m_traceEnabled=enabled;};Debug.trace=function(t){if(Debug.m_traceEnabled){console.log(t);}};Debug.trace2=function(t){Debug.trace(t);};Debug.clear=function(){};SVGAngle=function(){};SVGAnimatedLength=function(){};SVGLength=function(){};SVGMatrix=function(){};SVGNumber=function(){};SVGPathSeg=function(){};SVGPathSeg.prototype.pathSegType=null;SVGPathSeg.prototype.pathSegTypeAsLetter=null;SVGPathSegClosePath=function(){};SVGPathSegCurvetoCubicAbs=function(){};SVGPathSegCurvetoCubicAbs.prototype.x=null;SVGPathSegCurvetoCubicAbs.prototype.y=null;SVGPathSegCurvetoCubicAbs.prototype.x1=null;SVGPathSegCurvetoCubicAbs.prototype.y1=null;SVGPathSegCurvetoCubicAbs.prototype.x2=null;SVGPathSegCurvetoCubicAbs.prototype.y2=null;SVGPathSegCurvetoQuadraticAbs=function(){};SVGPathSegCurvetoQuadraticAbs.prototype.x=null;SVGPathSegCurvetoQuadraticAbs.prototype.y=null;SVGPathSegCurvetoQuadraticAbs.prototype.x1=null;SVGPathSegCurvetoQuadraticAbs.prototype.y1=null;SVGPathSegLinetoAbs=function(){};SVGPathSegLinetoAbs.prototype.x=null;SVGPathSegLinetoAbs.prototype.y=null;SVGPathSegMovetoAbs=function(){};SVGPathSegMovetoAbs.prototype.x=null;SVGPathSegMovetoAbs.prototype.y=null;SVGPoint=function(){};SVGTransform=function(){};SVGViewSpec=function(){};function decimalToHex(d,padding){if(padding==undefined)padding=2;var hex=d.toString(0x10);while(hex.length<padding){hex="0"+hex;}return hex;};function _DWActionCondition(func,cases){this.func=func;this.cases=cases;};function _DWActionCondition_Go(callback){var result=this.func(this.host);for(var i=0;i<this.cases.length;i+=3){if((this.cases[i]==null)||((result>=this.cases[i])&&(result<=this.cases[(i+1)]))){return this.cases[i+2].Go(callback);}}return 0;};function _DWActionCondition_InitClose(close,host){if(!close){this.host=host;}for(var i=0;i<this.cases.length;i+=3){this.cases[i+2].InitClose(close,host);}};